define("common:widget/appresize/appresize.js",function(i,t,e){var n=(i("common:static/js/util.js"),function(){var i;return function(){var t=document.createElement("div"),e=document.body;return t.style.minHeight="10px",t.style.height="auto",t.style.padding="0",t.style.borderWidth="0",i=10===e.appendChild(t).offsetHeight,e.removeChild(t),i}}()),h=function(){var i=990,t=document;n()?$(t.body).css({"min-width":i,"min-height":$(window).height()}):t.body.style.width=(window.innerWidth||t.documentElement.clientWidth)<i?i+"px":"auto"};e.exports={init:function(){h(),this.bind()},bind:function(){listener.on("common","sizechange",$.proxy(this.update,this)),listener.on("common.page","switchend",$.proxy(this.setMainHeight,this)),$(window).bind("resize",$.proxy(this.resize,this))},getAppHeight:function(){var i=$(window).height(),t=$("#searchWrapper"),e=$(".index-select-city"),n=t.outerHeight(),h=e.outerHeight(),s=n,o=i-n,r=o-h;return{mainHeight:o,mapTop:s,listHeight:r}},setMainHeight:function(){var i=this.getAppHeight();$("#contentWrapper").css({height:i.mainHeight}),$("#map-holder").css({height:i.mainHeight}),$("#mapWrapper").css({height:i.mainHeight}),$("#poi_list").css({height:i.listHeight}),$("#poi-detail-container").css({height:i.listHeight})},update:function(){var i=this.getAppHeight();$("#map-holder").css({height:i.mainHeight}),$("#contentWrapper").css({height:i.mainHeight}),$("#mapWrapper").css({height:i.mainHeight}),$("#poi_list").css({height:i.listHeight}),$("#poi-detail-container").css({height:i.listHeight})},resize:function(i){var t=this;$(document.body).css("min-height",$(window).height()),t.update(),listener.trigger("common","sizechange",{width:i.target.innerWidth,height:i.target.innerHeight,delay:!0})}}});
;define("common:widget/pagemgr/pagemgr.js",function(n,e,i){var t=0,r=0,a=1,o={switchstart:1,pagearrived:2,switchend:3,pageloaded:4},g=["landing","quickling","fromcache"],c="landing",p=[],d=function(){var n,e=document.referrer,i=/^.*?\/\/(.*?)(\/|\?|\#|$)/i,t=e.match(i);return t&&(n=t[1]),n},u=function(){return 0===t},s=function(){return location.href.indexOf("fromhash=1")>-1?!0:window.location.host!==d()},f=function(){return u()&&s()},m=function(){return!0},h=function(){return c},l=function(n){g[n]&&(c=g[n])},v=function(){$.each(p,function(n,e){e()}),p=[]},w=function(n){return o[n]?(("switchstart"===n||a===o.pageloaded)&&r++,a=o[n],r):void 0},P=function(){appPage.on("onpagerenderstart",function(n){var e=n||{};e.eid=w("switchstart"),listener.trigger("common.page","switchstart",e)}),appPage.on("onpagearrived",function(n){var e=n||{};e.eid=w("pagearrived"),l(n.initiator),listener.trigger("common.page","pagearrived",e)}),appPage.on("onpagerendercomplete",function(n){var e=n||{};e.eid=w("switchend"),t++,v(),listener.trigger("common.page","switchend",e)}),appPage.on("onpageloaded",function(n){var e=n||{};e.eid=w("pageloaded"),listener.trigger("common.page","pageloaded",e)}),appPage.on("historyback",function(){listener.trigger("common.page","historyback")})},k=function(n){$.isFunction(n)&&p.push(n)},y=function(){P()};i.exports={init:y,getInitiator:h,registerDestory:k,isLandingPage:f,isSinglePageApp:m}});
;define("common:widget/initapp/initapp.js",function(i,n){var o=i("common:widget/appresize/appresize.js"),e=i("common:widget/pagemgr/pagemgr.js"),t=!1,p=function(){window.scrollTo(0,1)},c=function(){t||listener.on("common.page","switchend",p)},m=function(){o.init(),e.init(),c(),t=!0};n.init=m});
;define("common:widget/map/map.js",function(t,e,n){var i=(t("common:widget/pagemgr/pagemgr.js"),t("common:static/js/util.js")),o=t("common:widget/appresize/appresize.js"),a=t("index:widget/heatLayer/HeatLayer.js");n.exports={init:function(t){this.mapHolder=t,this._initialized?this.show():this._init()},_init:function(){this._BMap=BMap,this._initMap(),this._bindEvent(),this._initHeatLayer(),this._initControl()},_initMap:function(){this.show(),window.BMAP_TYPE_DIMENSIONAL=window.BMAP_PERSPECTIVE_MAP,window.BMAP_TYPE_HYBIRD="B_SATELLITE_STREET";var t=BMAP_NORMAL_MAP,e=this._map=new this._BMap.Map(this.mapHolder,{coordType:BMAP_COORD_MERCATOR,zoomLevelMin:3,mapType:t}),n=window._CURRENT_CITY,o=i.geoToPoint(n.geo),a=n.level||12;e.centerAndZoom(o,a),e.enableLoadTiles=!0,e.enableKeyboard(),e.enableScrollWheelZoom(),e.enableInertialDragging(),e.enableContinuousZoom()},setViewport:function(t,e){var n=this._map.getViewport(t,e),i=n.center,o=n.zoom;this._centerAndZoom(i,o)},_centerAndZoom:function(t,e){this._map.enableLoadTiles=!0,this._map.centerAndZoom(t,e)},hide:function(){},show:function(){o.update()},_bindEvent:function(){var t=this;listener.on("common.page","city_change",function(e,n){t._setMap(n.cityInfo)})},_setMap:function(t){if(t&&t.geo){var e=this._map,n=i.geoToPoint(t.geo),o=t.level||12;e.centerAndZoom(n,o)}},_initControl:function(){var t=this,e=this._BMap,n=this._map;t.stdMapCtrl=new e.NavigationControl({from:"MAP_INDEX",offset:new e.Size(8,10)}),n.addControl(t.stdMapCtrl),t.scaleCtrl=new e.ScaleControl({offset:new e.Size(5,10)}),n.addControl(t.scaleCtrl),t.overviewCtrl=new e.OverviewMapControl({isOpen:!1,anchor:BMAP_ANCHOR_BOTTOM_RIGHT}),n.addControl(t.overviewCtrl),this._loadAsyncCtrl()},_loadAsyncCtrl:function(){var e=this._map,n=this;t.async(["index:widget/legend/LegendControl.js","index:widget/timeControl/TimeControl.js"],function(t,i){n.legendControl=new t,e.addControl(n.legendControl),n.timeControl=new i({heatLayerManager:n.heatLayerMgr}),e.addControl(n.timeControl)})},_initHeatLayer:function(){var t=(this._BMap,this._map);this.heatLayerMgr=new a(t),this.heatLayerMgr.init()},getBMap:function(){return this._BMap},getMap:function(){return this._map||{}}}});
;define("common:widget/maputil/maputil.js",function(t,e,r){var n=["=",".","-","*"],i=1<<23,o={decode_geo_diff:function(t){for(var e=this._decode_type(t.charAt(0)),r=t.substr(1),i=0,o=r.length,s=[],a=[],d=[];o>i;)if(r.charAt(i)===n[0]){if(13>o-i)return 0;if(d=this._decode_6byte_(r.substr(i,13),s),0>d)return 0;i+=13}else if(";"===r.charAt(i))a.push(s.slice(0)),s.length=0,++i;else{if(8>o-i)return 0;if(d=this._decode_4byte_(r.substr(i,8),s),0>d)return 0;i+=8}for(var u=0,f=a.length;f>u;u++)for(var h=0,p=a[u].length;p>h;h++)a[u][h]/=100;return{geoType:e,geo:a}},_decode_type:function(t){var e=-1;return t===n[1]?e=2:t===n[2]?e=1:t===n[3]&&(e=0),e},_decode_6byte_:function(t,e){for(var r=0,n=0,i=0,o=0;6>o;o++){if(i=this._char2num_(t.substr(1+o,1)),0>i)return-1-o;if(r+=i<<6*o,i=this._char2num_(t.substr(7+o,1)),0>i)return-7-o;n+=i<<6*o}return e.push(r),e.push(n),0},_decode_4byte_:function(t,e){var r=e.length;if(2>r)return-1;for(var n=0,o=0,s=0,a=0;4>a;a++){if(s=this._char2num_(t.substr(a,1)),0>s)return-1-a;if(n+=s<<6*a,s=this._char2num_(t.substr(4+a,1)),0>s)return-5-a;o+=s<<6*a}return n>i&&(n=i-n),o>i&&(o=i-o),e.push(e[r-2]+n),e.push(e[r-1]+o),0},_char2num_:function(t){var e=t.charCodeAt(0);return t>="A"&&"Z">=t?e-"A".charCodeAt(0):t>="a"&&"z">=t?26+e-"a".charCodeAt(0):t>="0"&&"9">=t?52+e-"0".charCodeAt(0):"+"===t?62:"/"===t?63:-1},getPoiPoint:function(t){var e=[],r=null;if("Point"===t.toString())r=t;else{if("string"==typeof t){if(e=$.trim(t).split(","),e.length<2)return;e[0]=parseFloat($.trim(e[0])),e[1]=parseFloat($.trim(e[1]))}else if(e=t.slice(0),e.length<2)return;r=new BMap.Point(e[0],e[1])}return r},parseGeo:function(t){if("string"==typeof t){var e=t.split("|"),r=parseInt(e[0]),n=e[1],i=e[2],o=i.split(";"),s=[];switch(r){case 1:s.push(o[0]);break;case 2:case 3:for(var a=0;a<o.length-1;a++){var d=o[a];if(d.length>100)d=d.replace(/([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*),([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*)(,)/g,"$1,$2;"),s.push(d);else{for(var u=[],f=d.split(","),h=0;h<f.length;h+=2){var p=f[h],l=f[h+1];u.push(p+","+l)}s.push(u.join(";"))}}}return s.length<=1&&(s=s.toString()),{type:r,bound:n,points:s}}},parse2Geo:function(t,e){e?.25>e?e=0:e>.25&&1>e?e=1:e>32&&(e=32):e=0;var r,n=t.split("|");if(1===n.length)return r=this.decode_geo_diff(n[0]),{type:r.type,bound:"",points:r.geo.join(",")};if(n.length>1){for(var i=t.split(";.="),o=[],s=[],a=0,d=i.length,u=0;d>u;u++){var f=i[u];d>1&&(0===u&&(f+=";"),u>0&&d-1>u&&(f=".="+f+";"),u===d-1&&(f=".="+f));var h=f.split("|"),p=this.decode_geo_diff(h[0]),l=this.decode_geo_diff(h[1]);o.push(p.geo.join(",")),o.push(l.geo.join(",")),r=this.decode_geo_diff(h[2]),a=r.type;var g=r.geo.join(",");if(g=g.replace(/([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*),([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*)(,)/g,"$1,$2;"),e>0){var c=new RegExp("(((-?\\d+)(\\.\\d+)?),((-?\\d+)(\\.\\d+)?);)(((-?\\d+)(\\.\\d+)?),((-?\\d+)(\\.\\d+)?);){"+e+"}","ig");g=g.replace(c,"$1")}s.push(g)}return 1>=d&&(s=s.join(";")),{type:a,bound:o.join(";"),points:s}}},getPointByStr:function(e){var r=t("common:widget/map/map.js").getBMap();if("string"==typeof e){var n=e.split(",");if(!(n.length<2))return r?new r.Point(n[0],n[1]):{lng:parseFloat(n[0]),lat:parseFloat(n[1])}}},getBPoints:function(t){if(t&&0!==t.length){for(var e=[],r=0;r<t.length;r++)if(t[r])for(var n=t[r].split(";"),i=0;i<n.length;i++){var o=util.getPointByStr(n[i]);e.push(o)}return e}}};r.exports=o});
;define("common:widget/stat/CodeStat.js",function(t,e,n){var a=function(){function t(t){var e,n=window.poiResponse,a=n&&n.result,t=t||{};if(n&&a){e={from:"heatmap",query:a.return_query||a.wd||"",qid:a.qid||"",page_num:isNaN(Number(a.page_num))?"":""+a.page_num};for(var o in e)e.hasOwnProperty(o)&&e[o]&&(t[o]=e[o])}return t}function e(t,e){t&&(i=!0,setTimeout(function(){if(t.src&&-1!=t.src.indexOf("class="))var e="http://log.map.baidu.com/t.gif?"+t.src;else var e="http://webmap0.map.bdimg.com/newheatmap/static/common/images/transparent_3254726.gif?newmap=1"+t;r.src=e,r.onload=n},e||50))}function n(){var t=d.shift();return t?void e(t):void(i=!1)}function a(){i=!1,n()}function o(t,e){var n="";for(var a in t)"undefined"!=typeof t[a]&&(n=e?n+"&"+a+"="+encodeURIComponent(t[a]):n+"&"+a+"="+t[a]);return n}var r=new Image,i=!1,d=[];return r.onload=a,r.onerror=a,window.statParamInterceptor=t,{addStat:function(t,n,a){if(t){var r,a=a||{},c=window._CURRENT_CITY||{},s=c.code;"number"==typeof t?(a=n||{},a.code=t,a.t=(1e8*Math.random()).toFixed(0),a.c=s,r=o(a,!0)):(n=n||"click",a.da_src=t,a.da_act=n,a.resid=61,a.t=(new Date).getTime(),r=o(a)),i?d.push(r):e(r,0)}},classStat:function(t,n,a){n=n||{};var o=n.time||(new Date).getTime(),r="";for(var c in n)"undefined"!=typeof n[c]&&(r=r+"&_"+encodeURIComponent(c)+"_="+encodeURIComponent(n[c]));a||(a="HEATMAP");var s="class="+encodeURIComponent(a+"->"+t)+r+"&time="+o;i?d.push({src:s}):e({src:s})}}}();window.addStat=a.addStat,window.ccStat=a.classStat,n.exports={addStat:a.addStat,ccStat:a.classStat}});
;define("common:widget/url/url.js",function(e,t,r){var a=e("common:static/js/util.js");r.exports={host:"http://"+location.host,appPathReg:/^\/heatmap\//i,update:function(e,t){var r,a=t||{},n=this._get(e,a),p=this._getCurrentUrl();n.replace(this.appPathReg,"")!==p.replace(this.appPathReg,"")&&(r=this.host+n,this.navigate(r,t))},navigate:function(e,t){if("string"==typeof e){var r=("/"+this._getCurrentUrl(),t||{});r.trigger=r.trigger!==!1,r.replace===!0&&appPage.redirect(e,r)}},get:function(e){e=e||{};var t=e.path||this._getCurrentUrl(),r=e.disableEncode||!1,n=t.replace(/^\//,""),p=n.split("/"),i=p[0],u=p[1],o=p[2],l=p[3],s=p[4]||"";if(!r&&!/%3d|%26/gi.test(s)&&s.indexOf("=")>-1);return{product:i,module:u,action:o,query:a.urlToJSON(l||""),pageState:a.urlToJSON(s||"")}},_getCurrentUrl:function(){return appPage.getFragment().replace(/^\//,"")},toIndex:function(e){var t=$.extend({queryReplace:!0,pageStateReplace:!0},e);this.update({module:"index",action:"index"},t)},_get:function(e,t){var r=this._getCurrentUrl(),n=r.split("/"),p=n[0]||"heatmap",i=n[1]||"index",u=n[2]||"index",o=n[3]||"fr=newheatmap",l=n[4]||"",s=t&&t.queryReplace||!1,g=t&&t.pageStateReplace||!1,h=[];if(h.push(e.product||p),h.push(e.module||i),h.push(e.action||u),s)e.query&&h.push(a.jsonToUrl(e.query));else{var c=a.urlToJSON(o);e.query=e.query||{};for(var d in e.query)""!==e.query[d]?c[d]=e.query[d]:delete c[d];h.push(a.jsonToUrl(c))}if(g)e.pageState&&h.push(a.jsonToUrl(e.pageState));else{e.pageState=e.pageState||{};var f=a.urlToJSON(l);for(var S in e.pageState)""!==e.pageState[S]?f[S]=e.pageState[S]:delete f[S];h.push(a.jsonToUrl(f))}return"/"+h.join("/")}}});