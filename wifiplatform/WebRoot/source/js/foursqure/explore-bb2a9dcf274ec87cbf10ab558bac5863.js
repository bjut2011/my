fourSq.venue.util.TipImpressionLogger=function(a){};
fourSq.venue.util.TipImpressionLogger=fourSq.Class.extend({initialize:function(a){this.contentIdFunc_=a.contentIdFunc||function(a){return a.data("id")||null};this.contentImpressionLogger_=new fourSq.impressions.ContentImpressionLogger({section:fourSq.stats.action.Section.TIPS_SECTION});this.impressionMonitor_=new fourSq.ui.ImpressionMonitor(a.$el,a.selector,{revealPercent:50});this.impressionMonitor_.on(fourSq.ui.ImpressionMonitor.Events.FIRST_IMPRESSION,fourSq.bind(function(a){a=this.contentIdFunc_(a);
null!==a&&this.contentImpressionLogger_.log(a,"tip")},this));this.update()},update:function(){this.impressionMonitor_.update()}});
fourSq.views.MenuView=function(a){};
fourSq.views.MenuView=fourSq.ui.View.extend({initialize:function(a){fourSq.views.MenuView.__super__.initialize.call(this,a);this.venue_=a.venue},setupMenuFlag:function(){if(fourSq.isDefinedAndNotNull(fourSq.api.models.companion.user.UserUtil.currentUser())){var a=this.$el.find(".flagLink"),b=$(templates.fourSq.newdrag.page.venuemenu.web.flag());this.comment_=b.find(".comment");$(a).click(fourSq.bind(function(){b.addClass("unknown");b.removeClass("success failure noProblem");var a=(new fourSq.ui.dialog.Dialog({className:"flagMenuDialog",
contentElement:b,isModal:!0,hasCloseButton:!0})).show();$(b).find(".submitFlag").click(fourSq.bind(function(){var d=$(b).find("input[name\x3dreason]:checked"),e=d.val();fourSq.isDefinedAndNotNull(e)?(b.removeClass("noReason"),fourSq.api.services.Venue.flag(this.venue_.id,{problem:e,creatingView:"web-menu-page",comment:this.comment_.val()},fourSq.bind(function(){d.removeAttr("checked");b.toggleClass("success unknown");window.setTimeout(function(){a.close()},1E3)},this))):b.addClass("noReason")},this))},
this))}else this.$el.find(".flagMenu").hide()}});"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.newdrag&&(templates.fourSq.newdrag={});"undefined"==typeof templates.fourSq.newdrag.page&&(templates.fourSq.newdrag.page={});"undefined"==typeof templates.fourSq.newdrag.page.venuemenu&&(templates.fourSq.newdrag.page.venuemenu={});"undefined"==typeof templates.fourSq.newdrag.page.venuemenu.web&&(templates.fourSq.newdrag.page.venuemenu.web={});
templates.fourSq.newdrag.page.venuemenu.web.flag=function(a,b){return'\x3cdiv class\x3d"menuflagFrame unknown"\x3e\x3ch3\x3eFlag this Menu\x3c/h3\x3e\x3cdiv class\x3d"flagForm"\x3e\x3cul\x3e\x3cli\x3e\x3clabel\x3e\x3cinput name\x3d"reason" type\x3d"radio" value\x3d"wrong_menu"/\x3eWrong menu\x3c/label\x3e\x3c/li\x3e\x3cli\x3e\x3clabel\x3e\x3cinput name\x3d"reason" type\x3d"radio" value\x3d"incorrect_items"/\x3eIncorrect items\x3c/label\x3e\x3c/li\x3e\x3cli\x3e\x3clabel\x3e\x3cinput name\x3d"reason" type\x3d"radio" value\x3d"other"/\x3eOther\x3c/label\x3e\x3c/li\x3e\x3c/ul\x3e\x3ctextarea class\x3d"comment" placeholder\x3d"Comments ..."\x3e\x3c/textarea\x3e\x3cp class\x3d"noReasonMessage"\x3ePlease select a reason.\x3c/p\x3e\x3cp\x3e\x3cinput name\x3d"reason" type\x3d"button" name\x3d"submitFlag" value\x3d"Submit Flag" class\x3d"submitFlag greenButton"/\x3e\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"flagStatus"\x3e\x3cdiv class\x3d"status success"\x3e\x3cp\x3eYour flag was submitted successfully.\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"status failure"\x3e\x3cp\x3eYour flag did not submit. Please try again later.\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});"undefined"==typeof templates.fourSq.explore.shared&&(templates.fourSq.explore.shared={});"undefined"==typeof templates.fourSq.explore.shared.config&&(templates.fourSq.explore.shared.config={});
templates.fourSq.explore.shared.config.script=function(a,b){return'\x3cscript type\x3d"text/javascript"\x3efourSq.config.explore \x3d {};'+(a.queryData?"fourSq.config.explore.queryData \x3d "+a.queryData+";":"")+(a.response&&a.rid?"fourSq.config.explore.rid \x3d '"+soy.$$escapeJsString(a.rid)+"'; fourSq.config.explore.response \x3d "+a.response+";":"")+(a.errorMeta?"fourSq.config.explore.errorMeta \x3d "+a.errorMeta+";":"")+(a.geoOverride?"fourSq.config.explore.geoOverride \x3d "+a.geoOverride+";":
"")+(a.noPermalinkOnInitialRender?"fourSq.config.explore.noPermalinkOnInitialRender \x3d true;":"")+(a.venueRef?"fourSq.config.explore.venueRef \x3d "+a.venueRef+";":"")+(a.respondToSuggestedBounds?"fourSq.config.explore.respondToSuggestedBounds \x3d true;":"")+(a.useNewEndpoint?"fourSq.config.explore.useNewEndpoint \x3d true;":"")+"\x3c/script\x3e"};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});"undefined"==typeof templates.fourSq.explore.filters&&(templates.fourSq.explore.filters={});
templates.fourSq.explore.filters.categoryDisplayName=function(a,b){a=a||{};var c="";switch(a.category){case "food":c+="Food";break;case "coffee":c+="Coffee";break;case "drinks":c+="Nightlife";break;case "shops":c+="Shopping";break;case "arts":c+="Arts";break;case "sights":c+="Sights";break;case "outdoors":c+="Outdoors";break;case "trending":c+="Trending";break;case "saved":c+="Saved";break;case "bestNearby":c+="Best Nearby";break;case "newVenues":c+="Recently Opened";break;case "specials":c+="Specials";
break;default:c+="Best Nearby"}return c};templates.fourSq.explore.filters.shareTrigger=function(a,b){return'\x3cimg width\x3d"16" height\x3d"16" src\x3d"'+soy.$$escapeHtml(fourSq.retina.isRetina()?"https://ss1.4sqi.net/img/linkIcon_16@2x-764351037c986694cdef6f0de193ae42.png":"https://ss0.4sqi.net/img/linkIcon_16-c45db3b0951cacfca870739ed89e33e1.png")+'" data-retina-url\x3d"'+soy.$$escapeHtml("https://ss1.4sqi.net/img/linkIcon_16@2x-764351037c986694cdef6f0de193ae42.png")+'" alt\x3d"Copy link" /\x3e'};
templates.fourSq.explore.filters.spellCorrection=function(a,b){return a.useNewEndpoint?(null==a.spellCorrection?0:null==a.spellCorrection.correction?0:a.spellCorrection.correction.message)&&(null==a.spellCorrection?0:null==a.spellCorrection.escapeHatch?0:a.spellCorrection.escapeHatch.message)?'\x3cspan class\x3d"escapeHatchTrigger link"\x3e'+helpers.entities.textWithEntities(a.spellCorrection.escapeHatch.message)+"\x3c/span\x3e":(null==a.spellCorrection?0:null==a.spellCorrection.suggestion?0:a.spellCorrection.suggestion.message)?
'\x3cspan class\x3d"suggestionTrigger link"\x3e'+helpers.entities.textWithEntities(a.spellCorrection.suggestion.message)+"\x3c/span\x3e":"":a.spellCorrection&&a.spellCorrection.suggestion&&a.spellCorrection.suggestion.message?'\x3cspan\x3eDid you mean \x3cspan class\x3d"suggestionTrigger link"\x3e'+helpers.entities.textWithEntities(a.spellCorrection.suggestion.message)+"\x3c/span\x3e?\x3c/span\x3e":a.spellCorrection&&a.spellCorrection.correction&&a.spellCorrection.correction.message?'\x3cspan class\x3d"escapeHatch"\x3eSearch instead for \x3cspan class\x3d"escapeHatchTrigger link"\x3e'+
helpers.entities.textWithEntities(a.spellCorrection.escapeHatch.message)+"\x3c/span\x3e?\x3c/span\x3e":""};
templates.fourSq.explore.filters.resultsSummaryMessage=function(a,b){var c="",d=a.term?soy.$$escapeHtml(a.term):templates.fourSq.explore.filters.categoryDisplayName(a);return c+="\x3cspan\x3e"+(a.venueRef&&"similar"==a.category?0==a.count?"Sorry! No suggestions for place similar to "+helpers.venue.nameWithLink({venue:a.venueRef,target:"_blank"}):"Suggestions for places similar to "+helpers.venue.nameWithLink({venue:a.venueRef,target:"_blank"}):a.venueRef&&"nextVenues"==a.category?0==a.count?"Sorry! No suggestions for place to go after "+
helpers.venue.nameWithLink({venue:a.venueRef,target:"_blank"}):"Suggestions for places to go after "+helpers.venue.nameWithLink({venue:a.venueRef,target:"_blank"}):a.venueRef?0==a.count?'Sorry! No results for \x3cspan class\x3d"searchTerm"\x3e'+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+"\x3c/span\x3e":'Suggestions for \x3cspan class\x3d"searchTerm"\x3e'+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?
d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+"\x3c/span\x3e near "+helpers.venue.nameWithLink({venue:a.venueRef,target:"_blank"}):0==a.count?'Sorry! No results for \x3cspan class\x3d"searchTerm"\x3e'+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+"\x3c/span\x3e":a.locationString?'Suggestions for \x3cspan class\x3d"searchTerm"\x3e'+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?
d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+'\x3c/span\x3e near \x3cspan class\x3d"location"\x3e'+soy.$$escapeHtml(a.locationString)+"\x3c/span\x3e":'Suggestions for \x3cspan class\x3d"searchTerm"\x3e'+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+"\x3c/span\x3e")+"\x3c/span\x3e"};
templates.fourSq.explore.filters.resultsSummarySpellingCorrectionMessage=function(a,b){return a.spellCorrection&&a.spellCorrection.correction&&a.spellCorrection.correction.message?"\x3cspan\x3e"+(a.useNewEndpoint?"\x3cspan\x3e"+helpers.entities.textWithEntities(a.spellCorrection.correction.message)+"\x3c/span\x3e":'Showing results for \x3cspan class\x3d"spellCorrection"\x3e'+helpers.entities.textWithEntities(a.spellCorrection.correction.message)+"\x3c/span\x3e")+"\x3c/span\x3e":""};
templates.fourSq.explore.filters.filterControls=function(a,b){return'\x3cdiv class\x3d"suggestionGrouping"\x3e\x3cdiv id\x3d"messageBar"\x3e\x3ch1 class\x3d"message"\x3e'+(a.term||a.category?templates.fourSq.explore.filters.resultsSummaryMessage(a):"")+'\x3c/h1\x3e\x3cdiv class\x3d"share" title\x3d"Share this Explore search"\x3e'+templates.fourSq.explore.filters.shareTrigger(a)+'\x3c/div\x3e\x3cdiv class\x3d"spelling"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"newFilterControls"\x3e\x3ch5 class\x3d"headerVisible"\x3eShow me:\x3c/h5\x3e\x3cul class\x3d"chips"\x3e\x3c/ul\x3e\x3c/div\x3e'};
templates.fourSq.explore.filters.specialsFilterChip=function(a,b){return'\x3cli class\x3d"chip"\x3e\x3cspan\x3eSpecials\x3c/span\x3e\x3c/li\x3e'};templates.fourSq.explore.filters.specialsFilterChipFlyout=function(a,b){return"\x3cdiv\x3eClick to see places offering specials.\x3c/div\x3e"};templates.fourSq.explore.filters.openNowFilterChip=function(a,b){return'\x3cli class\x3d"chip"\x3e\x3cspan\x3eOpen Now\x3c/span\x3e\x3c/li\x3e'};
templates.fourSq.explore.filters.openNowFilterChipFlyout=function(a,b){return"\x3cdiv\x3eClick to see what's open now.\x3c/div\x3e"};templates.fourSq.explore.filters.likedFilterChip=function(a,b){return'\x3cli class\x3d"chip"\x3e\x3cspan\x3eLiked\x3c/span\x3e\x3c/li\x3e'};templates.fourSq.explore.filters.likedFilterChipFlyout=function(a,b){return"\x3cdiv\x3eClick to see places you've liked.\x3c/div\x3e"};templates.fourSq.explore.filters.savedFilterChip=function(a,b){return'\x3cli class\x3d"chip"\x3e\x3cspan\x3eSaved\x3c/span\x3e\x3c/li\x3e'};
templates.fourSq.explore.filters.savedFilterChipFlyout=function(a,b){return"\x3cdiv\x3eClick to see places you've saved to your lists.\x3c/div\x3e"};templates.fourSq.explore.filters.friendsBeenFilterChip=function(a,b){return'\x3cli class\x3d"chip"\x3e\x3cspan\x3eSwarm Friends\x3c/span\x3e\x3c/li\x3e'};templates.fourSq.explore.filters.friendsBeenFilterChipFlyout=function(a,b){return'\x3cdiv class\x3d"friendsBeen"\x3e\x3cdiv\x3eClick to see places your \x3ca href\x3d"https://www.swarmapp.com" target\x3d"_blank"\x3eSwarm\x3c/a\x3e friends have checked in to\x3c/div\x3e'};
templates.fourSq.explore.filters.followingBeenFilterChip=function(a,b){return'\x3cli class\x3d"chip"\x3e\x3cspan\x3eFollowing\x3c/span\x3e\x3c/li\x3e'};templates.fourSq.explore.filters.followingBeenFilterChipFlyout=function(a,b){return"\x3cdiv\x3e\x3cdiv\x3eClick to see places recommended by people you follow.\x3c/div\x3e"};templates.fourSq.explore.filters.beenHereFilterChipValue=function(a,b){a=a||{};return"\x3cspan\x3e"+("old"==a.novelty?"Been Before":"Haven't Been")+"\x3c/span\x3e"};
templates.fourSq.explore.filters.beenHereFilterChip=function(a,b){return'\x3cli class\x3d"chip"\x3e'+templates.fourSq.explore.filters.beenHereFilterChipValue(a)+"\x3c/li\x3e"};
templates.fourSq.explore.filters.beenHereFilterChipFlyout=function(a,b){return'\x3cdiv class\x3d"beenHere"\x3e\x3cdiv class\x3d"intro"\x3eSee only places you haven\'t checked in to before,\x3cbr/\x3eor only places you have checked in to.\x3c/div\x3e\x3cdiv class\x3d"settings"\x3e\x3cdiv class\x3d"grouping"\x3e\x3cdiv class\x3d"multi"\x3e\x3cdiv class\x3d"option first haventBeen"\x3e'+templates.fourSq.explore.filters.beenHereFilterChipValue({novelty:"new"})+'\x3c/div\x3e\x3cdiv class\x3d"option last haveBeen"\x3e'+
templates.fourSq.explore.filters.beenHereFilterChipValue({novelty:"old"})+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"};templates.fourSq.explore.filters.priceFilterValue=function(a,b){a=a||{};var c="\x3cspan\x3e";if(a.prices&&0<a.prices.length)for(var d=a.prices,e=d.length,f=0;f<e;f++){var g=d[f],c=c+(0!=f?", ":"");switch(g){case 1:c+=" $";break;case 2:c+=" $$";break;case 3:c+=" $$$";break;case 4:c+=" $$$$"}}else c+="Price";return c+"\x3c/span\x3e"};
templates.fourSq.explore.filters.priceFilterChip=function(a,b){return'\x3cli class\x3d"chip"\x3e'+templates.fourSq.explore.filters.priceFilterValue(a)+"\x3c/li\x3e"};templates.fourSq.explore.filters.priceFilterChipFlyout=function(a,b){return'\x3cdiv class\x3d"price"\x3e\x3cdiv class\x3d"intro"\x3eWhat\'s your price range?\x3c/div\x3e\x3cdiv class\x3d"settings"\x3e\x3cdiv class\x3d"grouping"\x3e\x3cdiv class\x3d"multi"\x3e\x3cdiv data-price-field\x3d"1" class\x3d"link clear option first"\x3e$\x3c/div\x3e\x3cdiv data-price-field\x3d"2" class\x3d"link one option"\x3e$$\x3c/div\x3e\x3cdiv data-price-field\x3d"4" class\x3d"link three option"\x3e$$$\x3c/div\x3e\x3cdiv data-price-field\x3d"8" class\x3d"link four option last"\x3e$$$$\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});"undefined"==typeof templates.fourSq.explore.shared&&(templates.fourSq.explore.shared={});"undefined"==typeof templates.fourSq.explore.shared.head&&(templates.fourSq.explore.shared.head={});templates.fourSq.explore.shared.head.termPart=function(a,b){a=a||{};return a.queryTerm?soy.$$escapeHtml(a.queryTerm):templates.fourSq.explore.filters.categoryDisplayName({category:a.section})};
templates.fourSq.explore.shared.head.metaDescription=function(a,b){return function(){var b="";if(!a.near&&!a.venueRef||a.isBot&&a.isLocationIPBased||!a.resultCount)if(a.isBot&&a.isLocationIPBased&&a.queryTerm)var d=templates.fourSq.explore.shared.head.termPart(a),b=b+("Foursquare's recommendations for "+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+" near you.");else b+="Discover great places nearby using Foursquare. Find local recommendations for food, nightlife, sights, and more.";
else{if(a.venueRef&&"similar"==a.section)b+="Foursquare's recommendations for places that are similar to "+soy.$$escapeHtml(a.venueRef.name)+", "+helpers.venue.cityState({location:a.venueRef.location})+".";else if(a.venueRef&&"nextVenues"==a.section)b+="Foursquare's recommendations for places to go after "+soy.$$escapeHtml(a.venueRef.name)+", "+helpers.venue.cityState({location:a.venueRef.location})+".";else if(a.queryTerm||a.section)if(d=templates.fourSq.explore.shared.head.termPart(a),a.venueRef)var e=
soy.$$escapeHtml(a.venueRef.name)+", "+helpers.venue.cityState({location:a.venueRef.location}),b=b+("Foursquare's recommendations for "+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+" near "+soy.$$escapeHtml(e&&e.contentKind&&e.contentKind==goog.soy.data.SanitizedContentKind.HTML?e:soydata.VERY_UNSAFE.ordainSanitizedHtml(e))+".");else a.near&&(b+="Foursquare's recommendations for "+soy.$$escapeHtml(d&&d.contentKind&&
d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+" in "+soy.$$escapeHtml(a.near)+".");else a.venueRef?(d=soy.$$escapeHtml(a.venueRef.name)+", "+helpers.venue.cityState({location:a.venueRef.location}),b+="Foursquare's recommendations for food, nightlife, sights, and more near "+soy.$$escapeHtml(function(a){return a&&a.contentKind&&a.contentKind==goog.soy.data.SanitizedContentKind.HTML?a:soydata.VERY_UNSAFE.ordainSanitizedHtml(a)}(d&&d.contentKind&&
d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d)))+"."):a.near&&(b+="Foursquare's recommendations for food, nightlife, sights, and more in "+soy.$$escapeHtml(a.near)+".");b+=" Places like ";d=Math.min(5,a.resultCount);for(e=0;e<d;e++)b+=soy.$$escapeHtml(a.topResultNames[e])+(e!=d-1?", ":"");b+=d>a.resultCount?" and more.":""}return b}()};
templates.fourSq.explore.shared.head.title=function(a,b){a=a||{};var c="",d=templates.fourSq.explore.shared.head.termPart(a);return c+=a.venueRef&&"similar"==a.section?"Places similar to "+soy.$$escapeHtml(a.venueRef.name)+", "+helpers.venue.cityState({location:a.venueRef.location}):a.venueRef&&"nextVenues"==a.section?"Places people go to after "+soy.$$escapeHtml(a.venueRef.name)+", "+helpers.venue.cityState({location:a.venueRef.location}):a.venueRef&&a.venueRef.location?soy.$$escapeHtml(d&&d.contentKind&&
d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+" near "+soy.$$escapeHtml(a.venueRef.name)+", "+helpers.venue.cityState({location:a.venueRef.location}):a.isBot&&a.isLocationIPBased?a.queryTerm?"Find "+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+" Nearby":"Find Recommendations Nearby":a.near?soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?
d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+" "+soy.$$escapeHtml(a.near):soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))};templates.fourSq.explore.shared.head.ogImage=function(a,b){return soy.$$escapeHtml("https://ss1.4sqi.net/img/explore/fb-ogimage-44a5025d916e9b0f3a231c54a9ac91e7.png")};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});"undefined"==typeof templates.fourSq.explore.map&&(templates.fourSq.explore.map={});"undefined"==typeof templates.fourSq.explore.map.controls&&(templates.fourSq.explore.map.controls={});"undefined"==typeof templates.fourSq.explore.map.controls.locate&&(templates.fourSq.explore.map.controls.locate={});
templates.fourSq.explore.map.controls.locate.control=function(a,b){return'\x3cdiv class\x3d"leaflet-control-locate"\x3e\x3ca href\x3d"#" title\x3d"Use your current location"\x3e\x3c/a\x3e\x3c/div\x3e'};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});"undefined"==typeof templates.fourSq.explore.map&&(templates.fourSq.explore.map={});templates.fourSq.explore.map.locationNotFoundMessage=function(a,b){return"\x3cspan\x3eWe're unable to detect your current location. Try typing in your city instead.\x3c/span\x3e"};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});"undefined"==typeof templates.fourSq.explore.newresultlist&&(templates.fourSq.explore.newresultlist={});
templates.fourSq.explore.newresultlist.recommendationList=function(a,b){for(var c='\x3cul class\x3d"recommendationList"\x3e',d=a.recommendations,e=d.length,f=0;f<e;f++)c+=templates.fourSq.explore.newresultlist.singleRecommendationFromSnippet({recommendation:d[f],currentUserId:a.currentUserId,index:f+1,useNewEndpoint:a.useNewEndpoint});return c+=(a.error?-1!=a.error.errorType.indexOf("geocode_too_big")?templates.fourSq.explore.newresultlist.zoomError(null):-1!=a.error.errorType.indexOf("failed_geocode")&&
a.near?templates.fourSq.explore.newresultlist.geocodeError(a):templates.fourSq.explore.newresultlist.genericError(null):0==a.recommendations.length?templates.fourSq.explore.newresultlist.noResults(a):!a.recommendations[0].flags||a.recommendations[0].flags&&!a.recommendations[0].flags.exactMatch?5>a.recommendations.length?templates.fourSq.explore.newresultlist.fewResults(soy.$$augmentMap(a,{numResults:a.recommendations.length})):a.hasSearchTerm?templates.fourSq.explore.newresultlist.addVenueCard(null):
"":"")+"\x3c/ul\x3e"};templates.fourSq.explore.newresultlist.addVenueCard=function(a,b){return'\x3cli class\x3d"card addVenueCard"\x3e\x3cp\x3e'+templates.fourSq.explore.newresultlist.addVenuePromo(null)+"\x3c/p\x3e\x3c/li\x3e"};templates.fourSq.explore.newresultlist.addVenuePromo=function(a,b){return'Don\'t see the place you\'re looking for? \x3cspan class\x3d"link" data-action\x3d"addVenue"\x3eAdd a new place to foursquare\x3c/a\x3e.'};
templates.fourSq.explore.newresultlist.resultsErrorSuggestions=function(a,b){a=a||{};return(a.hasFilters?'\x3cli\x3e\x3cspan class\x3d"link" data-action\x3d"removeFilters"\x3eRemoving your filters\x3c/span\x3e\x3c/li\x3e':"")+'\x3cli class\x3d"zoomSuggestion"\x3e\x3cspan class\x3d"link" data-action\x3d"zoomOut1"\x3eZooming out\x3c/span\x3e to search a bigger area\x3c/li\x3e\x3cli\x3eSearching for something more general (like \x3cspan class\x3d"link" data-action\x3d"category" data-value\x3d"food"\x3eFood\x3c/span\x3e, \x3cspan class\x3d"link" data-action\x3d"category" data-value\x3d"coffee"\x3eCoffee\x3c/span\x3e, or \x3cspan class\x3d"link" data-action\x3d"category" data-value\x3d"drinks"\x3eNightlife\x3c/span\x3e)\x3c/li\x3e'+
(a.hasSearchTerm?"\x3cli\x3eChecking your spelling\x3c/li\x3e":"")};
templates.fourSq.explore.newresultlist.fewResults=function(a,b){return'\x3cli class\x3d"card fewResults"\x3e\x3ch4\x3e'+(0==a.numResults?"No results found.":1==a.numResults?"Only 1 result? Try...":"Only "+soy.$$escapeHtml(a.numResults)+" results? Try...")+'\x3c/h4\x3e\x3cul class\x3d"suggestions"\x3e'+templates.fourSq.explore.newresultlist.resultsErrorSuggestions(a)+"\x3c/ul\x3e"+(a.hasSearchTerm?"\x3cp\x3e"+templates.fourSq.explore.newresultlist.addVenuePromo(null)+"\x3c/p\x3e":"")+"\x3c/li\x3e"};
templates.fourSq.explore.newresultlist.noResults=function(a,b){a=a||{};return'\x3cli class\x3d"card noResults"\x3e\x3ch4\x3eHmm... Try:\x3c/h4\x3e\x3cul class\x3d"suggestions"\x3e'+templates.fourSq.explore.newresultlist.resultsErrorSuggestions(a)+"\x3c/ul\x3e"+(a.hasSearchTerm?"\x3cp\x3e"+templates.fourSq.explore.newresultlist.addVenuePromo(null)+"\x3c/p\x3e":"")+"\x3c/li\x3e"};templates.fourSq.explore.newresultlist.genericError=function(a,b){return'\x3cli class\x3d"card genericError"\x3e\x3ch4\x3eWe ran into an error. Our servers might be down. Please wait a minute and \x3cspan class\x3d"link" data-action\x3d"retry"\x3etry again\x3c/span\x3e!\x3c/h4\x3e\x3c/li\x3e'};
templates.fourSq.explore.newresultlist.geocodeError=function(a,b){return'\x3cli class\x3d"card geocodeError"\x3e\x3ch4\x3eHmmm, we\'re not sure where \x3cspan class\x3d"near"\x3e'+soy.$$escapeHtml(a.near)+"\x3c/span\x3e is. Try a different location.\x3c/h4\x3e\x3c/li\x3e"};templates.fourSq.explore.newresultlist.zoomError=function(a,b){return'\x3cli class\x3d"card zoomError"\x3e\x3ch4\x3eHmm... Try:\x3c/h4\x3e\x3cp\x3e\x3cspan class\x3d"link" data-action\x3d"zoomInTillValid"\x3eZooming in\x3c/span\x3e for more results. It looks like you\'re too far out.\x3c/p\x3e\x3c/li\x3e'};
templates.fourSq.explore.newresultlist.inlineSpecial=function(a,b){return a.special?'\x3cdiv class\x3d"specialInfo '+soy.$$escapeHtml(null!=(null==a.special?null:a.special.layout)?null==a.special?null:a.special.layout:"")+(a.isPromoted?" promoted":"")+'" data-special-id\x3d"'+soy.$$escapeHtml(a.special.id)+'"'+("load-to-card"==(null==a.special?null:a.special.redemption)?'data-special-redemption\x3d"'+soy.$$escapeHtml(a.special.redemption)+'"':"")+"\x3e"+(a.special.title?'\x3ch5 class\x3d"specialType"\x3e'+
soy.$$escapeHtml(a.special.title)+(a.special.provider&&a.special.iconUrl?' \x3cspan class\x3d"providerAttribution"\x3efrom\x3cimg src\x3d"'+helpers.image.nearestBigger(soy.$$augmentMap(a.special.iconUrl,{desiredSize:75}))+'" alt\x3d"provided by" /\x3e\x3c/span\x3e':"")+"\x3c/h5\x3e":"")+(a.special.message?'\x3cdiv class\x3d"message"\x3e\x3cp\x3e'+soy.$$escapeHtml(a.special.message)+"\x3c/p\x3e\x3c/div\x3e":"")+"\x3c/div\x3e":""};
templates.fourSq.explore.newresultlist.featuredPhoto=function(a,b){return'\x3cdiv class\x3d"photoContainer"\x3e'+helpers.photo.img300x300(soy.$$augmentMap(a.photo,{extraImgClass:"photo"}))+"\x3c/div\x3e"};templates.fourSq.explore.newresultlist.hasFeaturedPhotoFromSnippets=function(a,b){return a.recommendation.photo?"true":"false"};
templates.fourSq.explore.newresultlist.hasInfoBlockContentFromSnippet=function(a,b){a=a||{};return(null==a.primarySnippet?0:null==a.primarySnippet.detail?0:a.primarySnippet.detail.type)?"true":"false"};
templates.fourSq.explore.newresultlist.singleRecommendationFromSnippet=function(a,b){var c="",d=a.recommendation.snippets,e="facePile"==(null==d?null:null==d.items?null:null==d.items[0]?null:null==d.items[0].detail?null:d.items[0].detail.type),f=e?null==d?null:null==d.items?null:null==d.items[0]?null:null==d.items[0].detail?null:d.items[0].detail.object:null==d?null:null==d.items?null:null==d.items[0]?null:null==d.items[0].reason?null:d.items[0].reason.facePile,g=e?null==d?null:null==d.items?null:
d.items[1]:null==d?null:null==d.items?null:d.items[0],d=e?null==d?null:null==d.items?null:d.items[2]:null==d?null:null==d.items?null:d.items[1],e=a.recommendation.promoted,h="tip"==(null==g?null:null==g.detail?null:g.detail.type)&&(null==g?0:null==g.detail?0:null==g.detail.object?0:g.detail.object.id)?soy.$$escapeHtml(g.detail.object.id):"",k="tip"==(null==g?null:null==g.detail?null:g.detail.type)&&(null==g?0:null==g.detail?0:null==g.detail.object?0:g.detail.object.logView)?soy.$$escapeHtml(g.detail.object.logView):
"",l=templates.fourSq.explore.newresultlist.hasFeaturedPhotoFromSnippets(a),m=templates.fourSq.explore.newresultlist.hasInfoBlockContentFromSnippet({primarySnippet:g}),p=0<(null!=(null==f?null:f.items)?null==f?null:f.items:[]).length&&(1!=(null!=(null==f?null:f.items)?null==f?null:f.items:[]).length||(null==f?null:null==f.items?null:f.items[0].user.id)!=a.currentUserId)?"true":"false";return c+='\x3cli class\x3d"card singleRecommendation'+("true"==l?" hasPhoto":"")+("true"==p?" hasFacepile":"")+(e?
" promoted":"")+("false"==m?" noDetails":"")+(k?" tipWithLogging":"")+'" data-id\x3d"'+soy.$$escapeHtml(a.recommendation.venue.id)+'" '+(h?'data-tipid\x3d"'+soy.$$escapeHtml(h)+'"':"")+'\x3e\x3cdiv class\x3d"indexCol"\x3e\x3cspan class\x3d"venueIndex"\x3e'+soy.$$escapeHtml(a.index)+'.\x3c/span\x3e\x3cdiv class\x3d"outOfBoundsContainer"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"contentHolder"\x3e\x3cdiv class\x3d"infoCol"\x3e'+templates.fourSq.explore.newresultlist.venueBlock_({index:a.index,venue:a.recommendation.venue,
isPromoted:e})+templates.fourSq.explore.newresultlist.reasonBlock_({primarySnippet:g})+templates.fourSq.explore.newresultlist.infoBlockFromSnippet_({recommendation:a.recommendation,primarySnippet:g,secondarySnippet:d,useNewEndpoint:a.useNewEndpoint})+templates.fourSq.explore.newresultlist.infoBlockFooterFromSnippet_({facepile:f,primarySnippet:g,hfacepile:p,recommendation:a.recommendation,currentUserId:a.currentUserId})+'\x3c/div\x3e\x3cdiv class\x3d"photoCol"\x3e'+("true"==l?templates.fourSq.explore.newresultlist.featuredPhoto({photo:a.recommendation.photo}):
"")+"\x3c/div\x3e"+templates.fourSq.explore.newresultlist.debugBlock_(a)+"\x3c/div\x3e\x3c/li\x3e"};
templates.fourSq.explore.newresultlist.debugBlock_=function(a,b){var c="",d=null!=a.recommendation.extendedReason?a.recommendation.extendedReason:a.recommendation.scoreDebug;if(d){c+='\x3cdiv class\x3d"debugInfo"\x3e\x3cdiv\x3e\x3cstrong\x3eScore\x3c/strong\x3e: '+soy.$$escapeHtml(d.score)+"\x3c/div\x3e\x3cdiv\x3e\x3cb\x3eDetails\x3c/b\x3e: "+soy.$$escapeHtml(d.details)+"\x3cbr/\x3e";if(d.children){for(var c=c+"\x3cul\x3e",d=d.children.items,e=d.length,f=0;f<e;f++){var g=d[f],c=c+("\x3cli\x3e"+soy.$$escapeHtml(g.name)+
": "+soy.$$escapeHtml(g.score)+" ("+soy.$$escapeHtml(g.details)+")");if(g.children){for(var c=c+"\x3cul\x3e",g=g.children.items,h=g.length,k=0;k<h;k++)var l=g[k],c=c+("\x3cli\x3e"+soy.$$escapeHtml(l.name)+": "+soy.$$escapeHtml(l.score)+" ("+soy.$$escapeHtml(l.details)+")");c+="\x3c/ul\x3e"}c+="\x3c/li\x3e"}c+="\x3c/ul\x3e"}c+="\x3c/div\x3e\x3c/div\x3e"}return c};
templates.fourSq.explore.newresultlist.maybeVenueRating=function(a,b){a=a||{};return a.rating?'\x3cdiv class\x3d"venueScore '+helpers.venue.ratingClass(a)+'" title\x3d"'+helpers.venue.ratingRounded(a)+"/10 - "+helpers.venue.ratingDescription(a)+'"\x3e'+helpers.venue.ratingRounded(a)+"\x3c/div\x3e":'\x3cdiv class\x3d"venueScore unknown"\x3e?\x3c/div\x3e'};
templates.fourSq.explore.newresultlist.venueName=function(a,b){return'\x3cdiv class\x3d"venueName"\x3e\x3ch2\x3e'+helpers.venue.nameWithLink({venue:a.venue,target:"_blank"})+"\x3c/h2\x3e"+(a.isPromoted?'\x3cspan class\x3d"promoted"\x3e\x3cimg class\x3d"promotedIcon" src\x3d"'+soy.$$escapeHtml("https://ss1.4sqi.net/img/explore/promotedbolt-2174e590436adf67e941bcdbdc5463b8.png")+'" /\x3e\x3cspan class\x3d"text"\x3ePromoted\x3c/span\x3e\x3c/span\x3e':null!=(null==a.venue?null:null==a.venue.specials?
null:a.venue.specials.count)&&(null==a.venue?0:null==a.venue.specials?0:a.venue.specials.count)?'\x3cspan class\x3d"special"\x3e\x3cimg class\x3d"specialIcon" src\x3d"'+soy.$$escapeHtml("https://ss0.4sqi.net/img/specials/default-3a21958f7b88f32bc48378b3534c9a0b.png")+'" /\x3e\x3cspan class\x3d"text"\x3eSpecial\x3c/span\x3e\x3c/span\x3e':"")+"\x3c/div\x3e"};
templates.fourSq.explore.newresultlist.venueAddress=function(a,b){return'\x3cdiv class\x3d"venueAddress"\x3e'+helpers.venue.addressWithCross(a.venue)+"\x3c/div\x3e"};templates.fourSq.explore.newresultlist.venueCategory=function(a,b){return a.venue.categories[0]?'\x3cspan class\x3d"venueDataItem"\x3e\x3cspan class\x3d"categoryName"\x3e'+soy.$$escapeHtml(a.venue.categories[0].shortName)+'\x3c/span\x3e\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e':'\x3cspan class\x3d"venueDataItem"\x3eUncategorized\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e'};
templates.fourSq.explore.newresultlist.venueHereNow=function(a,b){return a.venue.hereNow&&0<a.venue.hereNow.count?'\x3cspan class\x3d"hereNow venueDataItem"\x3e\x3cimg src\x3d"'+soy.$$escapeHtml("https://ss1.4sqi.net/img/hereNow-38998e12a899bf8590cbbf0f98aa486e.png")+'" data-retina-url\x3d"'+soy.$$escapeHtml("https://ss0.4sqi.net/img/hereNow@2x-6d6aafcd9f837d5594b6f6a5c5760628.png")+'"'+(a.venue.hereNow.summary?'alt\x3d"'+soy.$$escapeHtml(a.venue.hereNow.summary)+'"':"")+'width\x3d"12" height\x3d"12" /\x3e'+
(1==a.venue.hereNow.count?"1":soy.$$escapeHtml(a.venue.hereNow.count))+'\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e':""};templates.fourSq.explore.newresultlist.venuePrice=function(a,b){return a.venue.price&&a.venue.price.tier&&0<a.venue.price.tier?'\x3cspan class\x3d"venueDataItem"\x3e'+helpers.venue.price(a.venue.price)+'\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e':""};
templates.fourSq.explore.newresultlist.venueMenu=function(a,b){return(null==a.venue.menu?0:a.venue.menu.url)?'\x3cspan class\x3d"linkToMenu venueDataItem"\x3e'+helpers.venue.menuLink(soy.$$augmentMap(a.venue.menu,{target:"_blank",spanLink:!0}))+'\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e':""};
templates.fourSq.explore.newresultlist.venueEditor=function(a,b){return a.venue.deficiencies?'\x3cspan class\x3d"linkToEditor venueDataItem"\x3eEdit\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e':""};
templates.fourSq.explore.newresultlist.venueBlock_=function(a,b){return'\x3cdiv class\x3d"venueBlock"\x3e\x3cdiv class\x3d"venueDetails"\x3e'+templates.fourSq.explore.newresultlist.venueName(a)+'\x3cdiv class\x3d"venueMeta"\x3e'+templates.fourSq.explore.newresultlist.maybeVenueRating({rating:a.venue.rating})+'\x3cdiv class\x3d"venueAddressData"\x3e'+templates.fourSq.explore.newresultlist.venueAddress(a)+'\x3cdiv class\x3d"venueData"\x3e'+templates.fourSq.explore.newresultlist.venueCategory(a)+templates.fourSq.explore.newresultlist.venueHereNow(a)+
templates.fourSq.explore.newresultlist.venuePrice(a)+templates.fourSq.explore.newresultlist.venueMenu(a)+templates.fourSq.explore.newresultlist.venueEditor(a)+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"};
templates.fourSq.explore.newresultlist.reusableTipBlock_=function(a,b){var c="";if(0<a.tips.length){for(var c=c+('\x3cdiv class\x3d"detail tips '+soy.$$escapeHtml(null!=a.extraClass?a.extraClass:"")+'"\x3e\x3cul class\x3d"tips"\x3e'),d=a.tips,e=d.length,f=0;f<e;f++)var g=d[f],h=a.useNewEndpoint&&"merchant_special"==g.type,c=c+('\x3cli class\x3d"tip'+(h?" special":"")+'"\x3e'+(h?'\x3cdiv class\x3d"specialAvatar"\x3e\x3cimg alt\x3d"" src\x3d"'+soy.$$escapeHtml("https://ss0.4sqi.net/img/specials/default-3a21958f7b88f32bc48378b3534c9a0b.png")+
'" /\x3e\x3c/div\x3e':g.user?'\x3cdiv class\x3d"avatar"\x3e'+helpers.user.mediumImage(g.user)+"\x3c/div\x3e":"")+'\x3cp class\x3d"tipText"\x3e'+(g.user?h&&(null==g.user.publisherLogo?0:g.user.publisherLogo.fullPath)?'\x3cimg alt\x3d"" class\x3d"specialProviderLogo" src\x3d"'+soy.$$escapeHtml(g.user.publisherLogo.fullPath)+'" /\x3e':'\x3cspan class\x3d"tipAuthor '+(g.user.relationship?soy.$$escapeHtml(g.user.relationship):"")+'"\x3e\x3ca class\x3d"userName" href\x3d"'+helpers.user.href(g.user)+'" target\x3d"_blank"\x3e'+
helpers.user.shortName(g.user)+"\x3c/a\x3e \x26bull; "+helpers.util.createdAtSmartDate(g)+"\x3c/span\x3e":"")+helpers.entities.renderEntitiesViaTags({input:g,dataSource:"tip-text",asLinks:!0})+"\x3c/p\x3e\x3c/li\x3e");c+="\x3c/ul\x3e\x3c/div\x3e"}return c};
templates.fourSq.explore.newresultlist.menuBlock_=function(a,b){return'\x3cdiv class\x3d"detail menu"\x3e\x3cdiv class\x3d"menuIcon link"\x3e\x3cimg src\x3d"'+soy.$$escapeHtml("https://ss1.4sqi.net/img/icon-menu-f1674d6544f5111a62cc947f18bbcbde.png")+'" alt\x3d"" /\x3e\x3c/div\x3e\x3cp class\x3d"menuContent"\x3e'+helpers.entities.textWithEntitiesLinks({text:a.menu.text,entities:a.menu.entities,dataSource:"menu-match"})+"\x3c/p\x3e\x3c/div\x3e"};
templates.fourSq.explore.newresultlist.hoursBlock_=function(a,b){return'\x3cdiv class\x3d"hoursSnippet"\x3e\x3cimg alt\x3d"" class\x3d"hourIcon" src\x3d"'+soy.$$escapeHtml("https://ss1.4sqi.net/img/explore/hours-clock-d79d17043626d3d659ba6ba2380712ca.png")+'" data-retina-url\x3d"'+soy.$$escapeHtml("https://ss0.4sqi.net/img/explore/hours-clock@2x-e38f17290a4e42fea9783cd488da570b.png")+'" /\x3e'+soy.$$escapeHtml(a.hours.text)+"\x3c/div\x3e"};
templates.fourSq.explore.newresultlist.compactPhrasesBlock_=function(a,b){var c="";if(0<a.phrases.length){for(var c=c+'\x3cdiv class\x3d"detail"\x3e\x3cdiv class\x3d"compact phrases"\x3ePeople talk about: ',d=a.phrases,e=d.length,f=0;f<e;f++)var g=d[f],c=c+((0!=f?",\x26nbsp;":"")+'\x3cspan class\x3d"phrase" title\x3d"\x26quot;'+soy.$$escapeHtml(g.sample.text)+"\x26quot; ("+templates.fourSq.explore.newresultlist.publicUserPhraseCount({phrase:g})+')"\x3e'+soy.$$escapeHtml(g.phrase)+"\x3c/span\x3e");
c+="\x3c/div\x3e\x3c/div\x3e"}return c};
templates.fourSq.explore.newresultlist.phrasesBlock_=function(a,b){var c="";if(0<a.phrases.length){for(var c=c+'\x3cdiv class\x3d"detail phrases"\x3e\x3cul class\x3d"phrases"\x3e',d=a.phrases,e=d.length,f=0;f<e;f++)var g=d[f],c=c+('\x3cli class\x3d"phrase"\x3e\x3cdiv class\x3d"phraseText"\x3e"'+helpers.entities.textWithEntities(g.sample)+'"\x26nbsp;\x3cspan class\x3d"tipCount"\x3e('+templates.fourSq.explore.newresultlist.publicUserPhraseCount({phrase:g})+")\x3c/span\x3e\x3c/div\x3e\x3c/li\x3e");c+=
"\x3c/ul\x3e\x3c/div\x3e"}return c};templates.fourSq.explore.newresultlist.publicUserPhraseCount=function(a,b){return 1==a.phrase.count?"1 tip":soy.$$escapeHtml(a.phrase.count)+" tips"};
templates.fourSq.explore.newresultlist.pageUpdate_=function(a,b){return'\x3cdiv class\x3d"detail broadcast" data-broadcast-id\x3d"'+soy.$$escapeHtml(a.broadcast.id)+'"\x3e\x3cdiv class\x3d"broadcastShout"\x3e'+(a.broadcast.page?'\x3ch5 class\x3d"broadcastPage"\x3e'+helpers.user.shortName(a.broadcast.page)+"\x3c/h5\x3e":"")+soy.$$escapeHtml(null==a.broadcast?null:a.broadcast.shout)+"\x3c/div\x3e\x3c/div\x3e"};
templates.fourSq.explore.newresultlist.infoBlockFooterFromSnippet_=function(a,b){return'\x3cdiv class\x3d"resultFooter"\x3e'+(a.hfacepile?templates.fourSq.venue.facepile.maybeRenderFacepile({currentUserId:a.currentUserId,friendVisits:a.facepile,maxFaces:5,includeSummaryText:!0}):"")+(a.primarySnippet||a.recommendation.photo?'\x3cdiv class\x3d"buttons"\x3e'+templates.fourSq.ui.save.saveButton({saved:!1})+"\x3c/div\x3e":"")+"\x3c/div\x3e"};
templates.fourSq.explore.newresultlist.reasonBlock_=function(a,b){a=a||{};var c="",d="venuetag"==(null==a.primarySnippet?null:null==a.primarySnippet.detail?null:a.primarySnippet.detail.type)&&(null==a.primarySnippet?0:null==a.primarySnippet.detail?0:null==a.primarySnippet.detail.object?0:a.primarySnippet.detail.object.summary)?soy.$$escapeHtml(a.primarySnippet.detail.object.summary):(null==a.primarySnippet?0:null==a.primarySnippet.reason?0:a.primarySnippet.reason.text)?soy.$$escapeHtml(a.primarySnippet.reason.text):
"";return c+=d?'\x3cdiv class\x3d"reason"\x3e'+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+"\x3c/div\x3e":""};
templates.fourSq.explore.newresultlist.infoBlockFromSnippet_=function(a,b){var c="";if("pageUpdate"==(null==a.primarySnippet?null:null==a.primarySnippet.detail?null:a.primarySnippet.detail.type))c+=((null==a.primarySnippet?0:null==a.primarySnippet.detail?0:null==a.primarySnippet.detail.object?0:a.primarySnippet.detail.object.shout)?templates.fourSq.explore.newresultlist.pageUpdate_({broadcast:a.primarySnippet.detail.object}):"")+((null==a.primarySnippet.detail.object?0:null==a.primarySnippet.detail.object.campaign?
0:a.primarySnippet.detail.object.campaign.special)?templates.fourSq.explore.newresultlist.inlineSpecial({special:a.primarySnippet.detail.object.campaign.special,isPromoted:!0}):"");else if("special"==(null==a.primarySnippet?null:null==a.primarySnippet.detail?null:a.primarySnippet.detail.type))c+=templates.fourSq.explore.newresultlist.inlineSpecial({special:a.primarySnippet.detail.object,isPromoted:(null==a.recommendation?0:null==a.recommendation.promoted?0:a.recommendation.promoted.specialId)&&(null==
a.recommendation?null:null==a.recommendation.promoted?null:a.recommendation.promoted.specialId)==a.primarySnippet.detail.object.id?!0:!1});else if("tip"==(null==a.primarySnippet?null:null==a.primarySnippet.detail?null:a.primarySnippet.detail.type)&&(null==a.primarySnippet?0:null==a.primarySnippet.detail?0:null==a.primarySnippet.detail.object?0:a.primarySnippet.detail.object.text))var d=a.primarySnippet.detail.object,c=c+templates.fourSq.explore.newresultlist.reusableTipBlock_({tips:[d],extraClass:d.id==
(null==a.recommendation?null:null==a.recommendation.promoted?null:a.recommendation.promoted.tipId)?"promotedTip":"",useNewEndpoint:a.useNewEndpoint});else"taste"==(null==a.primarySnippet?null:null==a.primarySnippet.detail?null:a.primarySnippet.detail.type)?c+=templates.fourSq.explore.newresultlist.tastesBlock_({tastes:a.primarySnippet.detail.object}):"menu"==(null==a.primarySnippet?null:null==a.primarySnippet.detail?null:a.primarySnippet.detail.type)&&(c+=templates.fourSq.explore.newresultlist.menuBlock_({menu:null==
a.primarySnippet?null:null==a.primarySnippet.detail?null:a.primarySnippet.detail.object}));d="hours"==(null==a.primarySnippet?null:null==a.primarySnippet.detail?null:a.primarySnippet.detail.type)?a.primarySnippet:"hours"==(null==a.secondarySnippet?null:null==a.secondarySnippet.detail?null:a.secondarySnippet.detail.type)?a.secondarySnippet:null;d=null==d?null:null==d.detail?null:d.detail.object;return c+=d?templates.fourSq.explore.newresultlist.hoursBlock_({hours:d}):""};
templates.fourSq.explore.newresultlist.tastesBlock_=function(a,b){for(var c='\x3cdiv class\x3d"detail tastes"\x3e\x3cul class\x3d"tastePills"\x3e',d=Math.min(a.tastes.items.length,3),e=0;e<d;e++)var f=a.tastes.items[e],c=c+('\x3cli class\x3d"tastePill'+(f.onUser?" onUser":"")+'"\x3e'+soy.$$escapeHtml(f.text)+"\x3c/li\x3e");return c+"\x3c/ul\x3e\x3c/div\x3e"};
templates.fourSq.explore.newresultlist.outOfBoundsIndicator=function(a,b){a=a||{};return'\x3cdiv class\x3d"outOfBounds '+(a.position?soy.$$escapeHtml(a.position):"")+'" title\x3d"'+("above"==a.position?"Above the current view. Click to bring in to view.":"right"==a.position?"To the right of the current view. Click to bring in to view.":"below"==a.position?"Below the current view. Click to bring in to view.":"left"==a.position?"To the left of the current view. Click to bring in to view.":"Out of view. Click to bring in to view.")+
'" /\x3e\x3c/div\x3e'};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});
templates.fourSq.explore.page=function(a,b){var c;c=null!=(null==a.response?null:null==a.response.groups?null:a.response.groups[0].items)?null==a.response?null:null==a.response.groups?null:a.response.groups[0].items:null!=(null==a.response?null:null==a.response.group?null:a.response.group.results)?null==a.response?null:null==a.response.group?null:a.response.group.results:[];return c=""+('\x3cdiv id\x3d"explore"'+(a.useNewEndpoint?' class\x3d"newEp"':"")+'\x3e\x3cdiv id\x3d"mapView"\x3e\x3cdiv id\x3d"mapCanvas"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"loadingResults"\x3eReloading results...\x3c/div\x3e\x3cdiv id\x3d"resultsContainer"\x3e\x3cdiv id\x3d"filterView"\x3e'+
templates.fourSq.explore.filters.filterControls({count:c.length,term:null==a.queryData?null:a.queryData.query,category:null==a.queryData?null:a.queryData.section,locationString:a.locationString})+'\x3c/div\x3e\x3cdiv id\x3d"resultsView"\x3e'+(a.currentUserId?"":'\x3cdiv id\x3d"signupPromptContainer" data-style\x3d"manual"\x3e\x3c/div\x3e')+'\x3cdiv id\x3d"results"\x3e'+templates.fourSq.explore.newresultlist.recommendationList({currentUserId:a.currentUserId,recommendations:c,hasSearchTerm:a.queryData.query?
!0:!1,error:a.errorMeta,near:null==a.queryData?null:a.queryData.near,useNewEndpoint:a.useNewEndpoint})+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"+templates.fourSq.explore.shared.config.script(a)+'\x3cscript type\x3d"text/javascript"\x3efourSq.views.ExplorePage.init();\x3c/script\x3e')};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});"undefined"==typeof templates.fourSq.explore.map&&(templates.fourSq.explore.map={});"undefined"==typeof templates.fourSq.explore.map.controls&&(templates.fourSq.explore.map.controls={});"undefined"==typeof templates.fourSq.explore.map.controls.requery&&(templates.fourSq.explore.map.controls.requery={});
templates.fourSq.explore.map.controls.requery.control=function(a,b){return'\x3cdiv class\x3d"leaflet-control-requery"\x3e\x3ca href\x3d"#"\x3e\x3c/a\x3e\x3cspan\x3eSearch this area\x3c/span\x3e\x3c/div\x3e'};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});"undefined"==typeof templates.fourSq.explore.share&&(templates.fourSq.explore.share={});
templates.fourSq.explore.share.flyout=function(a,b){return'\x3cdiv id\x3d"shareFlyout"\x3e\x3cdiv class\x3d"intro"\x3e\x3cstrong\x3eHelp your friends find great places!\x3c/strong\x3e\x3cbr /\x3eShare the link to this Explore search:\x3c/div\x3e\x3cdiv class\x3d"shareURL"\x3e\x3cinput type\x3d"text" class\x3d"url formStyle" /\x3e\x3clabel class\x3d"shortenLabel"\x3e\x3cinput type\x3d"checkbox" name\x3d"shorten" class\x3d"shorten" /\x3eShorten Link\x3c/label\x3e\x3c/div\x3e\x3cdiv class\x3d"shareSocial"\x3e'+templates.fourSq.ui.sharesocial.sidebar({dontShareFoursquare:!0,
dontShareEmail:!0})+"\x3c/div\x3e\x3c/div\x3e"};
templates.fourSq.explore.share.tweetText=function(a,b){a=a||{};var c="",d=templates.fourSq.explore.shared.head.termPart(a),e=a.venueRef&&a.venueRef.location?soy.$$escapeHtml(a.venueRef.name)+", "+helpers.venue.cityState({location:a.venueRef.location}):soy.$$escapeHtml(a.near);return c+=a.venueRef&&a.venueRef.location&&"similar"==a.section?"Check out places that are similar to "+soy.$$escapeHtml(a.venueRef.name)+".":a.venueRef&&a.venueRef.location&&"nextVenues"==a.section?"Check out places to go after "+
soy.$$escapeHtml(a.venueRef.name)+".":a.near||a.venueRef&&a.venueRef.location?"Check out these recommendations for "+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+" near "+soy.$$escapeHtml(e&&e.contentKind&&e.contentKind==goog.soy.data.SanitizedContentKind.HTML?e:soydata.VERY_UNSAFE.ordainSanitizedHtml(e))+".":"Check out these recommendations for "+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?
d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+"."};
templates.fourSq.explore.share.facebookText=function(a,b){a=a||{};var c="",d=templates.fourSq.explore.shared.head.termPart(a),e=a.venueRef&&a.venueRef.location?soy.$$escapeHtml(a.venueRef.name)+", "+helpers.venue.cityState({location:a.venueRef.location}):soy.$$escapeHtml(a.near);return c+=a.venueRef&&a.venueRef.location&&"similar"==a.section?"Foursquare Explore recommendations for places that are similar to "+soy.$$escapeHtml(a.venueRef.name)+".":a.venueRef&&a.venueRef.location&&"nextVenues"==a.section?
"Foursquare Explore recommendations for places to go after "+soy.$$escapeHtml(a.venueRef.name)+".":a.near||a.venueRef&&a.venueRef.location?"Foursquare Explore recommendations for "+soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+" near "+soy.$$escapeHtml(e&&e.contentKind&&e.contentKind==goog.soy.data.SanitizedContentKind.HTML?e:soydata.VERY_UNSAFE.ordainSanitizedHtml(e))+".":"Foursquare Explore recommendations for "+
soy.$$escapeHtml(d&&d.contentKind&&d.contentKind==goog.soy.data.SanitizedContentKind.HTML?d:soydata.VERY_UNSAFE.ordainSanitizedHtml(d))+"."};templates.fourSq.explore.share.facebookTitle=function(a,b){return"Foursquare Explore Recommendations"};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.explore&&(templates.fourSq.explore={});"undefined"==typeof templates.fourSq.explore.tooltips&&(templates.fourSq.explore.tooltips={});
templates.fourSq.explore.tooltips.mapVenueTooltip=function(a,b){return'\x3cdiv class\x3d"mapVenueTooltip '+(a.pinType?soy.$$escapeHtml(a.pinType):"")+'"\x3e\x3cspan class\x3d"tooltipCarat"\x3e\x3c/span\x3e\x3cdiv class\x3d"venueBlock"\x3e\x3cdiv class\x3d"venueIcon"\x3e\x3cimg src\x3d\''+helpers.category.thumbnail(a.venue.categories[0])+'\' class\x3d"icon" /\x3e\x3cspan class\x3d"venueIndex"\x3e'+soy.$$escapeHtml(a.index)+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"venueDetails"\x3e\x3cdiv class\x3d"venueName"\x3e'+
helpers.venue.nameWithLink({venue:a.venue,target:"_blank"})+(a.isPromoted?'\x3cspan class\x3d"promoted"\x3e\x3cimg class\x3d"promotedIcon" src\x3d"'+soy.$$escapeHtml("https://ss1.4sqi.net/img/explore/promotedbolt-2174e590436adf67e941bcdbdc5463b8.png")+'" /\x3e\x3cspan class\x3d"text"\x3ePromoted\x3c/span\x3e\x3c/span\x3e':"")+"\x3c/div\x3e"+(a.venue.rating?'\x3cdiv class\x3d"venueScore '+helpers.venue.ratingClass({rating:a.venue.rating})+'"\x3e'+helpers.venue.ratingRounded({rating:a.venue.rating})+
"\x3c/div\x3e":"")+'\x3cdiv class\x3d"venueAddressData"\x3e\x3cdiv class\x3d"venueAddress"\x3e'+helpers.venue.addressWithCross(a.venue)+'\x3c/div\x3e\x3cdiv class\x3d"venueData"\x3e'+(a.venue.categories[0]?'\x3cspan class\x3d"venueDataItem"\x3e\x3cspan class\x3d"categoryName"\x3e'+soy.$$escapeHtml(a.venue.categories[0].shortName)+'\x3c/span\x3e\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e':'\x3cspan class\x3d"venueDataItem"\x3eUncategorized\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e')+
(a.venue.price&&a.venue.price.tier&&0<a.venue.price.tier?'\x3cspan class\x3d"venueDataItem"\x3e'+helpers.venue.price(a.venue.price)+'\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e':"")+((null==a.venue.menu?0:a.venue.menu.url)?'\x3cspan class\x3d"linkToMenu venueDataItem"\x3e'+helpers.venue.menuLink(soy.$$augmentMap(a.venue.menu,{target:"_blank"}))+'\x3cspan class\x3d"delim"\x3e \x26bull; \x3c/span\x3e\x3c/span\x3e':"")+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"+(a.reason.message?
'\x3cspan class\x3d"reasonMsg"\x3e'+soy.$$escapeHtml(a.reason.message)+"\x3c/span\x3e":a.reason.summary?'\x3cspan class\x3d"reasonMsg"\x3e'+soy.$$escapeHtml(a.reason.summary)+"\x3c/span\x3e":"")+templates.fourSq.explore.tooltips.specials(a)+"\x3c/div\x3e"};
templates.fourSq.explore.tooltips.specials=function(a,b){var c="";if(a.venue.specials&&a.venue.specials.items&&0<a.venue.specials.items.length)var d=a.venue.specials.items[0],c=c+('\x3cdiv class\x3d"specialInfo '+soy.$$escapeHtml(null!=(null==d?null:d.layout)?null==d?null:d.layout:"")+'" data-special-id\x3d"'+soy.$$escapeHtml(d.id)+'"'+("load-to-card"==(null==d?null:d.redemption)?'data-special-redemption\x3d"'+soy.$$escapeHtml(d.redemption)+'"':"")+"\x3e"+(d.title?'\x3ch5 class\x3d"specialType"\x3e'+
soy.$$escapeHtml(d.title)+"\x3c/h5\x3e":"")+(d.icon?'\x3cimg class\x3d"icon" src\x3d"'+helpers.special.iconUrl(d)+'" /\x3e':"")+(d.message?'\x3cdiv class\x3d"message"\x3e\x3cp\x3e'+soy.$$escapeHtml(d.message)+"\x3c/p\x3e\x3c/div\x3e":"")+"\x3c/div\x3e");else a.useNewEndpoint&&a.specialTip&&(c+='\x3cdiv class\x3d"specialInfo" data-special-id\x3d"'+soy.$$escapeHtml(a.specialTip.id)+'"\x3e\x3ch5 class\x3d"specialType"\x3eSpecial\x3c/h5\x3e\x3cimg class\x3d"icon" alt\x3d"" src\x3d"'+soy.$$escapeHtml("https://ss0.4sqi.net/img/specials/default-3a21958f7b88f32bc48378b3534c9a0b.png")+
'" /\x3e\x3cdiv class\x3d"message"\x3e\x3cp\x3e'+helpers.entities.textWithEntitiesLinks({text:a.specialTip.text,entities:a.specialTip.entities,dataSource:"tip-text"})+"\x3c/div\x3e\x3c/div\x3e");return c};templates.fourSq.explore.tooltips.mapUserTooltip=function(a,b){return'\x3cdiv class\x3d"mapTooltip"\x3e\x3cspan class\x3d"tooltipCarat"\x3e\x3c/span\x3eYou\'re here!\x3c/div\x3e'};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.newdrag&&(templates.fourSq.newdrag={});"undefined"==typeof templates.fourSq.newdrag.page&&(templates.fourSq.newdrag.page={});"undefined"==typeof templates.fourSq.newdrag.page.venuemenu&&(templates.fourSq.newdrag.page.venuemenu={});"undefined"==typeof templates.fourSq.newdrag.page.venuemenu.common&&(templates.fourSq.newdrag.page.venuemenu.common={});
"undefined"==typeof templates.fourSq.newdrag.page.venuemenu.common.core&&(templates.fourSq.newdrag.page.venuemenu.common.core={});
templates.fourSq.newdrag.page.venuemenu.common.core.contents=function(a,b){for(var c='\x3cdiv id\x3d"menuPage"\x3e\x3cdiv id\x3d"venueMenu"\x3e'+(a.showFullVenueBlock?helpers.venue.compactVenueBlock(a):"\x3ch1\x3e"+((null==a.venue?0:a.venue.name)?soy.$$escapeHtml(a.venue.name):soy.$$escapeHtml(a.venueName))+"\x3c/h1\x3e"),d=a.displayMenu.menus.items,e=d.length,f=0;f<e;f++)c+='\x3cdiv class\x3d"menu"\x3e'+templates.fourSq.newdrag.page.venuemenu.common.menu.singleMenu({menu:d[f]})+"\x3c/div\x3e";return c+=
"\x3c/div\x3e"+(a.withToc?templates.fourSq.newdrag.page.venuemenu.common.core.tableOfContents_({displayMenu:a.displayMenu.menus}):"")+templates.fourSq.newdrag.page.venuemenu.common.core.menuDisclaimer_({venueId:null==a.venue?null:a.venue.id,partnerInfo:a.displayMenu.provider,forMobile:a.forMobile})+"\x3c/div\x3e"};
templates.fourSq.newdrag.page.venuemenu.common.core.tableOfContents_=function(a,b){for(var c='\x3cdiv class\x3d"tableOfContents"\x3e',d=a.displayMenu.items,e=d.length,f=0;f<e;f++){for(var g=d[f],c=c+('\x3ch4 class\x3d"menuTitle" data-menu-id\x3d"'+soy.$$escapeHtml(g.menuId)+'"\x3e'+soy.$$escapeHtml(g.name)+'\x3c/h4\x3e\x3cul class\x3d"menuToc"\x3e'),g=g.entries.items,h=g.length,k=0;k<h;k++)var l=g[k],c=c+(l.name&&l.sectionId?'\x3cli class\x3d"section link" data-section-id\x3d"'+soy.$$escapeHtml(l.sectionId)+
'"\x3e'+soy.$$escapeHtml(l.name)+"\x3c/li\x3e":"");c+="\x3c/ul\x3e"}return c+"\x3c/div\x3e"};
templates.fourSq.newdrag.page.venuemenu.common.core.menuDisclaimer_=function(a,b){return'\x3cdiv class\x3d"disclaimer"\x3e\x3cdiv class\x3d"attribution"\x3e'+(a.partnerInfo.attributionImage?'\x3ca href\x3d"'+soy.$$escapeHtml(null!=a.partnerInfo.attributionLink?a.partnerInfo.attributionLink:"#")+'"\x3e\x3cimg src\x3d"'+soy.$$escapeHtml(a.partnerInfo.attributionImage)+'" alt\x3d"The logo for our menu provider" /\x3e\x3c/a\x3e':"")+"\x3c/div\x3e\x3cp\x3e"+(a.partnerInfo.attributionText?soy.$$escapeHtml(a.partnerInfo.attributionText):
"")+'\x3c/p\x3e\x3cdiv class\x3d"flagMenu"\x3e'+(a.forMobile&&a.venueId?'\x3ca href\x3d"../../../device/venue/'+soy.$$escapeHtml(a.venueId)+'/flag#menu" class\x3d"link flagLink"\x3eProblem with this menu?\x3c/a\x3e':'\x3cspan class\x3d"link flagLink"\x3eProblem with this menu?\x3c/span\x3e')+"\x3c/div\x3e\x3c/div\x3e"};"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.newdrag&&(templates.fourSq.newdrag={});"undefined"==typeof templates.fourSq.newdrag.page&&(templates.fourSq.newdrag.page={});"undefined"==typeof templates.fourSq.newdrag.page.venuemenu&&(templates.fourSq.newdrag.page.venuemenu={});"undefined"==typeof templates.fourSq.newdrag.page.venuemenu.common&&(templates.fourSq.newdrag.page.venuemenu.common={});
"undefined"==typeof templates.fourSq.newdrag.page.venuemenu.common.menu&&(templates.fourSq.newdrag.page.venuemenu.common.menu={});
templates.fourSq.newdrag.page.venuemenu.common.menu.singleMenu=function(a,b){for(var c='\x3cdiv class\x3d"menuInfo" id\x3d"'+soy.$$escapeHtml(a.menu.menuId)+'"\x3e\x3ch2 class\x3d"name"\x3e'+soy.$$escapeHtml(a.menu.name)+"\x3c/h2\x3e"+(a.menu.description?'\x3cp class\x3d"description"\x3e'+soy.$$escapeHtml(a.menu.description)+"\x3c/p\x3e":"")+"\x3c/div\x3e\x3cdiv\x3e",d=a.menu.entries.items,e=d.length,f=0;f<e;f++)c+=templates.fourSq.newdrag.page.venuemenu.common.menu.menuSection_({section:d[f]});return c+
"\x3c/div\x3e"};
templates.fourSq.newdrag.page.venuemenu.common.menu.menuSection_=function(a,b){for(var c='\x3cdiv class\x3d"section" '+(a.section.sectionId?'id\x3d"'+soy.$$escapeHtml(a.section.sectionId)+'"':"")+"\x3e"+(a.section.name?'\x3cdiv class\x3d"sectionHeader"\x3e\x3cdiv class\x3d"contents"\x3e'+soy.$$escapeHtml(a.section.name)+"\x3c/div\x3e\x3c/div\x3e":"")+(a.section.description?'\x3cdiv class\x3d"descriptionText"\x3e'+soy.$$escapeHtml(a.section.description)+"\x3c/div\x3e":"")+"\x3cdiv\x3e",d=a.section.entries.items,
e=d.length,f=0;f<e;f++)var g=d[f],c=c+(g.text?'\x3cdiv class\x3d"descriptionText"\x3e'+soy.$$escapeHtml(g.text)+"\x3c/div\x3e":g.name?'\x3cdiv class\x3d"entry"\x3e'+templates.fourSq.newdrag.page.venuemenu.common.menu.menuEntry_({entry:g})+"\x3c/div\x3e":"");return c+"\x3c/div\x3e\x3c/div\x3e"};
templates.fourSq.newdrag.page.venuemenu.common.menu.menuEntry_=function(a,b){return a.entry.name?'\x3cdiv class\x3d"menuHeader"\x3e'+(a.entry.price?'\x3cdiv class\x3d"price"\x3e'+soy.$$escapeHtml(a.entry.price)+"\x3c/div\x3e":a.entry.prices&&0<a.entry.prices.length?'\x3cdiv class\x3d"price"\x3e'+soy.$$escapeHtml(a.entry.prices[0])+"\x3c/div\x3e":"")+'\x3cspan class\x3d"title"\x3e'+soy.$$escapeHtml(a.entry.name)+"\x3c/span\x3e\x3c/div\x3e"+(a.entry.description?'\x3cdiv class\x3d"description"\x3e'+
soy.$$escapeHtml(a.entry.description)+"\x3c/div\x3e":""):""};fourSq.explore.ExploreApp=function(a,b){};
fourSq.explore.ExploreApp=fourSq.Class.extend({initialize:function(){this.internalEvents_=new fourSq.EventTarget;this.initialWindowLocationHref_=window.location.href;this.initialWindowLocationHrefParams_=fourSq.util.parseParams(this.initialWindowLocationHref_);this.queryData_=this.getInitialQueryData_();this.history_=new fourSq.util.History;this.history_.onChange(fourSq.bind(this.popHistory_,this));this.replaceForPush_=!0;this.allowBoundsExpansion_=!1;this.menuCache_={};this.severTs_=+new Date;var a=
this.getInitialLocationInfo_();this.response_=this.getInitialExploreResponse_();this.recommendations_=fourSq.isDefinedAndNotNull(this.getInitialExploreResponse_())?fourSq.api.models.companion.explore.ExploreUtil.extractRecommendations(this.getInitialExploreResponse_()):null;this.rid_=this.getInitialExploreRequestId_();this.venueRef_=this.getInitialVenueReference_();this.perQueryCache_={};this.filterView_=new fourSq.explore.FilterView({el:$("#filterView"),queryData:this.queryData_,recommendations:this.recommendations_,
spellCorrection:this.response_?this.response_.spellCorrection:void 0,venueRef:this.venueRef_,locationString:this.getSummaryLocationString_()});this.filterView_.on(fourSq.explore.FilterView.Events.CHANGED,this.onFilterChanged_,this);this.filterView_.decorate();this.filterView_.on(fourSq.explore.FilterView.Events.REQUERY_WITH_SPELLING_SUGGESTION,fourSq.curry(this.requeryWithParams_,this,fourSq.explore.shared.BaseQueryData.Mode.SPELL_SUGGEST));this.filterView_.on(fourSq.explore.FilterView.Events.REQUERY_WITH_SPELLING_CORRECTION,
fourSq.curry(this.requeryWithParams_,this,fourSq.explore.shared.BaseQueryData.Mode.SPELL_SUGGEST_ESCAPE));this.filterView_.on(fourSq.explore.FilterView.Events.REQUERY_WITH_REFINEMENT,fourSq.curry(this.requeryWithParams_,this,fourSq.explore.shared.BaseQueryData.Mode.REFINEMENT));this.initShare_();_.delay(function(){(new fourSq.signup.ExploreSignupPrompt({el:$("#signupPromptContainer"),signupModal:!0})).render()});this.resultsView_=new fourSq.explore.ResultsView({el:$("#results"),recommendations:this.recommendations_,
error:this.getInitialExploreError_(),querySummary:{hasSearchTerm:!!this.queryData_.getSearchTerm(),hasFilters:this.filterView_.hasFilters(),hasSpecialsFilter:this.queryData_.isSpecials()||this.queryData_.isSpecialsCategory(),near:this.queryData_.getNear()}});this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.SELECT,this.handleResultSelection_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.DESELECT,this.handleResultDeselection_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.HIGHLIGHT,
this.handleResultHighlight_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.UNHIGHLIGHT,this.handleResultUnhighlight_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.SHOW_MENU,fourSq.curry(this.handleShowMenu_,this,"recs"));this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.SHOW_EDITOR,fourSq.curry(this.handleShowEditor_,this,"recs"));this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.GOTO_USER,fourSq.curry(this.handleGotoUser_,this,"recs"));
this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.GOTO_SPECIAL,fourSq.curry(this.handleGoToSpecial_,this,"recs"));this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.GOTO_BROADCAST,fourSq.curry(this.handleGotoBroadcast_,this,"recs"));this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.GOTO_VENUE,fourSq.curry(this.handleGotoVenue_,this,"recs"));this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.SHOW_PHOTOS,this.handleShowPhotos_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.REQUERY_WITH_VENUE_CATEGORY,
fourSq.curry(this.requeryWithVenueCategory_,this,"recs"));this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.REQUERY_WITH_TASTE,this.requeryWithTerm_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.RESULT.IMPRESSION,this.getLogResultImpressionCallback_(),this);this.resultsView_.on(fourSq.explore.ResultsView.Events.ACTIONS.ADD_VENUE_FOR_TERM,this.addNewVenue_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.ACTIONS.ZOOM_IN_TILL_VALID,this.zoomInTillValid_,this);
this.resultsView_.on(fourSq.explore.ResultsView.Events.ACTIONS.ZOOM_OUT_1,this.zoomOut1_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.ACTIONS.REMOVE_FILTERS,this.removeFilters_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.ACTIONS.REQUERY_WITH_TERM,this.requeryWithTerm_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.ACTIONS.RETRY,this.fetchRecommendations_,this);this.resultsView_.on(fourSq.explore.ResultsView.Events.ACTIONS.REQUERY_WITH_CATEGORY,this.requeryWithCategory_,
this);this.resultsView_.decorate();this.mapView_=new fourSq.explore.MapView({el:$("#mapView"),initialLocationInfo:a,borderPadding:fourSq.explore.ExploreApp.MAP_BORDER_PADDING,venueRef:this.venueRef_,recommendations:this.recommendations_});this.mapView_.on(fourSq.explore.MapView.Events.BOUNDS_CHANGED,this.logBoundsChanged_,this);this.mapView_.on(fourSq.explore.MapView.Events.REQUEST_REQUERY_FOR_BOUNDS_CHANGED,this.requestRequeryForBoundsChanged_,this);this.mapView_.on(fourSq.explore.MapView.Events.REQUEST_REQUERY,
this.requestRequeryFromMapControl_,this);this.mapView_.on(fourSq.explore.MapView.Events.LOAD,this.handleMapLoad_,this);this.mapView_.on(fourSq.explore.MapView.Events.OUT_OF_BOUNDS_PINS,this.handlePinsOutOfBounds_,this);this.mapView_.on(fourSq.explore.MapView.Events.Result.SELECT,this.handlePinSelection_,this);this.mapView_.on(fourSq.explore.MapView.Events.Result.DESELECT,this.handlePinDeselection_,this);this.mapView_.on(fourSq.explore.MapView.Events.Result.HIGHLIGHT,this.handlePinHighlight_,this);
this.mapView_.on(fourSq.explore.MapView.Events.Result.UNHIGHLIGHT,this.handlePinUnhighlight_,this);this.mapView_.on(fourSq.explore.MapView.Events.Result.SHOW_MENU,fourSq.curry(this.handleShowMenu_,this,"map"));this.mapView_.on(fourSq.explore.MapView.Events.Result.SHOW_EDITOR,fourSq.curry(this.handleShowEditor_,this,"map"));this.mapView_.on(fourSq.explore.MapView.Events.Result.GOTO_VENUE,fourSq.curry(this.handleGotoVenue_,this,"map"));this.mapView_.on(fourSq.explore.MapView.Events.Result.GOTO_SPECIAL,
fourSq.curry(this.handleGoToSpecial_,this,"map"));this.mapView_.on(fourSq.explore.MapView.Events.Result.REQUERY_WITH_VENUE_CATEGORY,fourSq.curry(this.requeryWithVenueCategory_,this,"map"));this.initSearchTermInput_();this.initLocationInput_(a);this.initSearchButton_();this.mapView_.decorate();fourSq.isDefinedAndNotNull(this.recommendations_)&&!fourSq.config.explore.noPermalinkOnInitialRender&&(this.autoHighlightExactMatch_(this.recommendations_),this.updatePermalink_());_.delay(fourSq.bind(function(){this.wasServerSideError_()?
this.logResponseSummary_(fourSq.explore.ExploreApp.LogEvents.PAGE_INIT_ERROR):this.logResponseSummary_(fourSq.explore.ExploreApp.LogEvents.PAGE_INIT)},this),100)},initShare_:function(){var a=this.filterView_.getShareTrigger(),b=_.once(fourSq.bind(function(){this.shareFlyout_=new fourSq.explore.SharingFlyout({anchor:a.eq(0)});var b=fourSq.stats.Action.build(fourSq.stats.action.Action.CLICK,{section:fourSq.stats.action.Section.FILTERS,element:fourSq.stats.action.Element.SHARE});fourSq.stats.logActions(b)},
this));a.click(fourSq.bind(function(){b();fourSq.isDefinedAndNotNull(this.shareFlyout_)&&(this.shareFlyout_.update(this.rid_,this.generatePermalink_(!0,fourSq.explore.shared.BaseQueryData.Mode.SHARE),this.queryData_.getSearchTerm(),this.queryData_.getCategory(),this.getTitleLocation_(),this.venueRef_),this.shareFlyout_.toggle())},this))},initSearchTermInput_:function(){this.searchTermInputView_=(new fourSq.explore.shared.SearchTermInputView({el:$("#search input"),initialSearchTerm:this.queryData_.getSearchTerm(),
llHinter:fourSq.bind(function(){return this.mapView_.getCenter()},this)})).decorate();this.searchTermInputView_.on(fourSq.explore.shared.SearchTermInputView.Events.TYPED_QUERY,fourSq.curry(this.handleSearchTermChange_,this,"typed"),this);this.searchTermInputView_.on(fourSq.explore.shared.SearchTermInputView.Events.QUERY_SUGGEST,fourSq.curry(this.handleSearchTermChange_,this,"autocompleteQuery"),this);this.searchTermInputView_.on(fourSq.explore.shared.SearchTermInputView.Events.CHICLET,this.handleChiclet_,
this);this.mapView_.on(fourSq.explore.MapView.Events.MAP_CLICK,function(){this.searchTermInputView_.ensureAutocompleteClosed()},this)},handleChiclet_:function(a){var b=this.queryData_.getCategory();this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.CHICLET);this.queryData_.setCategory(a);b!==this.queryData_.getCategory()&&(this.markAsSignficantHistoryChange_(),this.locationInputView_.checkForChange()||(this.allowBoundsExpansion_=!0,this.fetchRecommendations_()))},handleSearchTermChange_:function(a,
b,c){this.checkForSearchTerm_();if(fourSq.isDefinedAndNotNull(c)){var d=_.once(function(){this.queryData_.setAutocompleteRequestId(c);this.internalEvents_.onOnce(fourSq.explore.ExploreApp.InternalEvents.BEFORE_QUERY,function(){this.queryData_.clearAutocompleteRequestId()},this)});this.internalEvents_.onOnce(fourSq.explore.ExploreApp.InternalEvents.BEFORE_QUERY,d,this);this.internalEvents_.onOnce(fourSq.explore.ExploreApp.InternalEvents.ON_QUERY_FAILURE,function(){this.internalEvents_.off(fourSq.explore.ExploreApp.InternalEvents.ON_QUERY_SUCCESS,
d,this)},this)}this.locationInputView_.checkForChange()||(this.allowBoundsExpansion_=!0,this.fetchRecommendations_())},initSearchButton_:function(){$("#search").submit(fourSq.bind(function(a){this.checkForSearchTerm_();this.locationInputView_.checkForChange()||(this.allowBoundsExpansion_=!0,this.fetchRecommendations_())},this))},initLocationInput_:function(a){var b;fourSq.isDefinedAndNotNull(this.queryData_.getNear())&&(b=this.queryData_.getNear());this.locationInputView_=(new fourSq.ui.LocationInputView({el:$("#desktopHeader .wrap .leftSide .inputs"),
baseActionData:{section:fourSq.stats.action.Section.HEADER_BAR},llHinter:fourSq.bind(function(){return this.mapView_.getCenter()},this),boundsHinter:fourSq.bind(function(){return this.mapView_.getBounds()},this),geocode:a.geo,useAutocomplete:!0,enableResetButton:!0})).decorate();fourSq.isDefinedAndNotNull(b)?this.locationInputView_.setLocationString(b):this.locationInputView_.activateMapBoundsText();this.locationInputView_.on(fourSq.ui.LocationInputView.Events.CHANGE,this.handleLocationChange_,this);
this.locationInputView_.on(fourSq.ui.LocationInputView.Events.GO_CURRENT_LOCATION,this.gotoCurrentLocation_,this);this.mapView_.on(fourSq.explore.MapView.Events.ON_CURRENT_LOCATION,this.handleOnCurrentLocation_,this);this.mapView_.on(fourSq.explore.MapView.Events.BOUNDS_CHANGED,this.locationInputView_.activateMapBoundsText,this.locationInputView_);this.mapView_.on(fourSq.explore.MapView.Events.MAP_CLICK,function(){this.locationInputView_.ensureAutocompleteClosed()},this)},gotoCurrentLocation_:function(){this.markAsSignficantHistoryChange_();
this.checkForSearchTerm_();this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.GEOLOCATE);this.allowBoundsExpansion_=!0;this.mapView_.gotoCurrentLocation()},handleOnCurrentLocation_:function(){this.markAsSignficantHistoryChange_();this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.GEOLOCATE);this.locationInputView_.activateCurrentLocation();this.fetchRecommendations_()},handleLocationChange_:function(a,b){this.markAsSignficantHistoryChange_();this.checkForSearchTerm_();
this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.LOCATION_INPUT);this.allowBoundsExpansion_=!0;this.mapView_.off(fourSq.explore.MapView.Events.BOUNDS_CHANGED,this.locationInputView_.activateMapBoundsText,this.locationInputView_);this.mapView_.onOnce(fourSq.explore.MapView.Events.BOUNDS_CHANGED,function(){this.fetchRecommendations_();this.locationInputView_.deactivateCurrentLocation();this.mapView_.on(fourSq.explore.MapView.Events.BOUNDS_CHANGED,this.locationInputView_.activateMapBoundsText,
this.locationInputView_)},this);b.geometry&&b.geometry.bounds&&!fourSq.api.models.companion.geo.LatLngBoundsUtil.isPoint(b.geometry.bounds)?this.mapView_.setBounds(b.geometry.bounds):this.mapView_.panTo(b.feature.geometry.center,void 0)},checkForSearchTerm_:function(){var a=this.searchTermInputView_.getSearchTerm();if(fourSq.isDefinedAndNotNull(a)&&""!==(a=$.trim(a))&&a!==this.queryData_.getSearchTerm())return this.markAsSignficantHistoryChange_(),this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.TYPED),
this.queryData_.setSearchTerm(a),!0;this.queryData_.setSearchTerm(a);return!1},resetSearchTerm_:function(){fourSq.isUndefinedOrNull(this.searchTermInputView_)||(fourSq.isUndefinedOrNull(this.queryData_.getSearchTerm())?this.searchTermInputView_.clearSearchTerm():this.queryData_.getSearchTerm()!==this.searchTermInputView_.getSearchTerm()&&this.searchTermInputView_.setSearchTerm(this.queryData_.getSearchTerm()))},handlePinsOutOfBounds_:function(a){this.resultsView_.markOutOfBoundsResults(a)},requestRequeryForBoundsChanged_:function(){this.fetchRecommendations_();
this.logMapRequeryRequest_()},requestRequeryFromMapControl_:function(){this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.MAP_REQUERY);this.fetchRecommendations_();this.logMapRequeryRequest_()},handleMapLoad_:function(){},handlePinSelection_:function(a){this.resultsView_.selectResult(a);this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.PIN_SELECT,a,{action:fourSq.stats.action.Action.SELECT,section:fourSq.stats.action.Section.MAP})},handlePinDeselection_:function(a){this.resultsView_.deselectResult(a)},
handlePinHighlight_:function(a){this.resultsView_.highlightResult(a)},handlePinUnhighlight_:function(a){this.resultsView_.unhighlightResult(a)},handleResultSelection_:function(a){this.mapView_.selectPin(a);this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.RESULT_SELECT,a,{action:fourSq.stats.action.Action.SELECT,section:fourSq.stats.action.Section.RESULTS})},handleResultDeselection_:function(a){this.mapView_.deselectPin(a)},handleResultHighlight_:function(a){this.mapView_.highlightPin(a)},
handleResultUnhighlight_:function(a){this.mapView_.unhighlightPin(a)},addNewVenue_:function(){var a=new fourSq.net.QueryString;a.set("venuename",this.queryData_.getSearchTerm());a.set("ll",fourSq.api.models.companion.geo.LatLngUtil.toQueryValue(this.mapView_.getCenter()));window.open("/add-place?"+a.toDisplayString(),"explore-to-add-venue")},indexAndRecForId:function(a){for(var b,c,d=0;d<this.recommendations_.length;d++){var e=this.recommendations_[d];if(e.venue.id===a){b=e;c=d;break}}return{index:c,
recommendation:b}},generateLogPayloadForVenue_:function(a,b){var c={};if(fourSq.isDefinedAndNotNull(a)&&fourSq.isDefinedAndNotNull(b)){var d="",c=function(a,b){d+=a+","+b+";"};c("ir",String(a));c("rid",this.rid_||"");c("rfid",b.referralId||"");c("n","explore-web");c("sid",fourSq.stats.SessionId.get());c={vid:b.venue.id,index:a,rid:this.rid_,rfid:b.referralId,metrics:d,acrid:this.queryData_.getAutocompleteRequestId()}}return c},getStatmonLoggedInSuffix_:function(){return fourSq.api.models.companion.user.UserUtil.isLoggedIn()?
"in":"out"},makeStatmonPath_:function(a,b){return["explore"].concat(a).concat(b?[]:[this.getStatmonLoggedInSuffix_()])},logResponseSummary_:function(a){var b=(this.recommendations_||[]).length,c=function(a){return fourSq.stats.Action.build(fourSq.stats.action.Action.API_RESPONSE_SUCCESS,{details:{l:b,init:a?"true":void 0,acrid:this.queryData_?this.queryData_.getAutocompleteRequestId():void 0},ids:fourSq.api.models.companion.log.Oids.build({requestId:String(this.rid_)})})},d=function(a,c){return fourSq.stats.Action.build(fourSq.stats.action.Action.API_RESPONSE_FAILURE,
{details:{l:String(b),acrid:this.queryData_?this.queryData_.getAutocompleteRequestId():void 0,zoom:c?"true":void 0,init:a?"true":void 0}})},e;switch(a){case fourSq.explore.ExploreApp.LogEvents.PAGE_INIT:e=c(!0);break;case fourSq.explore.ExploreApp.LogEvents.PAGE_INIT_ERROR:e=d(!0,!1);break;case fourSq.explore.ExploreApp.LogEvents.QUERY_RESPONSE:e=c(!1);break;case fourSq.explore.ExploreApp.LogEvents.QUERY_ERROR:e=d(!1,!1);break;case fourSq.explore.ExploreApp.LogEvents.ZOOMED_OUT_ERROR:e=d(!1,!0)}a=
fourSq.stats.log(a).addAll({rid:this.rid_,acrid:this.queryData_?this.queryData_.getAutocompleteRequestId():void 0,rc:String(b)}).incr(this.makeStatmonPath_([String(b),a])).logMetric(this.makeStatmonPath_(a),b);fourSq.isDefinedAndNotNull(e)&&a.addActions(e);a.finish()},getLogResultImpressionCallback_:function(){var a=[],b=this,c=_.debounce(function(){var c=_.map(a,function(a){var c=a.vid;a=a.tipId;var d=b.indexAndRecForId(c),h=d.index,d=d.recommendation,k=b.generateLogPayloadForVenue_(h,d);return fourSq.stats.Action.build(fourSq.stats.action.Action.IMPRESSION,
{section:fourSq.stats.action.Section.RESULTS,component:fourSq.stats.action.Component.RESULT,componentIndex:h,ids:fourSq.api.models.companion.log.Oids.build({venueId:c,tipId:a,requestId:String(k.rid),referralId:d.referralId,promotionId:d.promoted?d.promoted.id:void 0})})});a=[];fourSq.stats.logActions.apply(void 0,c)},500);return function(b){a.push(b);c()}},logResultAction_:function(a,b,c){var d=this.indexAndRecForId(b),e=d.index,f=d.recommendation,d=this.generateLogPayloadForVenue_(e,f),g=_.isEmpty(this.perQueryCache_),
h=g?fourSq.explore.ExploreApp.StatmonComponents.FIRST_EVENT_PER_QUERY:fourSq.explore.ExploreApp.StatmonComponents.NOT_FIRST_EVENT_PER_QUERY,k=fourSq.isDefinedAndNotNull(this.perQueryCache_[a])?fourSq.explore.ExploreApp.StatmonComponents.NOT_FIRST_FOR_QUERY:fourSq.explore.ExploreApp.StatmonComponents.FIRST_FOR_QUERY;this.perQueryCache_[a]=!0;b=fourSq.api.models.companion.log.Oids.build({venueId:b,requestId:String(d.rid),referralId:f.referralId,promotionId:f.promoted?f.promoted.id:void 0,targetUserId:c.userId});
fourSq.isDefinedAndNotNull(c.ids)&&(b=fourSq.api.models.companion.log.Oids.merge(b,c.ids));c=fourSq.stats.Action.build(c.action,{element:c.element,section:c.section,component:fourSq.stats.action.Component.RESULT,componentIndex:e,ids:b,details:{isFirst:g,acrid:this.queryData_.getAutocompleteRequestId()}});fourSq.stats.log(a).addAll(d).incr(this.makeStatmonPath_([h,k,String(e),a])).logMetric(this.makeStatmonPath_([h,k,a]),e).addActions(c).finish()},logMapRequeryRequest_:function(){var a=_.isEmpty(this.perQueryCache_),
b=a?fourSq.explore.ExploreApp.StatmonComponents.FIRST_EVENT_PER_QUERY:fourSq.explore.ExploreApp.StatmonComponents.NOT_FIRST_EVENT_PER_QUERY,c=fourSq.explore.ExploreApp.LogEvents.MAP_REQUERY_REQUEST;this.perQueryCache_[c]=!0;a=fourSq.stats.Action.build(fourSq.stats.action.Action.CLICK,{section:fourSq.stats.action.Section.MAP,component:fourSq.stats.action.Component.MAP_CONTROL,element:fourSq.stats.action.Element.REQUERY,details:{isFirst:String(a),acrid:this.queryData_.getAutocompleteRequestId()}});
fourSq.stats.log(c).incr(this.makeStatmonPath_([b,c])).addActions(a).finish()},logBoundsChanged_:function(){var a=_.isEmpty(this.perQueryCache_)?fourSq.explore.ExploreApp.StatmonComponents.FIRST_EVENT_PER_QUERY:fourSq.explore.ExploreApp.StatmonComponents.NOT_FIRST_EVENT_PER_QUERY,b=fourSq.explore.ExploreApp.LogEvents.BOUNDS_CHANGED;this.perQueryCache_[b]=!0;fourSq.stats.log(b).incr(this.makeStatmonPath_([a,b])).finish()},handleShowMenu_:function(a,b){var c=this,d=this.indexAndRecForId(b).recommendation.venue,
e=function(){(new fourSq.explore.MenuViewer({el:$("body"),venueName:d.name,menuResponse:c.menuCache_[d.id]})).render().show()};this.menuCache_[d.id]?e():fourSq.api.services.Venue.menu(d.id,function(a){c.menuCache_[d.id]=a;e()});this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.SHOW_MENU,b,{action:fourSq.stats.action.Action.CLICK,section:"recs"===a?fourSq.stats.action.Section.RESULTS:fourSq.stats.action.Section.MAP,element:fourSq.stats.action.Element.MENU})},handleShowEditor_:function(a,b){var c=
null,d=_.after(2,function(){(new fourSq.venueflag.views.DialogWizard({model:c,showOsmEditLink:!1,creatingView:"explore-page",afterEditUpsellToSU:!1,afterEditUpsellToQueues:!0,config:fourSq.venueflag.models.DefaultConfig})).render()});fourSq.net.JsModuleLoader.load({resources:[{bundle:"foursquare",module:"desktop-venue-flagging"}],complete:d});fourSq.api.services.Venue.detail(b,function(a){c=a;d()},fourSq.emptyFunction);this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.SHOW_EDITOR,b,{action:fourSq.stats.action.Action.CLICK,
section:"recs"===a?fourSq.stats.action.Section.RESULTS:fourSq.stats.action.Section.MAP,element:fourSq.stats.action.Element.EDITOR})},handleGotoUser_:function(a,b){this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.USER_CLICK,b,{action:fourSq.stats.action.Action.CLICK,section:"recs"===a?fourSq.stats.action.Section.RESULTS:fourSq.stats.action.Section.MAP,element:fourSq.stats.action.Element.FACE})},handleGotoVenue_:function(a,b){this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.VENUE_CLICK,
b,{action:fourSq.stats.action.Action.CLICK,section:"recs"===a?fourSq.stats.action.Section.RESULTS:fourSq.stats.action.Section.MAP,element:fourSq.stats.action.Element.VENUE_NAME})},handleGoToSpecial_:function(a,b,c,d){this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.INLINE_SPCIAL_CLICK,b,{action:fourSq.stats.action.Action.CLICK,section:"recs"===a?fourSq.stats.action.Section.RESULTS:fourSq.stats.action.Section.MAP,element:fourSq.stats.action.Element.SPECIAL,ids:fourSq.api.models.companion.log.Oids.build({specialId:c})});
a=this.indexAndRecForId(b);c="load-to-card"===d?"/special/"+encodeURIComponent(c):a.recommendation.venue.canonicalPath;window.open(c,"explore-to-venue-special")},handleGotoBroadcast_:function(a,b,c){this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.BROADCAST_CLICK,b,{action:fourSq.stats.action.Action.CLICK,section:"recs"===a?fourSq.stats.action.Section.RESULTS:fourSq.stats.action.Section.MAP,element:fourSq.stats.action.Element.BROADCAST});a=this.indexAndRecForId(b);a=_.filter(a.recommendation.venue.pageUpdates.items,
function(a){return a.id===c})[0];fourSq.isDefinedAndNotNull(a)&&window.open(a.page.canonicalPath+"/update/"+c,"explore-to-broadcast")},handleShowPhotos_:function(a){this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.SHOW_PHOTOS,a,{action:fourSq.stats.action.Action.CLICK,section:fourSq.stats.action.Section.RESULTS,element:fourSq.stats.action.Element.PHOTO})},zoomInTillValid_:function(){this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.ZERO_RESULTS_RADIUS);this.mapView_.tryToZoomInTillValid(!0);
this.locationInputView_.activateMapBoundsText()},zoomOut1_:function(){this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.ZERO_RESULTS_RADIUS);this.mapView_.zoomOut(!0);this.locationInputView_.activateMapBoundsText()},removeFilters_:function(){this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.ZERO_RESULTS_FILTERS);this.markAsSignficantHistoryChange_();this.filterView_.clearFilters(!0);this.filterView_.updateQueryData(this.queryData_);this.fetchRecommendations_()},requeryWithTerm_:function(a){this.markAsSignficantHistoryChange_();
this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.ZERO_RESULTS_TERM);this.queryData_.setSearchTerm(a);this.fetchRecommendations_()},requeryWithParams_:function(a,b){this.markAsSignficantHistoryChange_();this.queryData_.setSearchTerm();this.queryData_.setCategory();this.queryData_.set(b);this.queryData_.setMode(a);this.fetchRecommendations_()},requeryWithCategory_:function(a){this.markAsSignficantHistoryChange_();this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.ZERO_RESULTS_CATEGORY);
this.queryData_.setCategory(a);this.fetchRecommendations_()},requeryWithVenueCategory_:function(a,b,c){this.markAsSignficantHistoryChange_();this.queryData_.setSearchTerm(c);this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.VENUE_CATEGORY);this.logResultAction_(fourSq.explore.ExploreApp.LogEvents.REQUERY_WITH_CATEGORY,b,{action:fourSq.stats.action.Action.CLICK,section:"recs"===a?fourSq.stats.action.Section.RESULTS:fourSq.stats.action.Section.MAP,element:fourSq.stats.action.Element.CATEGORY_NAME});
this.fetchRecommendations_()},onFilterChanged_:function(){this.markAsSignficantHistoryChange_();this.filterView_.updateQueryData(this.queryData_);this.queryData_.setMode(fourSq.explore.shared.BaseQueryData.Mode.CHANGE_FILTERS);this.fetchRecommendations_()},startLoading:function(){$("#loadingResults").show();this.mapView_.startLoading()},endLoading:function(){$("#loadingResults").hide();this.mapView_.endLoading()},ensureDefaultCategory_:function(){fourSq.isUndefinedOrNull(this.queryData_.getCategory())&&
fourSq.isUndefinedOrNull(this.queryData_.getSearchTerm())&&(this.markAsSignficantHistoryChange_(),this.queryData_.setCategory(fourSq.explore.ExploreApp.DEFAULT_CATEGORY));fourSq.isDefinedAndNotNull(this.venueRef_)&&(this.markAsSignficantHistoryChange_(),this.venueRef_=null)},fetchRecommendations_:function(){var a=this.severTs_=+new Date;this.perQueryCache_={};this.resetSearchTerm_();this.ensureDefaultCategory_();""!==this.locationInputView_.getLocationString()?this.queryData_.setNear(this.locationInputView_.getLocationString(),
this.locationInputView_.getCurrentGeoId(),this.mapView_.getCenter()):this.locationInputView_.isOnCurrentLocation()&&fourSq.isDefinedAndNotNull(this.mapView_.getCurrentLocation())?this.queryData_.setLatLng(this.mapView_.getCurrentLocation()):this.queryData_.setBounds(this.mapView_.getBounds());this.internalEvents_.trigger(fourSq.explore.ExploreApp.InternalEvents.BEFORE_QUERY);var b=fourSq.config.explore.useNewEndpoint?this.queryData_.forDiscoQuery():this.queryData_.forQuery();this.queryData_.setMode();
this.startLoading();var c=function(b,c){if(!(a<this.severTs_)){this.endLoading();this.internalEvents_.trigger(fourSq.explore.ExploreApp.InternalEvents.AFTER_QUERY);this.internalEvents_.trigger(fourSq.explore.ExploreApp.InternalEvents.ON_QUERY_SUCCESS);var d=fourSq.api.requestId(c);this.processExploreResponse_(b,d);this.queryData_.allowSpellCorrection()}},d=function(b){a<this.severTs_||(this.endLoading(),this.internalEvents_.trigger(fourSq.explore.ExploreApp.InternalEvents.AFTER_QUERY),this.internalEvents_.trigger(fourSq.explore.ExploreApp.InternalEvents.ON_QUERY_FAILURE),
this.processExploreError_(b.response.meta),this.queryData_.allowSpellCorrection())};fourSq.config.explore.useNewEndpoint?fourSq.api.services.Search.recommendations(b,fourSq.bind(c,this),fourSq.bind(d,this)):fourSq.api.services.Venue.explore(b,fourSq.bind(c,this),fourSq.bind(d,this))},processExploreResponse_:function(a,b,c){c=!!c;this.rid_=b;this.response_=a;this.maybeUpdateLocationInput_();this.updateRecommendations_();c||this.updatePermalink_();this.updatePageTitle_();c||this.logResponseSummary_(fourSq.explore.ExploreApp.LogEvents.QUERY_RESPONSE)},
maybeUpdateLocationInput_:function(){this.response_.geocode&&this.response_.geocode.feature&&this.response_.geocode.feature.displayName&&this.locationInputView_.setLocationString(this.response_.geocode.feature.displayName)},updateRecommendations_:function(){this.recommendations_=fourSq.api.models.companion.explore.ExploreUtil.extractRecommendations(this.response_);this.filterView_.updateRecommendations({recommendations:this.recommendations_,queryData:this.queryData_,venueRef:this.venueRef_,spellCorrection:this.response_.spellCorrection,
locationString:this.getSummaryLocationString_()});this.resultsView_.updateRecommendations(this.recommendations_,{hasSearchTerm:!!this.queryData_.getSearchTerm(),hasFilters:this.filterView_.hasFilters(),hasSpecialsFilter:this.queryData_.isSpecials()||this.queryData_.isSpecialsCategory(),near:this.queryData_.getNear()});this.mapView_.updateRecommendations(this.recommendations_,this.allowBoundsExpansion_,this.locationInputView_.isOnCurrentLocation(),fourSq.config.explore.respondToSuggestedBounds?this.response_.suggestedBounds:
void 0);this.allowBoundsExpansion_&&this.autoHighlightExactMatch_(this.recommendations_);this.allowBoundsExpansion_=!1},processExploreError_:function(a){fourSq.debug.error("error fetching rex");this.filterView_.updateRecommendations({recommendations:[],queryData:this.queryData_});this.resultsView_.error(a,{hasSearchTerm:!!this.queryData_.getSearchTerm(),hasFilters:this.filterView_.hasFilters(),hasSpecialsFilter:this.queryData_.isSpecials(),near:this.queryData_.getNear()});this.mapView_.error(a);0<=
a.errorType.indexOf("geocode_too_big")?this.logResponseSummary_(fourSq.explore.ExploreApp.LogEvents.ZOOMED_OUT_ERROR):this.logResponseSummary_(fourSq.explore.ExploreApp.LogEvents.QUERY_ERROR)},autoHighlightExactMatch_:function(a){a&&a.length&&a[0].flags&&a[0].flags.exactMatch&&(a=a[0].venue.id,this.resultsView_.selectResult(a,!0),this.mapView_.selectPin(a))},updatePageTitle_:function(){var a=this.queryData_.getSearchTerm(),b=this.queryData_.getCategory(),c=this.getTitleLocation_();if(a=templates.fourSq.explore.shared.head.title({queryTerm:a,
section:b,near:c,venueRef:this.venueRef_}))document.title=$("\x3cdiv/\x3e").append(a).text()},getTitleLocation_:function(){var a;""!==this.locationInputView_.getLocationString()?(a=this.locationInputView_.getLocationString(),a=_.map(a.split(" "),function(a){return fourSq.util.capitalize(a)}).join(" ")):this.response_&&"unknown"!==this.response_.headerLocationGranularity&&(a=this.response_.headerFullLocation);return a},getSummaryLocationString_:function(){var a;this.response_&&"unknown"!==this.response_.headerLocationGranularity?
a=this.response_.headerFullLocation:this.response_&&this.response_.geocode&&this.response_.geocode.feature&&this.response_.geocode.feature.displayName&&(a=this.response_.geocode.displayName);return a},generatePermalink_:function(a,b){if(this.venueRef_)return window.location.pathname+window.location.search;var c=this.queryData_.clone(),d=this.locationInputView_.getLocationString();a&&(c.getNear()&&!fourSq.api.models.companion.geo.LatLngBoundsUtil.equals(this.mapView_.getBounds(),this.locationInputView_.getCurrentGeocodeBounds())||
c.getBounds()&&!fourSq.api.models.companion.geo.LatLngBoundsUtil.equals(this.mapView_.getBounds(),c.getBounds()||null))?c.setViewportBounds(this.mapView_.getBounds()):c.setViewportBounds();""!==d&&c.setNear(this.locationInputView_.getLocationString(),this.locationInputView_.getCurrentGeoId());c.getCategory()===fourSq.explore.ExploreApp.DEFAULT_CATEGORY&&c.setCategory();var d={},e=fourSq.explore.shared.Permalink.getDefaultMarshaller();e.addField(new fourSq.explore.shared.Permalink.NearField);e.addField(new fourSq.explore.shared.Permalink.NearGeoIdField);
e.addField(new fourSq.explore.shared.Permalink.DebugField);a&&e.addField(new fourSq.explore.shared.Permalink.ViewportBoundsField);e.toParams(c,d);d.mode=b?b:fourSq.explore.shared.BaseQueryData.Mode.URL;return"/explore?"+(new fourSq.net.QueryString).setAll(d).toDisplayString()},popHistory_:function(a){a&&(18E5>+new Date-a.ts?(this.rid_=a.rid,this.queryData_=new fourSq.explore.shared.BaseQueryData(a.queryData),this.venueRef_=a.venueRef,this.mapView_.deserialize(a.mapState),this.locationInputView_.deserialize(a.locationInputState),
this.searchTermInputView_.deserialize(a.searchTermState),this.processExploreResponse_(a.response,a.rid,!0)):window.location.reload())},markAsSignficantHistoryChange_:function(){this.replaceForPush_=!1},updatePermalink_:function(){var a=this.generatePermalink_(),b={ts:+new Date,rid:this.rid_,response:this.response_,queryData:this.queryData_.forQuery(),mapState:this.mapView_.serialize(),locationInputState:this.locationInputView_.serialize(),searchTermState:this.searchTermInputView_.serialize(),venueRef:this.venueRef_};
this.replaceForPush_?this.history_.replace(a,b):this.history_.push(a,b);this.replaceForPush_=!0},getInitialGeocodeOverride_:function(){return fourSq.config.explore.geoOverride||null},getInitialGeocodeResponse_:function(){var a=this.getInitialExploreResponse_();return a&&a.geocode?a.geocode:null},wasServerSideError_:function(){return!this.getInitialExploreResponse_()&&!!this.getInitialExploreError_()},getInitialExploreResponse_:function(){return fourSq.config.explore.response||null},getInitialExploreError_:function(){return fourSq.config.explore.errorMeta||
null},getInitialVenueReference_:function(){return fourSq.config.explore.venueRef||null},getInitialExploreRequestId_:function(){return fourSq.config.explore.rid||null},getInitialQueryData_:function(){var a=fourSq.config.explore.queryData||{},a=fourSq.config.explore.useNewEndpoint?fourSq.explore.shared.BaseQueryData.convertNewExploreDataToOld(a):a;return new fourSq.explore.shared.BaseQueryData(a)},getInitialViewportBounds_:function(){var a=this.initialWindowLocationHrefParams_,b=new fourSq.explore.shared.Permalink.ViewportBoundsField,
c=new fourSq.explore.shared.BaseQueryData({});b.pullFromParams(a,c);return c.getViewportBounds()||null},getInitialLocationInfo_:function(){var a=this.queryData_.getBounds(),b=this.queryData_.getLatLng()||fourSq.api.models.companion.user.UserUtil.latLng(),c=this.getInitialExploreResponse_(),d=this.getInitialGeocodeResponse_()||this.getInitialGeocodeOverride_(),e=c&&c.suggestedRadius||fourSq.config.explore.suggestedRadius||500,f=this.getInitialViewportBounds_();return fourSq.isDefinedAndNotNull(c)&&
fourSq.config.explore.respondToSuggestedBounds&&fourSq.isDefinedAndNotNull(c.suggestedBounds)?{bounds:c.suggestedBounds}:fourSq.isDefinedAndNotNull(d)?{viewport:f,geo:d,radius:e}:fourSq.isDefinedAndNotNull(a)?{viewport:f,bounds:a}:{ll:b,radius:e}},showQueryBounds_:function(){this.queryBoundsLayer_&&this.mapView_.map_.removeLayer(this.queryBoundsLayer_);var a=this.queryData_.getBoundsNorthEast(),b=this.queryData_.getBoundsSouthWest(),c=new L.LatLng(a.lat,b.lng),d=new L.LatLng(b.lat,a.lng);this.queryBoundsLayer_=
a=new L.Polygon([c,a,d,b]);this.mapView_.map_.addLayer(a,{color:"red",fillColor:"#f03",fillOpacity:.5})}},{DEFAULT_CATEGORY:"bestNearby",MAP_BORDER_PADDING:{top:45,right:17.5,bottom:0,left:17.5},InternalEvents:{BEFORE_QUERY:"before-query",AFTER_QUERY:"after-query",ON_QUERY_SUCCESS:"on-query-success",ON_QUERY_FAILURE:"on-query-failure"},LogEvents:{PAGE_INIT:"explorepageinit",PAGE_INIT_ERROR:"explorepageiniterror",PIN_SELECT:"explorepinselect",RESULT_SELECT:"exploreresultselect",SHOW_MENU:"exploreshowmenu",
SHOW_EDITOR:"exploreshoweditor",VENUE_CLICK:"explorevenueclick",INLINE_SPCIAL_CLICK:"inlinespecialclick",BROADCAST_CLICK:"broadcastclick",USER_CLICK:"exploreuserclick",SHOW_PHOTOS:"exploreshowphotos",REQUERY_WITH_CATEGORY:"explorecatsearch",QUERY_RESPONSE:"explorequeryresponse",QUERY_ERROR:"explorequeryerror",ZOOMED_OUT_ERROR:"explorezoomedouterror",MAP_REQUERY_REQUEST:"exploremaprequery",BOUNDS_CHANGED:"exploreboundschanged"},StatmonComponents:{EXPLORE_PREFIX:"explore",LOGGED_IN_SUFFIX:"in",LOGGED_OUT_SUFFIX:"out",
FIRST_EVENT_PER_QUERY:"feq",NOT_FIRST_EVENT_PER_QUERY:"nfeq",FIRST_FOR_QUERY:"fq",NOT_FIRST_FOR_QUERY:"nfq"}});fourSq.views.ExplorePage=function(a){};fourSq.views.ExplorePage=fourSq.views.Page.extend({initialize:function(a){fourSq.views.ExplorePage.__super__.initialize.call(this,a);this.explore=new fourSq.explore.ExploreApp;fourSq.ui.Notifier.getInstance().setPosition(fourSq.ui.Notifier.Position.TOP_RIGHT)},pageViewName:fourSq.stats.action.View.EXPLORE});fourSq.explore.SharingFlyout=function(a){};
fourSq.explore.SharingFlyout=fourSq.ui.TransientFlyout.extend({initialize:function(a){fourSq.explore.SharingFlyout.__super__.initialize.call(this,a);this.flyoutLifetimeMs=4E3;this.shortLinkCache_={};this.url_=this.venueRef_=this.section_=this.location_=this.query_=this.requestId_=void 0},getRenderedContentsHtml:function(){return templates.fourSq.explore.share.flyout()},decorate:function(){fourSq.explore.SharingFlyout.__super__.decorate.call(this);this.$linkInput_=this.$el.find(".url");this.$shortenCheckbox_=
this.$el.find(".shorten");this.$fbLink_=this.$el.find(".shareFacebook");this.$twLink_=this.$el.find(".shareTwitter");this.$shortenCheckbox_.click(fourSq.bind(this.toggleLink_,this));this.$fbLink_.click(fourSq.bind(this.shareFacebook_,this));this.$twLink_.click(fourSq.bind(this.shareTwitter_,this));fourSq.ui.util.addOnOutsideClickCallback(this.$anchor_,fourSq.bind(this.close,this),[this.$el]);return this},popupDimensions_:function(a,b){var c=window.screenY?window.screenY:window.screenTop,d=window.outerHeight?
window.outerHeight:document.documentElement.clientHeight-22,e=Math.round((window.screenX?window.screenX:window.screenLeft)+((window.outerWidth?window.outerWidth:document.documentElement.clientWidth)-a)/2),c=Math.round(c+(d-b)/2);return"width\x3d"+a+",height\x3d"+b+",left\x3d"+e+",top\x3d"+c+",scrollbars\x3dtrue"},shareTwitter_:function(){var a=fourSq.stats.Action.build(fourSq.stats.action.Action.CLICK,{section:fourSq.stats.action.Section.FILTERS,component:fourSq.stats.action.Component.SHARE_FLYOUT,
element:fourSq.stats.action.Element.SHARE_TWITTER});fourSq.stats.logActions(a);var b=this.popupDimensions_(550,420);fourSq.util.devices.isTouch()||window.open("about:blank","explore-share",b);this.doWithShortLink_(fourSq.bind(function(a){var d=new fourSq.net.QueryString;d.set("url",a);d.set("text",this.composeTweet_());d.set("via","foursquare");d.set("lang",fourSq.i18n.languagePref());a="http://twitter.com/share?"+d.toDisplayString();window.open(a,"explore-share",b)},this))},composeTweet_:function(){return templates.fourSq.explore.share.tweetText({queryTerm:this.query_,
section:this.section_,near:this.location_,venueRef:this.venueRef_})},composeFb_:function(){return templates.fourSq.explore.share.facebookText({queryTerm:this.query_,section:this.section_,near:this.location_,venueRef:this.venueRef_})},shareFacebook_:function(){var a=fourSq.stats.Action.build(fourSq.stats.action.Action.CLICK,{section:fourSq.stats.action.Section.FILTERS,component:fourSq.stats.action.Component.SHARE_FLYOUT,element:fourSq.stats.action.Element.SHARE_FACEBOOK});fourSq.stats.logActions(a);
var b=this.popupDimensions_(650,306);fourSq.util.devices.isTouch()||window.open("about:blank","explore-share",b);this.doWithShortLink_(fourSq.bind(function(a){var d=new fourSq.net.QueryString;d.set("app_id",String(fourSq.config.fb.APP_ID));d.set("display","popup");d.set("link",a);d.set("name",templates.fourSq.explore.share.facebookTitle());d.set("picture",templates.fourSq.explore.shared.head.ogImage());d.set("description",this.composeFb_());d.set("redirect_uri","https://foursquare.com/facebook_redirect");
a="http://www.facebook.com/dialog/feed?"+d.toDisplayString();window.open(a,"explore-share",b)},this))},update:function(a,b,c,d,e,f){this.requestId_=a;this.url_=b;this.query_=c;this.section_=d;this.location_=e;this.venueRef_=f},getCurrentLink_:function(){var a=window.location.protocol+"//"+window.location.hostname+this.url_,a=a+"\x26share\x3d1";fourSq.isDefinedAndNotNull(this.requestId_)&&(a+="\x26rid\x3d"+this.requestId_);return a},toggleLink_:function(){this.$shortenCheckbox_.prop("checked")?this.swapWithShortLink_():
this.swapWithFullLink_()},swapWithShortLink_:function(){this.doWithShortLink_(fourSq.bind(function(a){this.$linkInput_.val(a).select();this.$shortenCheckbox_.prop("checked",!0)},this))},doWithShortLink_:function(a){var b=this.getCurrentLink_(),c=this.shortLinkCache_[b];c?a(c):fourSq.api.services.PrivateWeb.shortLink({url:b},fourSq.bind(function(c){this.shortLinkCache_[b]=c.shortLink;a(c.shortLink)},this))},swapWithFullLink_:function(){this.$linkInput_.val(this.getCurrentLink_()).select();this.$shortenCheckbox_.prop("checked",
!1)},beforeOpen:function(){this.$shortenCheckbox_.prop("checked")&&this.shortLinkCache_[this.getCurrentLink_()]?this.swapWithShortLink_():this.swapWithFullLink_()},afterOpen:function(){this.$linkInput_.select()},toggle:function(){this.isOpen()?this.close():this.open()}});fourSq.explore.FilterView=function(a){};
fourSq.explore.FilterView=fourSq.ui.View.extend({initialize:function(a){this.$el=$(this.el);this.recommendations_=a.recommendations||[];this.resultCount_=0;this.queryData_=new fourSq.explore.shared.BaseQueryData({});this.queryDataUpdated(a.queryData);this.spellCorrection_=a.spellCorrection||null;this.locationString_=a.locationString;this.venueRef_=a.venueRef||null;this.options={};this.filterChips_=[];a={queryData:a.queryData};this.filterChips_.push(new fourSq.explore.SpecialFilterChip(a));this.filterChips_.push(new fourSq.explore.BeenHereFilterChip(a));
this.filterChips_.push(new fourSq.explore.FriendsBeenFilterChip(a));this.filterChips_.push(new fourSq.explore.PriceFilterChip(a));this.filterChips_.push(new fourSq.explore.OpenNowFilterChip(a));this.filterChips_.push(new fourSq.explore.SavedFilterChip(a));fourSq.config.explore.useNewEndpoint&&this.filterChips_.push(new fourSq.explore.LikedFilterChip(a))},hasFilters:function(){return!!_.find(this.filterChips_,function(a){return a.isActive()})},updateQueryData:function(a){a.setSearchTerm(this.queryData_.getSearchTerm());
a.setCategory(this.queryData_.getCategory());_.each(this.filterChips_,function(b){b.stateUpdated(a)})},queryDataUpdated:function(a){this.queryData_.setSearchTerm(a.getSearchTerm());this.queryData_.setCategory(a.getCategory());_.each(this.filterChips_,function(b){b.updateState(a)})},clearFilters:function(a){_.each(this.filterChips_,function(a){a.isActive()&&(a.loading_(),a.reset())});a||this.changed_()},changed_:function(){this.trigger(fourSq.explore.FilterView.Events.CHANGED)},closeOtherChips_:function(a){_.each(this.filterChips_,
function(b){b!==a&&b.closeFlyout()})},onFilterChipChange_:function(a){a.stateUpdated(this.queryData_);this.changed_()},updateRecommendations:function(a){this.recommendations_=a.recommendations||[];this.resultCount_=a.recommendations.length||0;this.venueRef_=a.venueRef||null;this.locationString_=a.locationString;fourSq.isDefinedAndNotNull(a.queryData)&&this.queryDataUpdated(a.queryData);this.showStandardSummaryMessage_();this.updateSpellCorrection_(a.spellCorrection)},updateSpellCorrection_:function(a){a&&
a.suggestion?(this.renderSpellingMessage_(a),this.decorateSpellingSuggestion_(a.suggestion),a=fourSq.stats.Action.build(fourSq.stats.action.Action.IMPRESSION,{section:fourSq.stats.action.Section.FILTERS,element:fourSq.stats.action.Element.SPELLING_SUGGESTION}),fourSq.stats.logActions(a)):a&&a.correction&&a.escapeHatch?(this.renderSpellingMessage_(a),this.showSpellCorrectionSummaryMessage_(a),this.decorateSpellingCorrection_(a.escapeHatch),a=fourSq.stats.Action.build(fourSq.stats.action.Action.IMPRESSION,
{section:fourSq.stats.action.Section.FILTERS,element:fourSq.stats.action.Element.SPELLING_CORRECTION}),fourSq.stats.logActions(a)):this.$spelling_.empty()},decorate:function(){this.$messageBar_=this.$el.find("#messageBar");this.$summaryMessage_=this.$messageBar_.find(".message");this.$spelling_=this.$messageBar_.find(".spelling");this.$chips_=this.$el.find(".chips");this.$shareTrigger_=this.$el.find(".share");this.$shareTrigger_.tooltip();this.updateRecommendations({recommendations:this.recommendations_,
venueRef:this.venueRef_,spellCorrection:this.spellCorrection_,locationString:this.locationString_});this.initFilterChips_();return this},initFilterChips_:function(){var a=this;_.each(this.filterChips_,function(b){a.$chips_.append(b.render().$el);b.on(fourSq.explore.FilterChip.Events.CHANGED,fourSq.curry(a.onFilterChipChange_,a,b));b.on(fourSq.explore.FilterChip.Events.FOCUS,fourSq.curry(a.closeOtherChips_,a,b))})},getShareTrigger:function(){return this.$shareTrigger_},showStandardSummaryMessage_:function(){this.$summaryMessage_.empty().append($(templates.fourSq.explore.filters.resultsSummaryMessage({count:this.resultCount_,
term:this.queryData_.getSearchTerm(),category:this.queryData_.getCategory(),venueRef:this.venueRef_,locationString:this.locationString_||void 0})))},showSpellCorrectionSummaryMessage_:function(a){this.$summaryMessage_.empty().append($(templates.fourSq.explore.filters.resultsSummarySpellingCorrectionMessage({spellCorrection:a,useNewEndpoint:fourSq.config.explore.useNewEndpoint})))},renderSpellingMessage_:function(a){this.$spelling_.empty().append($(templates.fourSq.explore.filters.spellCorrection({spellCorrection:a,
useNewEndpoint:fourSq.config.explore.useNewEndpoint})))},decorateSpellingCorrection_:function(a){var b=this;this.$spelling_.find(".escapeHatchTrigger").click(function(c){c=a.target.params;var d=fourSq.stats.Action.build(fourSq.stats.action.Action.CLICK,{section:fourSq.stats.action.Section.FILTERS,element:fourSq.stats.action.Element.SPELLING_ESCAPE_HATCH});fourSq.stats.logActions(d);b.trigger(fourSq.explore.FilterView.Events.REQUERY_WITH_SPELLING_CORRECTION,c)})},decorateSpellingSuggestion_:function(a){var b=
this;this.$spelling_.find(".suggestionTrigger").click(function(c){c=a.target.params;var d=fourSq.stats.Action.build(fourSq.stats.action.Action.CLICK,{section:fourSq.stats.action.Section.FILTERS,element:fourSq.stats.action.Element.SPELLING_SUGGESTION});fourSq.stats.logActions(d);b.trigger(fourSq.explore.FilterView.Events.REQUERY_WITH_SPELLING_SUGGESTION,c)})}},{Events:{REQUERY_WITH_REFINEMENT:"FilterView:RequeryWithRefinement",REQUERY_WITH_SPELLING_SUGGESTION:"FilterView:RequeryWithSpellingSuggestion",
REQUERY_WITH_SPELLING_CORRECTION:"FilterView:RequeryWithSpellingCorrection",CHANGED:"FilterView:changed"}});fourSq.explore.FilterChip=function(a){};
fourSq.explore.FilterChip=fourSq.ui.View.extend({initialize:function(a){fourSq.explore.FilterChip.__super__.initialize.call(this,a);this.queryData_=new fourSq.explore.shared.BaseQueryData({});this.updateState(a.queryData);this.flyout_=null},updateState:function(a){},stateUpdated:function(a){},isActive:function(){return!1},reset:fourSq.abstractMethod,changed_:function(){this.trigger(fourSq.explore.FilterChip.Events.CHANGED);this.loading_()},select_:function(){this.$el.addClass("selected").removeClass("loading")},unselect_:function(){this.$el.removeClass("selected").removeClass("loading")},
selectIfActive_:function(){this.isActive()?this.select_():this.unselect_()},loading_:function(){this.$el.addClass("loading")},closeFlyout:function(){fourSq.isDefinedAndNotNull(this.flyout_)&&(this.flyout_.close(),this.onFlyoutClose_())},decorate:function(){this.flyout_=this.initFlyout_();this.flyout_.on(fourSq.explore.FilterChipFlyout.Events.OPEN,this.onFlyoutOpen_,this);this.flyout_.on(fourSq.explore.FilterChipFlyout.Events.CLOSE,this.onFlyoutClose_,this);return this},onFlyoutOpen_:function(){this.$el.addClass("hover");
this.trigger(fourSq.explore.FilterChip.Events.FOCUS)},onFlyoutClose_:function(){this.$el.removeClass("hover")},initFlyout_:function(){}},{Events:{CHANGED:"changed",FOCUS:"focus"}});fourSq.explore.FilterChipFlyout=function(a){};
fourSq.explore.FilterChipFlyout=fourSq.ui.Flyout.extend({initialize:function(a){fourSq.explore.FilterChipFlyout.__super__.initialize.call(this,a);this.flyoutExtraClass="chipFlyout";this.direction=fourSq.ui.Flyout.Directions.BELOW;this.isHovered_=!1;this.on(fourSq.ui.Flyout.Events.HOVER_IN,this.handleIn_,this);this.on(fourSq.ui.Flyout.Events.HOVER_OUT,this.handleOut_,this)},handleIn_:function(a){this.isHovered_=!0;setTimeout(fourSq.bind(function(){this.isHovered_&&(this.open(),this.trigger(fourSq.explore.FilterChipFlyout.Events.OPEN))},
this),1E3*this.delay)},handleOut_:function(a){this.isHovered_=!1;setTimeout(fourSq.bind(function(){this.isHovered_||(this.close(),this.trigger(fourSq.explore.FilterChipFlyout.Events.CLOSE))},this),250)}},{Events:{OPEN:"open",CLOSE:"close"}});fourSq.explore.TextOnlyFilterChipFlyout=function(a){};fourSq.explore.TextOnlyFilterChipFlyout=fourSq.explore.FilterChipFlyout.extend({initialize:function(a){fourSq.explore.TextOnlyFilterChipFlyout.__super__.initialize.call(this,a);this.contentsHtml_=a.contentsHtml},getRenderedContentsHtml:function(){return this.contentsHtml_}});fourSq.explore.SpecialFilterChip=function(a){};
fourSq.explore.SpecialFilterChip=fourSq.explore.FilterChip.extend({initialize:function(a){fourSq.explore.SpecialFilterChip.__super__.initialize.call(this,a);this.options={}},render:function(){this.$el=$(templates.fourSq.explore.filters.specialsFilterChip());return this.decorate()},initFlyout_:function(){return new fourSq.explore.TextOnlyFilterChipFlyout({anchor:this.$el.eq(0),contentsHtml:templates.fourSq.explore.filters.specialsFilterChipFlyout()})},decorate:function(){fourSq.explore.SpecialFilterChip.__super__.decorate.call(this);
this.$el.click(fourSq.bind(function(){this.queryData_.setSpecials(!this.queryData_.isSpecials());this.changed_()},this));this.selectIfActive_();return this},isActive:function(){return this.queryData_.isSpecials()},reset:function(){this.queryData_.setSpecials()},updateState:function(a){var b=this.isActive();this.queryData_.setSpecials(a.isSpecials());this.selectIfActive_();return this.isActive()!==b},stateUpdated:function(a){a.setSpecials(this.queryData_.isSpecials())}});fourSq.explore.OpenNowFilterChip=function(a){};
fourSq.explore.OpenNowFilterChip=fourSq.explore.FilterChip.extend({initialize:function(a){fourSq.explore.OpenNowFilterChip.__super__.initialize.call(this,a);this.options={}},render:function(){this.$el=$(templates.fourSq.explore.filters.openNowFilterChip());return this.decorate()},initFlyout_:function(){return new fourSq.explore.TextOnlyFilterChipFlyout({anchor:this.$el.eq(0),contentsHtml:templates.fourSq.explore.filters.openNowFilterChipFlyout()})},decorate:function(){fourSq.explore.OpenNowFilterChip.__super__.decorate.call(this);this.$el.click(fourSq.bind(function(){this.queryData_.setPopularNow(!this.queryData_.isPopularNow());
this.changed_()},this));this.selectIfActive_();return this},isActive:function(){return this.queryData_.isPopularNow()},reset:function(){this.queryData_.setPopularNow()},updateState:function(a){var b=this.isActive();this.queryData_.setPopularNow(a.isPopularNow());this.selectIfActive_();return this.isActive()!==b},stateUpdated:function(a){a.setPopularNow(this.queryData_.isPopularNow())}});fourSq.explore.SavedFilterChip=function(a){};
fourSq.explore.SavedFilterChip=fourSq.explore.FilterChip.extend({initialize:function(a){fourSq.explore.SavedFilterChip.__super__.initialize.call(this,a);this.options={}},render:function(){this.$el=$(templates.fourSq.explore.filters.savedFilterChip());return this.decorate()},initFlyout_:function(){return new fourSq.explore.TextOnlyFilterChipFlyout({anchor:this.$el.eq(0),contentsHtml:templates.fourSq.explore.filters.savedFilterChipFlyout()})},decorate:function(){fourSq.explore.SavedFilterChip.__super__.decorate.call(this);var a=
fourSq.api.models.companion.user.UserUtil.isLoggedIn();this.$el.click(fourSq.bind(function(){a?(this.loading_(),this.queryData_.setSaved(!this.queryData_.isSaved()),this.changed_()):fourSq.signup.signupDialogFactory({titleText:templates.fourSq.ui.signupmodal.exploreSavedFilterSignupTitle(),bodyText:templates.fourSq.ui.signupmodal.exploreSavedFilterSignupBody(),trigger:fourSq.signup.Trigger.FILTER_SAVED}).show()},this));a&&this.selectIfActive_();return this},isActive:function(){return this.queryData_.isSaved()},
reset:function(){this.queryData_.setSaved()},updateState:function(a){var b=this.isActive();this.queryData_.setSaved(a.isSaved());this.selectIfActive_();return this.isActive()!==b},stateUpdated:function(a){a.setSaved(this.queryData_.isSaved())}});fourSq.explore.BeenHereFilterChip=function(a){};
fourSq.explore.BeenHereFilterChip=fourSq.explore.FilterChip.extend({initialize:function(a){fourSq.explore.BeenHereFilterChip.__super__.initialize.call(this,a);this.flyout_=null;this.options={}},render:function(){this.$el=$(templates.fourSq.explore.filters.beenHereFilterChip({novelty:this.queryData_.getNovelty()}));return this.decorate()},initFlyout_:function(){return new fourSq.explore.BeenHereFilterChipFlyout({anchor:this.$el.eq(0),queryData:this.queryData_})},decorate:function(){fourSq.explore.BeenHereFilterChip.__super__.decorate.call(this);
this.flyout_.on(fourSq.explore.BeenHereFilterChipFlyout.Events.CHANGED,this.changed_,this);this.$el.click(fourSq.bind(this.onClick_,this));this.selectIfActive_();return this},updateChipCopy_:function(){if(this.el){var a=$(templates.fourSq.explore.filters.beenHereFilterChipValue({novelty:this.queryData_.getNovelty()}));this.$el.empty().append(a)}},changed_:function(){this.updateChipCopy_();fourSq.explore.BeenHereFilterChip.__super__.changed_.call(this)},onClick_:function(a){this.flyout_.open();this.flyout_.toggleDefault()},
isActive:function(){return this.queryData_.isNoveltyOld()||this.queryData_.isNoveltyNew()},reset:function(){this.queryData_.setNovelty();this.flyout_.reset()},updateState:function(a){var b=!1;a.getNovelty()!==this.queryData_.getNovelty()&&(b=!0,this.queryData_.setNovelty(a.getNovelty()));this.updateChipCopy_();this.selectIfActive_();return b},stateUpdated:function(a){a.setNovelty(this.queryData_.getNovelty())}});fourSq.explore.BeenHereFilterChipFlyout=function(a){};
fourSq.explore.BeenHereFilterChipFlyout=fourSq.explore.FilterChipFlyout.extend({initialize:function(a){fourSq.explore.BeenHereFilterChipFlyout.__super__.initialize.call(this,a);this.queryData_=a.queryData;this.options={}},getRenderedContentsHtml:function(){return templates.fourSq.explore.filters.beenHereFilterChipFlyout()},decorate:function(){this.$haventBeenButton_=this.$el.find(".haventBeen");this.$haveBeenButton_=this.$el.find(".haveBeen");this.$haventBeenButton_.click(fourSq.bind(this.toggleHaventBeen_,
this));this.$haveBeenButton_.click(fourSq.bind(this.toggleHaveBeen_,this));this.queryData_.isNoveltyNew()&&(this.$haventBeenButton_.addClass("selected"),this.$haveBeenButton_.removeClass("selected"));this.queryData_.isNoveltyOld()&&(this.$haveBeenButton_.addClass("selected"),this.$haventBeenButton_.removeClass("selected"));return this},isActive_:function(){return this.queryData_.isNoveltyOld()||this.queryData_.isNoveltyNew()},reset:function(){this.queryData_.setNovelty();this.$haveBeenButton_&&this.$haventBeenButton_&&
(this.$haveBeenButton_.removeClass("selected"),this.$haventBeenButton_.removeClass("selected"))},toggleDefault:function(){this.isActive_()?(this.reset(),this.changed_()):this.$haventBeenButton_.click()},changed_:function(){this.trigger(fourSq.explore.BeenHereFilterChipFlyout.Events.CHANGED)},toggleHaveBeen_:function(){fourSq.api.models.companion.user.UserUtil.isLoggedIn()?(this.$haveBeenButton_.toggleClass("selected"),this.$haveBeenButton_.is(".selected")?(this.$haventBeenButton_.toggleClass("selected",
!1),this.queryData_.setNoveltyOld()):this.queryData_.setNovelty(),this.changed_()):(this.$haveBeenButton_.toggleClass("selected",!1),fourSq.signup.signupDialogFactory({titleText:templates.fourSq.ui.signupmodal.exploreHaveBeenFilterSignupTitle(),bodyText:templates.fourSq.ui.signupmodal.exploreHaveBeenFilterSignupBody(),trigger:fourSq.signup.Trigger.FILTER_HAVE_BEEN}).show())},toggleHaventBeen_:function(){fourSq.api.models.companion.user.UserUtil.isLoggedIn()?(this.$haventBeenButton_.toggleClass("selected"),
this.$haventBeenButton_.is(".selected")?(this.$haveBeenButton_.toggleClass("selected",!1),this.queryData_.setNoveltyNew()):this.queryData_.setNovelty(),this.changed_()):(this.$haventBeenButton_.toggleClass("selected",!1),fourSq.signup.signupDialogFactory({titleText:templates.fourSq.ui.signupmodal.exploreHaveNotBeenFilterSignupTitle(),bodyText:templates.fourSq.ui.signupmodal.exploreHaveNotBeenFilterSignupBody(),trigger:fourSq.signup.Trigger.FILTER_HAVE_NOT_BEEN}).show())}},{Events:{CHANGED:"changed"}});fourSq.explore.FriendsBeenFilterChip=function(a){};
fourSq.explore.FriendsBeenFilterChip=fourSq.explore.FilterChip.extend({initialize:function(a){fourSq.explore.FriendsBeenFilterChip.__super__.initialize.call(this,a);this.options={}},render:function(){var a=fourSq.config.explore.useNewEndpoint?templates.fourSq.explore.filters.followingBeenFilterChip():templates.fourSq.explore.filters.friendsBeenFilterChip();this.$el=$(a);return this.decorate()},initFlyout_:function(){return new fourSq.explore.TextOnlyFilterChipFlyout({anchor:this.$el.eq(0),contentsHtml:fourSq.config.explore.useNewEndpoint?
templates.fourSq.explore.filters.followingBeenFilterChipFlyout():templates.fourSq.explore.filters.friendsBeenFilterChipFlyout()})},decorate:function(){fourSq.explore.FriendsBeenFilterChip.__super__.decorate.call(this);this.$el.click(fourSq.bind(function(){fourSq.api.models.companion.user.UserUtil.isLoggedIn()?(this.queryData_.setFriendVisits(!this.queryData_.isFriendVisits()),this.changed_()):fourSq.signup.signupDialogFactory({titleText:templates.fourSq.ui.signupmodal.exploreFriendsHaveBeenFilterSignupTitle(),
bodyText:templates.fourSq.ui.signupmodal.exploreFriendsHaveBeenFilterSignupBody(),trigger:fourSq.signup.Trigger.FILTER_FRIENDS_HAVE_BEEN}).show()},this));this.selectIfActive_();return this},isActive:function(){return this.queryData_.isFriendVisits()},reset:function(){this.queryData_.setFriendVisits()},updateState:function(a){var b=this.isActive();this.queryData_.setFriendVisits(a.isFriendVisits());this.selectIfActive_();return this.isActive()!==b},stateUpdated:function(a){a.setFriendVisits(this.queryData_.isFriendVisits())}});fourSq.explore.LikedFilterChip=function(a){};
fourSq.explore.LikedFilterChip=fourSq.explore.FilterChip.extend({initialize:function(a){fourSq.explore.LikedFilterChip.__super__.initialize.call(this,a);this.options={}},render:function(){this.$el=$(templates.fourSq.explore.filters.likedFilterChip());return this.decorate()},initFlyout_:function(){return new fourSq.explore.TextOnlyFilterChipFlyout({anchor:this.$el.eq(0),contentsHtml:templates.fourSq.explore.filters.likedFilterChipFlyout()})},decorate:function(){fourSq.explore.LikedFilterChip.__super__.decorate.call(this);this.$el.click(fourSq.bind(function(){fourSq.api.models.companion.user.UserUtil.isLoggedIn()?
(this.queryData_.setLiked(!this.queryData_.isLiked()),this.changed_()):fourSq.signup.signupDialogFactory({titleText:templates.fourSq.ui.signupmodal.exploreLikedFilterSignupTitle(),bodyText:templates.fourSq.ui.signupmodal.exploreLikedFilterSignupBody(),trigger:fourSq.signup.Trigger.FILTER_LIKED}).show()},this));this.selectIfActive_();return this},isActive:function(){return this.queryData_.isLiked()},reset:function(){this.queryData_.setLiked()},updateState:function(a){var b=this.isActive();this.queryData_.setLiked(a.isLiked());
this.selectIfActive_();return this.isActive()!==b},stateUpdated:function(a){a.setLiked(this.queryData_.isLiked())}});fourSq.explore.PriceFilterChip=function(a){};
fourSq.explore.PriceFilterChip=fourSq.explore.FilterChip.extend({initialize:function(a){fourSq.explore.PriceFilterChip.__super__.initialize.call(this,a);this.flyout_=null},render:function(){this.$el=$(templates.fourSq.explore.filters.priceFilterChip({prices:this.queryData_.getPriceArray()}));return this.decorate()},initFlyout_:function(){return new fourSq.explore.PriceFilterChipFlyout({anchor:this.$el.eq(0),queryData:this.queryData_})},decorate:function(){fourSq.explore.PriceFilterChip.__super__.decorate.call(this);this.flyout_.on(fourSq.explore.BeenHereFilterChipFlyout.Events.CHANGED,
this.changed_,this);this.$el.click(fourSq.bind(this.onClick_,this));this.selectIfActive_();return this},updateChipCopy_:function(){if(this.el){var a=$(templates.fourSq.explore.filters.priceFilterValue({prices:this.queryData_.getPriceArray()}));this.$el.empty().append(a)}},changed_:function(){this.updateChipCopy_();fourSq.explore.PriceFilterChip.__super__.changed_.call(this)},onClick_:function(a){this.flyout_.open();this.isActive()&&this.flyout_.reset(!0)},isActive:function(){return 0<this.queryData_.getPriceFlag()},
reset:function(){this.queryData_.setPrice();this.flyout_.reset(!1)},updateState:function(a){var b=this.queryData_.getPrice();this.queryData_.setPrice(a.getPrice());a=b!==this.queryData_.getPrice();this.updateChipCopy_();this.selectIfActive_();return a},stateUpdated:function(a){a.setPrice(this.queryData_.getPrice())}});fourSq.explore.PriceFilterChipFlyout=function(a){};
fourSq.explore.PriceFilterChipFlyout=fourSq.explore.FilterChipFlyout.extend({initialize:function(a){fourSq.explore.PriceFilterChipFlyout.__super__.initialize.call(this,a);this.queryData_=a.queryData;this.options={}},getRenderedContentsHtml:function(){return templates.fourSq.explore.filters.priceFilterChipFlyout()},decorate:function(){this.$el.find(".settings .link").click(fourSq.bind(this.onPriceSelect_,this));var a=this.queryData_;_.each(this.$el.find(".settings .link").toArray(),function(b){b=$(b);
parseInt(b.data("price-field"),10)&a.getPriceFlag()&&b.addClass("selected")});return this},reset:function(a){this.queryData_.setPrice();this.$el&&this.$el.find(".settings .link").removeClass("selected");a&&this.changed_()},onPriceSelect_:function(a){var b=parseInt($(a.target).data("price-field"),10);a=$(a.target);a.toggleClass("selected");0===b?(this.$el.find(".settings .link").removeClass("selected"),this.queryData_.setPriceFlag(fourSq.explore.shared.BaseQueryData.PriceFlags.NONE)):a.is(".selected")?
this.queryData_.addPriceFlag(b):this.queryData_.removePriceFlag(b);this.changed_()},changed_:function(){this.trigger(fourSq.explore.PriceFilterChipFlyout.Events.CHANGED)}},{Events:{CHANGED:"changed"}});fourSq.explore.RequeryControl=function(a,b){};
fourSq.explore.RequeryControl=fourSq.map.EventedControl.extend({options:{position:"topleft"},onAdd:function(a){this.$container_=$(templates.fourSq.explore.map.controls.requery.control());this.$container_.find("a").click(function(a){a.preventDefault()});this.$container_.dblclick(function(a){a.preventDefault();a.stopPropagation()});this.$container_.click(fourSq.bind(function(a){this.handleClick_()},this));return this.getContainer()},getContainer:function(){return this.$container_.get(0)},startSpin:function(){this.$container_.addClass("spin")},
stopSpin:function(){this.$container_.removeClass("spin")},show:function(){this.$container_.show()},hide:function(){this.$container_.hide()},activate:function(){this.$container_.show().addClass("active").removeClass("inactive")},deactivate:function(){this.$container_.show().addClass("inactive").removeClass("active")},handleClick_:function(){this.trigger(fourSq.explore.RequeryControl.Events.CLICK)}});fourSq.explore.RequeryControl.Events={CLICK:"CLICK"};fourSq.explore.LocateControl=function(a,b){};
fourSq.explore.LocateControl=fourSq.map.EventedControl.extend({options:{position:"topleft"},onAdd:function(a){this.$container_=$(templates.fourSq.explore.map.controls.locate.control());this.$container_.find("a").click(function(a){a.preventDefault()}).tooltip({position:"left"});this.$container_.dblclick(function(a){a.preventDefault();a.stopPropagation()});this.$container_.click(fourSq.bind(function(a){this.handleClick_()},this));return this.getContainer()},getContainer:function(){return this.$container_.get(0)},
activate:function(){this.$container_.find("a").addClass("active")},deactivate:function(){this.$container_.find("a").removeClass("active")},handleClick_:function(){this.trigger(fourSq.explore.LocateControl.Events.CLICK)}});fourSq.explore.LocateControl.Events={CLICK:"CLICK"};fourSq.explore.MapView=function(a){};
fourSq.explore.MapView=fourSq.ui.View.extend({DEFAULT_ZOOM:15,initialize:function(a){this.mapLoaded_=!1;this.selectedPin_=this.specifiedBounds_=this.currentLocation_=void 0;this.initialLocationInfo_=a.initialLocationInfo;this.recommendations_=a.recommendations||[];this.pins_={};var b={top:0,right:0,bottom:0,left:0};this.borderPadding_=a.borderPadding||b;b={top:-8,bottom:18,right:10,left:10};this.inBoundsBorderPadding_=a.inBoundsBorderPadding||b;b={latPercent:.5,lngPercent:.5};this.browseFenceBounds_=
a.browseFencePaddingPercents||b;this.venueRef_=a.venueRef;this.options={}},decorate:function(){this.initMap_();$(window).resize(_.debounce(fourSq.bind(this.handleWindowResize_,this),500));return this},render:fourSq.abstractMethod,updateRecommendations:function(a,b,c,d){this.recommendations_=a;this.clearVenuePins_();this.requeryControl_.deactivate();var e=fourSq.bind(function(){_.each(a,this.renderPin_,this);for(var b=0,c=Math.min(5,a.length);b<c;b++)this.pins_[a[b].venue.id].setZIndexOffset(fourSq.explore.MapView.PinZindexLevels.SELECTED-
b-1);this.findAndAnnounceOutOfBoundsPins_()},this);fourSq.isDefinedAndNotNull(d)?this.zoomToFitSuggestedBounds_(d,e):b&&a.length&&a[0].flags&&a[0].flags.outsideRadius?this.expandBoundsToFit_(e):(c&&this.zoomToFitPins_(),e())},zoomToFitSuggestedBounds_:function(a,b){var c=fourSq.api.models.companion.geo.LatLngBoundsUtil.toLeaflet(a),d=fourSq.bind(function(){this.specifiedBounds_=a;b()},this);this.suspendMapEvents_(fourSq.explore.MapView.LeafletEvents_.MOVEEND,!0,!0,!1,d);fourSq.map.LeafletUtil.fitBoundsEnsureEvents(this.map_,
c)},zoomToFitPins_:function(){var a=_.map(this.recommendations_,function(a){return new L.LatLng(a.venue.location.lat,a.venue.location.lng)});fourSq.map.MapUtil.fitToLatLngs(this.map_,a,this.borderPadding_)},expandBoundsToFit_:function(a){var b=fourSq.api.models.companion.geo.LatLngBoundsUtil.toLeaflet(this.getMapBounds()),b=fourSq.explore.MapView.expandBoundsToFitRecs(b,this.recommendations_);this.suspendMapEvents_(fourSq.explore.MapView.LeafletEvents_.MOVEEND,!0,!0,!1,a);fourSq.map.LeafletUtil.fitBoundsEnsureEvents(this.map_,
b)},selectPin:function(a){(a=this.pins_[a])&&this.selectPin_(a,!0)},deselectPin:function(a){(a=this.pins_[a])&&this.deselectPin_(a)},highlightPin:function(a){(a=this.pins_[a])&&this.highlightPin_(a,!0)},unhighlightPin:function(a){(a=this.pins_[a])&&this.unhighlightPin_(a,!0)},setBounds:function(a,b){var c=fourSq.api.models.companion.geo.LatLngBoundsUtil.toLeaflet(a),d=this.mapLoaded_?fourSq.explore.MapView.LeafletEvents_.MOVEEND:fourSq.explore.MapView.LeafletEvents_.LOAD,e=fourSq.bind(function(){this.specifiedBounds_=
a;this.locateControl_.deactivate();b||this.trigger(fourSq.explore.MapView.Events.BOUNDS_CHANGED)},this);this.suspendMapEvents_(d,!0,!1,!1,e);this.mapLoaded_?fourSq.map.LeafletUtil.fitBoundsEnsureEvents(this.map_,c):this.map_.fitBounds(c)},panTo:function(a,b,c){b=b||this.DEFAULT_ZOOM;this.unbindMapEvents_();var d=this.mapLoaded_?fourSq.explore.MapView.LeafletEvents_.MOVEEND:fourSq.explore.MapView.LeafletEvents_.LOAD,e=fourSq.bind(function(){this.locateControl_.deactivate();c||this.trigger(fourSq.explore.MapView.Events.BOUNDS_CHANGED)},
this);this.suspendMapEvents_(d,!0,!0,!0,e);fourSq.map.LeafletUtil.setViewEnsureEvents(this.map_,fourSq.api.models.companion.geo.LatLngUtil.toLeaflet(a),b)},zoomOut:function(a){!0===a&&this.unbindAndForceChangeWhenDone_();this.map_.zoomOut()},zoomIn:function(){if(this.selectedPin_){var a=this.selectedPin_.getLatLng(),b=this.map_.getZoom()+1;fourSq.api.models.companion.geo.LatLngBoundsUtil.toLeaflet(this.getMapBounds()).contains(a)?fourSq.map.LeafletUtil.setViewEnsureEvents(this.map_,a,b):this.map_.zoomIn()}else this.map_.zoomIn()},
tryToZoomInTillValid:function(a){a&&this.unbindAndForceChangeWhenDone_();a=this.map_.getCenter();a=fourSq.map.MapUtil.radiusToBounds(a,14E3);fourSq.map.LeafletUtil.fitBoundsEnsureEvents(this.map_,a)},error:function(a){this.clearVenuePins_();this.requeryControl_.deactivate()},updateCurrentLocation:function(a){this.currentLocation_=a;this.userPin_&&this.userPin_.setLatLng(a)},getCurrentLocation:function(){return this.currentLocation_||null},gotoCurrentLocation:function(){fourSq.isDefinedAndNotNull(this.currentLocation_)?
(this.onOnce(fourSq.explore.MapView.Events.BOUNDS_CHANGED,function(){this.trigger(fourSq.explore.MapView.Events.ON_CURRENT_LOCATION);this.locateControl_.activate();this.initUserPin_()},this),this.panTo(this.currentLocation_,this.map_.getZoom())):(this.off(fourSq.explore.MapView.Events.LOCATION_FOUND),this.off(fourSq.explore.MapView.Events.LOCATION_NOT_FOUND),this.on(fourSq.explore.MapView.Events.LOCATION_FOUND,function(a){this.off(fourSq.explore.MapView.Events.LOCATION_FOUND);this.off(fourSq.explore.MapView.Events.LOCATION_NOT_FOUND);
this.updateCurrentLocation(a);this.gotoCurrentLocation()},this),this.on(fourSq.explore.MapView.Events.LOCATION_NOT_FOUND,function(){this.off(fourSq.explore.MapView.Events.LOCATION_FOUND);this.off(fourSq.explore.MapView.Events.LOCATION_NOT_FOUND);fourSq.ui.Notifier.getInstance().info($(templates.fourSq.explore.map.locationNotFoundMessage()))}),this.locateUntilAccurate(2500))},locateUntilAccurate:function(a){var b=+new Date,c;this.map_.on(fourSq.explore.MapView.LeafletEvents_.LOCATION_FOUND,function(d){var e=
+new Date;d.accuracy<=a&&1E4>=e-b&&(this.trigger(fourSq.explore.MapView.Events.LOCATION_FOUND,fourSq.api.models.companion.geo.LatLngUtil.fromLeaflet(d.latlng)),this.map_.stopLocate(),c&&window.clearTimeout(c))},this);this.map_.on(fourSq.explore.MapView.LeafletEvents_.LOCATION_ERROR,function(a){this.map_.stopLocate();c&&window.clearTimeout(c);this.trigger(fourSq.explore.MapView.Events.LOCATION_NOT_FOUND)},this);this.map_.locate({maximumAge:36E6,enableHighAccuracy:!0,watch:!0});c=window.setTimeout(fourSq.bind(function(){this.map_.stopLocate();
this.trigger(fourSq.explore.MapView.Events.LOCATION_NOT_FOUND)},this),5E3)},hasResults:function(){return!!_.size(this.pins_)},getBounds:function(){return this.specifiedBounds_?this.specifiedBounds_:this.getMapBounds()},getMapBounds:function(){var a=fourSq.map.MapUtil.padMapBounds(this.map_,this.borderPadding_);return fourSq.api.models.companion.geo.LatLngBoundsUtil.fromLeaflet(a)},getCenter:function(){var a=fourSq.map.MapUtil.padMapBounds(this.map_,this.borderPadding_);return fourSq.api.models.companion.geo.LatLngUtil.fromLeaflet(a.getCenter())},
handlePinClick_:function(a){this.selectPin_(a)},handlePinMouseover_:function(a){this.highlightPin_(a)},handlePinMouseout_:function(a){this.unhighlightPin_(a)},handleMapZoom_:function(){this.calculateBrowseFence_();this.specifiedBounds_=void 0;this.findAndAnnounceOutOfBoundsPins_();this.locateControl_.deactivate();this.requeryControl_.activate();this.trigger(fourSq.explore.MapView.Events.BOUNDS_CHANGED)},handleMapDrag_:function(){this.specifiedBounds_=void 0;this.findAndAnnounceOutOfBoundsPins_();
this.locateControl_.deactivate();this.requeryControl_.activate();this.trigger(fourSq.explore.MapView.Events.BOUNDS_CHANGED)},handleWindowResize_:function(){this.calculateBrowseFence_();this.findAndAnnounceOutOfBoundsPins_();this.cornerBearings_=this.calculateCornerBearings_();this.specifiedBounds_=void 0;this.locateControl_.deactivate();this.requeryControl_.activate();this.trigger(fourSq.explore.MapView.Events.BOUNDS_CHANGED)},selectPin_:function(a,b){a&&(this.selectedPin_&&(this.selectedPin_.deselect(),
this.selectedPin_.setZIndexOffset(fourSq.explore.MapView.PinZindexLevels.STANDARD),this.selectedPin_.closeTooltip()),a!==this.selectedPin_?(a.select(),a.setZIndexOffset(fourSq.explore.MapView.PinZindexLevels.SELECTED),a.openTooltip(),this.selectedPin_=a,this.panToIncludePin_(a),b||this.trigger(fourSq.explore.MapView.Events.Result.SELECT,a.id)):(this.selectedPin_=void 0,b||this.trigger(fourSq.explore.MapView.Events.Result.DESELECT,a.id)))},deselectPin_:function(a){a&&(a.deselect(),a.setZIndexOffset(fourSq.explore.MapView.PinZindexLevels.STANDARD),
a.closeTooltip(),this.selectedPin_&&this.selectedPin_===a&&(this.selectedPin_=void 0))},highlightPin_:function(a,b){a&&(a.openTooltip(),a.setZIndexOffset(fourSq.explore.MapView.PinZindexLevels.HIGHLIGHTED),b||this.trigger(fourSq.explore.MapView.Events.Result.HIGHLIGHT,a.id))},unhighlightPin_:function(a,b){a&&(a!==this.selectedPin_?(a.closeTooltip(),a.setZIndexOffset(fourSq.explore.MapView.PinZindexLevels.STANDARD),b||this.trigger(fourSq.explore.MapView.Events.Result.UNHIGHLIGHT,a.id)):a.setZIndexOffset(fourSq.explore.MapView.PinZindexLevels.SELECTED))},
renderVenueRef_:function(){var a=this.venueRef_;if(a){var b=fourSq.newpin.PinIconProviderFactory.categoryForVenue(a),c=$(templates.fourSq.explore.tooltips.mapVenueTooltip({index:0,venue:a,reason:{},pinType:b.name(),isPromoted:!1,useNewEndpoint:fourSq.config.explore.useNewEndpoint,specialTip:void 0})),d=new fourSq.newpin.CenteredAboveBelowTooltipPositioner({map:this.map_,latLng:fourSq.api.models.companion.geo.LatLngUtil.toLeaflet(a.location),buffer:fourSq.explore.MapView.PIN_TOOLTIP_BUFFER,pinSize:b.size()}),
c=new fourSq.newpin.Tooltip({map:this.map_,latLng:a.location,contents:c.eq(0),positioner:d,options:{autoPan:!1,closeButton:!1}}),e=new fourSq.newpin.Pin({iconProvider:b,id:a.id,latLng:a.location,map:this.map_,tooltip:c});e.on(fourSq.newpin.Pin.Events.MOUSEOVER,fourSq.bind(function(){e.openTooltip()},this));e.on(fourSq.newpin.Pin.Events.MOUSEOUT,fourSq.bind(function(){e.closeTooltip()},this));this.expandBoundsToFit_()}},renderPin_:function(a,b){var c=fourSq.api.models.companion.geo.LatLngUtil.latLng(a.venue.location.lat,
a.venue.location.lng),d=_.filter(a.snippets&&a.snippets.items||[],function(a){return"tip"===a.detail.type&&"merchant_special"==a.detail.object.type})[0],e=d&&d.detail&&d.detail.object,d=a.venue.id,f=fourSq.explore.pin.PinIconProviderFactory.forVenue(fourSq.config.explore.useNewEndpoint?!!e:!!(a.venue&&a.venue.specials&&0<a.venue.specials.count),b),e=$(templates.fourSq.explore.tooltips.mapVenueTooltip({index:b+1,venue:a.venue,reason:a.reasons&&a.reasons.items[0]||{},pinType:f.name(),isPromoted:!!a.promoted,
useNewEndpoint:fourSq.config.explore.useNewEndpoint,specialTip:e})),g=function(a){a.preventDefault()};e.find(".linkToMenu a").click(g).click(fourSq.bind(function(){this.trigger(fourSq.explore.MapView.Events.Result.SHOW_MENU,a.venue.id)},this));e.find(".linkToEditor a").click(g).click(fourSq.bind(function(){this.trigger(fourSq.explore.MapView.Events.Result.SHOW_EDITOR,a.venue.id)},this));e.find(".venueName a").click(fourSq.bind(function(){this.trigger(fourSq.explore.MapView.Events.Result.GOTO_VENUE,
a.venue.id)},this));e.find(".specialInfo").click(fourSq.bind(function(b){var c=$(b.delegateTarget).data("special-id")||void 0;b=$(b.delegateTarget).data("special-redemption")||void 0;this.trigger(fourSq.explore.MapView.Events.Result.GOTO_SPECIAL,a.venue.id,c,b)},this));e.find(".categoryName").click(fourSq.bind(function(){a.venue.categories&&a.venue.categories[0]&&this.trigger(fourSq.explore.MapView.Events.Result.REQUERY_WITH_VENUE_CATEGORY,a.venue.id,a.venue.categories[0].name)},this));var g=new fourSq.newpin.CenteredAboveBelowTooltipPositioner({map:this.map_,
latLng:fourSq.api.models.companion.geo.LatLngUtil.toLeaflet(c),buffer:fourSq.explore.MapView.PIN_TOOLTIP_BUFFER,pinSize:f.size()}),g=new fourSq.newpin.Tooltip({map:this.map_,latLng:c,contents:e.eq(0),positioner:g,options:{autoPan:!1,closeButton:!1,maxWidth:273}}),h=new fourSq.explore.pin.ExplorePin({map:this.map_,latLng:c,iconProvider:f,id:d,tooltip:g});h.on("all",function(a){fourSq.debug.info("Pin event:"+a)});h.on(fourSq.explore.pin.ExplorePin.Events.CLICK,this.handlePinClick_,this);var k=!1,l=
!1,m=null,p=function(a){l||k||this.handlePinMouseout_(a)};e.hover(function(){l=!0},fourSq.bind(function(){l=!1;fourSq.isDefinedAndNotNull(m)&&window.clearTimeout(m);m=_.delay(fourSq.curry(p,this,h),200)},this));h.on(fourSq.explore.pin.ExplorePin.Events.MOUSEOVER,this.handlePinMouseover_,this);h.on(fourSq.explore.pin.ExplorePin.Events.MOUSEOVER,function(a){k=!0;this.handlePinMouseover_(a)},this);h.on(fourSq.explore.pin.ExplorePin.Events.MOUSEOUT,function(a){k=!1;m=_.delay(fourSq.curry(p,this,a),200)},
this);this.pins_[d]=h},clearVenuePins_:function(){this.selectedPin_=void 0;_.each(_.keys(this.pins_),function(a){this.pins_[a].remove();delete this.pins_[a]},this)},startLoading:function(){this.requeryControl_.startSpin()},endLoading:function(){this.requeryControl_.stopSpin()},initMap_:function(){this.map_=fourSq.map.MapGenerator.generate("mapCanvas",{scrollWheelZoom:!1,zoomControl:!1},{tilePadding:{left:2},withLegalAndPrivacyAttribution:!0});this.requeryControl_=new fourSq.explore.RequeryControl;
this.requeryControl_.on(fourSq.explore.RequeryControl.Events.CLICK,function(){this.trigger(fourSq.explore.MapView.Events.REQUEST_REQUERY)},this);this.map_.addControl(this.requeryControl_);this.requeryControl_.deactivate();this.zoomControl_=new fourSq.map.EventedZoomControl;this.zoomControl_.on(fourSq.map.EventedZoomControl.Events.ZOOM_IN,this.zoomIn,this);this.zoomControl_.on(fourSq.map.EventedZoomControl.Events.ZOOM_OUT,this.zoomOut,this);this.map_.addControl(this.zoomControl_);this.locateControl_=
new fourSq.explore.LocateControl;this.locateControl_.on(fourSq.explore.LocateControl.Events.CLICK,this.gotoCurrentLocation,this);this.map_.addControl(this.locateControl_);var a,b;this.map_.on(fourSq.explore.MapView.LeafletEvents_.CLICK,function(a){if(a=this.selectedPin_)this.deselectPin_(a),this.trigger(fourSq.explore.MapView.Events.Result.DESELECT,a.id);this.trigger(fourSq.explore.MapView.Events.MAP_CLICK)},this);this.map_.on(fourSq.explore.MapView.LeafletEvents_.LOAD,function(){this.mapLoaded_=
!0;this.specifiedBounds_=a;this.recommendations_&&this.updateRecommendations(this.recommendations_,!0);this.renderVenueRef_();this.calculateBrowseFence_();this.bindMapEvents_();this.cornerBearings_=this.calculateCornerBearings_();this.trigger(fourSq.explore.MapView.Events.LOAD)},this);var c=null;fourSq.isDefinedAndNotNull(this.initialLocationInfo_.bounds)?(a=this.initialLocationInfo_.bounds,c=this.initialLocationInfo_.viewport,this.setBounds(c||a,!0)):fourSq.isDefinedAndNotNull(this.initialLocationInfo_.ll)?
(c=fourSq.api.models.companion.geo.LatLngUtil.toLeaflet(this.initialLocationInfo_.ll),this.initialLocationInfo_.radius?(b=fourSq.map.MapUtil.radiusToBounds(c,this.initialLocationInfo_.radius),a=fourSq.api.models.companion.geo.LatLngBoundsUtil.fromLeaflet(b),this.setBounds(a,!0)):this.map_.setView(c,this.DEFAULT_ZOOM)):fourSq.isDefinedAndNotNull(this.initialLocationInfo_.geo)&&(b=this.initialLocationInfo_.geo.feature,c=this.initialLocationInfo_.viewport,b.geometry&&b.geometry.bounds?(a=b.geometry.bounds,
this.setBounds(c||a,!0)):this.initialLocationInfo_.radius?(b=fourSq.api.models.companion.geo.LatLngUtil.toLeaflet(b.geometry.center),b=fourSq.map.MapUtil.radiusToBounds(b,this.initialLocationInfo_.radius),a=fourSq.api.models.companion.geo.LatLngBoundsUtil.fromLeaflet(b),this.setBounds(c||a,!0)):(b=fourSq.api.models.companion.geo.LatLngUtil.toLeaflet(b.geometry.center),fourSq.map.LeafletUtil.setViewEnsureEvents(this.map_,b,this.DEFAULT_ZOOM)))},initUserPin_:function(){if(this.currentLocation_)if(this.userPin_)this.userPin_.setLatLng(this.currentLocation_);
else{var a=fourSq.newpin.PinIconProviderFactory.forUser(),b=templates.fourSq.explore.tooltips.mapUserTooltip(),c=new fourSq.newpin.CenteredAboveBelowTooltipPositioner({map:this.map_,latLng:fourSq.api.models.companion.geo.LatLngUtil.toLeaflet(this.currentLocation_),buffer:fourSq.explore.MapView.PIN_TOOLTIP_BUFFER,pinSize:a.size()}),b=new fourSq.newpin.Tooltip({map:this.map_,latLng:this.currentLocation_,contents:b,positioner:c,options:{autoPan:!1,closeButton:!1}});this.userPin_=new fourSq.newpin.UserPin({map:this.map_,
latLng:this.currentLocation_,iconProvider:a,id:"user",tooltip:b});this.userPin_.setZIndexOffset(fourSq.explore.MapView.PinZindexLevels.USER);a=fourSq.bind(function(){this.userPin_.openTooltip()},this);b=fourSq.bind(function(){this.userPin_.closeTooltip()},this);this.userPin_.on(fourSq.newpin.UserPin.Events.MOUSEOVER,a);this.userPin_.on(fourSq.newpin.UserPin.Events.MOUSEOUT,b)}},bindMapEvents_:function(){this.mapEventsBound_||(this.map_.on(fourSq.explore.MapView.LeafletEvents_.DRAGEND,this.handleMapDrag_,
this),this.map_.on(fourSq.explore.MapView.LeafletEvents_.ZOOM_END,this.handleMapZoom_,this),this.mapEventsBound_=!0)},unbindMapEvents_:function(){this.mapEventsBound_&&(this.map_.off(fourSq.explore.MapView.LeafletEvents_.DRAGEND,this.handleMapDrag_,this),this.map_.off(fourSq.explore.MapView.LeafletEvents_.ZOOM_END,this.handleMapZoom_,this),this.mapEventsBound_=!1)},suspendMapEvents_:function(a,b,c,d,e){this.unbindMapEvents_();fourSq.map.EventHelper.onOnce(this.map_,a,function(){this.bindMapEvents_();
b&&this.calculateBrowseFence_();c&&(this.specifiedBounds_=void 0);d&&this.findAndAnnounceOutOfBoundsPins_();e&&e()},this)},unbindAndForceChangeWhenDone_:function(){var a=fourSq.bind(function(){this.trigger(fourSq.explore.MapView.Events.REQUEST_REQUERY_FOR_BOUNDS_CHANGED)},this);this.suspendMapEvents_(fourSq.explore.MapView.LeafletEvents_.MOVEEND,!0,!0,!1,a)},calculateBrowseFence_:function(){this.browseFence_=fourSq.map.MapUtil.padBoundsByPercent(fourSq.api.models.companion.geo.LatLngBoundsUtil.toLeaflet(this.getMapBounds()),
this.browseFenceBounds_)},isWithinBrowseArea_:function(){var a=fourSq.api.models.companion.geo.LatLngBoundsUtil.toLeaflet(this.getMapBounds()).getCenter();return this.browseFence_.contains(a)},showFence_:function(){this.fenceLayer_&&this.map_.removeLayer(this.fenceLayer_);var a=this.browseFence_,b=a.getNorthEast(),a=a.getSouthWest(),c=new L.LatLng(b.lat,a.lng),d=new L.LatLng(a.lat,b.lng);this.fenceLayer_=b=new L.Polygon([c,b,d,a]);this.map_.addLayer(b,{color:"red",fillColor:"#f03",fillOpacity:.5})},
findAndAnnounceOutOfBoundsPins_:function(){var a=this.findOutOfBoundsPins_(this.pins_),a=this.calculatePositionsOfOutOfBoundsPins_(a);this.trigger(fourSq.explore.MapView.Events.OUT_OF_BOUNDS_PINS,a)},findOutOfBoundsPins_:function(a){return _.reject(a,this.pinIsInBounds_,this)},calculatePositionsOfOutOfBoundsPins_:function(a){var b={};_.each(a,function(a){var d=fourSq.map.MapUtil.calculateBearing(this.map_.getCenter(),a.getLatLng());b[a.id]=this.bearingToMapRelativePosition_(d)},this);return b},bearingToMapRelativePosition_:function(a){var b=
this.cornerBearings_||fourSq.explore.MapView.SquareCornerBearings;return b.nw<=a&&0>=a||0<=a&&a<=b.ne?fourSq.explore.MapView.PositionsRelativeToMap.ABOVE:b.ne<a&&a<=b.se?fourSq.explore.MapView.PositionsRelativeToMap.RIGHT:b.sw<=a&&a<b.nw?fourSq.explore.MapView.PositionsRelativeToMap.LEFT:fourSq.explore.MapView.PositionsRelativeToMap.BELOW},calculateCornerBearings_:function(){return{nw:fourSq.map.MapUtil.calculateBearing(this.map_.getCenter(),this.map_.getBounds().getNorthWest()),ne:fourSq.map.MapUtil.calculateBearing(this.map_.getCenter(),
this.map_.getBounds().getNorthEast()),se:fourSq.map.MapUtil.calculateBearing(this.map_.getCenter(),this.map_.getBounds().getSouthEast()),sw:fourSq.map.MapUtil.calculateBearing(this.map_.getCenter(),this.map_.getBounds().getSouthWest())}},pinIsInBounds_:function(a){var b=this.inBoundsBorderPadding_,c=a.getSize();a=fourSq.map.LeafletUtil.latLngToContainerPoint(this.map_,a.getLatLng());var d=this.map_.getSize();return a.x<b.left||a.x+c.width/2>d.x+b.right||a.y-c.height<b.top||a.y>d.y+b.bottom?!1:!0},
panToIncludePin_:function(a){var b,c,d,e=this.inBoundsBorderPadding_,f;!this.pinIsInBounds_(a)&&(c=a.getSize(),d=fourSq.map.LeafletUtil.latLngToContainerPoint(this.map_,a.getLatLng()),b=a=0,f=this.map_.getSize(),d.x<e.left?a=d.x-c.width/2-50:d.x+c.width/2>f.x+e.right&&(a=d.x+c.width/2-f.x+50),d.y-c.height<e.top?b=d.y-c.height-50:d.y>f.y+e.bottom&&(b=d.y-f.y+50),a||b)&&(this.suspendMapEvents_(fourSq.explore.MapView.LeafletEvents_.MOVEEND,!0,!0,!0),this.map_.panBy(new L.Point(a,b)))},serialize:function(){return{bounds:this.getBounds(),
hasSpecificBounds:!!this.specificBounds_}},deserialize:function(a){this.setBounds(a.bounds,!0);a.hasSpecificBounds&&(this.specificBounds_=a.bounds)}},{Events:{ON_CURRENT_LOCATION:"ON_CURRENT_LOCATION",BOUNDS_CHANGED:"BOUNDS_CHANGED",REQUEST_REQUERY:"REQUEST_REQUERY",REQUEST_REQUERY_FOR_BOUNDS_CHANGED:"REQUEST_REQUERY_FOR_BOUNDS_CHANGED",LOCATION_FOUND:"LOCATION_FOUND",LOCATION_NOT_FOUND:"LOCATION_NOT_FOUND",LOAD:"LOAD",OUT_OF_BOUNDS_PINS:"OUT_OF_BOUNDS_PINS",MAP_CLICK:"MAP_CLICK",Result:{SELECT:"RESULT:SELECT",
DESELECT:"RESULT:DESELECT",HIGHLIGHT:"RESULT:HIGHLIGHT",UNHIGHLIGHT:"RESULT:UNHIGHTLIGHT",SHOW_MENU:"RESULT:SHOW_MENU",SHOW_EDITOR:"RESULT:SHOW_EDITOR",GOTO_VENUE:"RESULT:GOTO_VENUE",GOTO_SPECIAL:"RESULT:GOTO_SPECIAL",REQUERY_WITH_VENUE_CATEGORY:"RESULT:REQUERY_WITH_VENUE_CATEGORY"}},PIN_TOOLTIP_BUFFER:2,PinZindexLevels:{STANDARD:0,SELECTED:1E4,HIGHLIGHTED:2E4,USER:3E4},expandBoundsToFitRecs:function(a,b){var c=_.map(b,function(a){return new L.LatLng(a.venue.location.lat,a.venue.location.lng)}),c=
new L.LatLngBounds(c);return fourSq.map.LeafletUtil.expandMapBounds(a,c)}});fourSq.explore.MapView.PositionsRelativeToMap={ABOVE:"above",RIGHT:"right",BELOW:"below",LEFT:"left"};fourSq.explore.MapView.LeafletEvents_={CLICK:"click",DRAGEND:"dragend",MOVEEND:"moveend",LOAD:"load",LOCATION_FOUND:"locationfound",LOCATION_ERROR:"locationerror",ZOOM_END:"zoomend"};fourSq.explore.MapView.SquareCornerBearings={nw:-45,ne:45,se:135,sw:-135};fourSq.explore.MenuViewer=function(a){};
fourSq.explore.MenuViewer=fourSq.views.MenuView.extend({initialize:function(a){fourSq.explore.MenuViewer.__super__.initialize.call(this,a);this.venueName_=a.venueName;this.menuResponse_=a.menuResponse},render:function(){var a=$(templates.fourSq.newdrag.page.venuemenu.common.core.contents({venueName:this.venueName_,withToc:!1,displayMenu:this.menuResponse_,forMobile:!1}));a.click(function(a){a.stopPropagation()});this.$container_=$("\x3cdiv\x3e").prop("id","menuContainer");this.$container_.append(a);
this.$el.append(this.$container_);this.onEscapeKey_=fourSq.bind(function(a){27===a.which&&(this.unbindEvents_(),this.destroy())},this);this.bindEvents_();$("body, html").css("overflow","hidden");this.setupMenuFlag();return this},show:function(){this.$container_.show();return this},hide:function(){this.$container_.hide();$("body, html").css("overflow","");return this},destroy:function(){this.$container_.remove();$("body, html").css("overflow","");delete this.$container_},bindEvents_:function(){this.eventsBound_||
($(document).focus(),this.$container_.click(fourSq.bind(this.destroy,this)),$(document).on("keydown",this.onEscapeKey_),this.eventsBound_=!0)},unbindEvents_:function(){this.eventsBound_&&(this.$container_.off("click"),$(document).off("keydown",this.onEscapeKey_),this.eventsBound_=!1)}});fourSq.explore.ResultView=function(a){};
fourSq.explore.ResultView=fourSq.ui.View.extend({initialize:function(a){this.recommendation_=a.recommendation;this.listServiceProxy_=a.listServiceProxy;this.index_=a.index;this.menuResponse_=void 0},render:function(){throw Error("render no implemented");},decorate:function(){fourSq.util.devices.isTouchIncludingIPad()||this.$el.hover(fourSq.bind(this.handleMouseover_,this),fourSq.bind(this.handleMouseout_,this));this.$el.click(fourSq.bind(this.handleClick_,this));this.$el.find(".face .tooltip, .remainder, .price, .icon.tooltip, .venueScore, .compact.phrases .phrase").tooltip();
var a=function(a){a.preventDefault()};this.$el.find(".face").click(fourSq.bind(this.handleFaceClick_,this));this.$el.find(".photoContainer").click(fourSq.bind(this.handlePhotoClick_,this));this.$el.find(".linkToMenu .link").click(a).click(fourSq.bind(this.showMenu_,this));this.$el.find(".menuIcon.link").click(a).click(fourSq.bind(this.showMenu_,this));this.$el.find(".linkToEditor").click(a).click(fourSq.bind(this.showEditor_,this));this.$el.find(".venueName a").click(fourSq.bind(this.gotoVenue_,this));
this.$el.find(".categoryName").click(function(a){a.stopPropagation()}).click(fourSq.bind(this.requeryForVenueCategory_,this));fourSq.config.explore.useNewEndpoint&&this.$el.find(".tastePill, .search_match, .tip_taste_match.onUser").click(fourSq.bind(this.requeryForTaste_,this));var a=this.$el.find(".detail.broadcast"),b=this.$el.find(".specialInfo");a.click(fourSq.bind(this.goToBroadcast_,this));b.click(fourSq.bind(this.goToSpecial_,this));a={section:fourSq.stats.action.Section.RESULTS,component:fourSq.stats.action.Component.RESULT,
componentIndex:this.index_-1,ids:fourSq.api.models.companion.log.Oids.build({promotionId:this.recommendation_.promoted?this.recommendation_.promoted.id:void 0,referralId:this.recommendation_.referralId})};b=this.$el.find(".buttons .save-button");b.length&&(new fourSq.ui.save.SaveButton({venue:this.recommendation_.venue,el:b,listService:this.listServiceProxy_,actionOptions:a})).decorate();var b=new fourSq.api.controllers.VenueFeedbackController(this.recommendation_.venue.id),c=this.$el.find(".buttons .like").get(0);
fourSq.isDefinedAndNotNull(c)&&(new fourSq.ui.liking.LikeButtonWithFallback({el:c,isLiked:!0===this.recommendation_.venue.like,likes:this.recommendation_.venue.likes,controller:b,actionOptions:a})).decorate();return this},select:function(){this.$el.addClass("select")},deselect:function(){this.$el.removeClass("select")},featuredPhoto_:function(){if(this.recommendation_.photo)return this.recommendation_.photo},requeryForVenueCategory_:function(){this.recommendation_.venue.categories&&this.recommendation_.venue.categories[0]&&
this.trigger(fourSq.explore.ResultView.Events.RESULT.REQUERY_WITH_VENUE_CATEGORY,this.recommendation_.venue.id,this.recommendation_.venue.categories[0].name)},requeryForTaste_:function(a){this.trigger(fourSq.explore.ResultView.Events.RESULT.REQUERY_WITH_TASTE,$(a.delegateTarget).text())},goToSpecial_:function(a){var b=$(a.delegateTarget).data("special-id")||void 0;a=$(a.delegateTarget).data("special-redemption")||void 0;this.trigger(fourSq.explore.ResultView.Events.RESULT.GOTO_SPECIAL,this.recommendation_.venue.id,
b,a)},goToBroadcast_:function(a){a=$(a.delegateTarget).data("broadcast-id");this.trigger(fourSq.explore.ResultView.Events.RESULT.GOTO_BROADCAST,this.recommendation_.venue.id,a)},gotoVenue_:function(){this.trigger(fourSq.explore.ResultView.Events.RESULT.GOTO_VENUE,this.recommendation_.venue.id)},showMenu_:function(){this.trigger(fourSq.explore.ResultView.Events.RESULT.SHOW_MENU,this.recommendation_.venue.id)},showEditor_:function(){this.trigger(fourSq.explore.ResultView.Events.RESULT.SHOW_EDITOR,this.recommendation_.venue.id)},
handleFaceClick_:function(a){this.trigger(fourSq.explore.ResultView.Events.RESULT.GOTO_USER,this.recommendation_.venue.id)},handlePhotoClick_:function(){if(fourSq.isDefinedAndNotNull(this.photoViewer_))this.photoViewer_.open(0);else{var a=this.featuredPhoto_(),b=a?a.id:void 0,c=new fourSq.ui.PhotoLoader({apiCall:fourSq.api.services.Venue.photos,objectId:this.recommendation_.venue.id,loadCallback:function(a){return _(a).reject(function(a){return a.id===b})},preloadedPages:0,pageSize:30});this.photoViewer_=
new fourSq.views.PhotoViewer({photos:a?[a]:[],target:"_blank",photoLoader:c});c.load(fourSq.bind(function(){this.photoViewer_.open(0)},this))}this.trigger(fourSq.explore.ResultView.Events.RESULT.SHOW_PHOTOS,this.recommendation_.venue.id)},handleClick_:function(){this.$el.hasClass("select")?(this.deselect(),this.trigger(fourSq.explore.ResultView.Events.RESULT.DESELECT,this.recommendation_.venue.id)):(this.select(),this.trigger(fourSq.explore.ResultView.Events.RESULT.SELECT,this.recommendation_.venue.id))},
highlight:function(){this.$el.addClass("highlight")},handleMouseover_:function(){this.highlight();this.trigger(fourSq.explore.ResultView.Events.RESULT.HIGHLIGHT,this.recommendation_.venue.id)},unhighlight:function(){this.$el.removeClass("highlight")},handleMouseout_:function(){this.unhighlight();this.trigger(fourSq.explore.ResultView.Events.RESULT.UNHIGHLIGHT,this.recommendation_.venue.id)},markInBounds:function(){this.$el.find(".outOfBounds").remove()},markOutOfBounds:function(a){this.$el.find(".outOfBounds").remove();
this.$el.find(".outOfBoundsContainer").prepend($(templates.fourSq.explore.newresultlist.outOfBoundsIndicator({position:a}))).find(".outOfBounds").click(function(){$(".hoverTip:last").hide()}).tooltip()}},{Events:{RESULT:{SELECT:"RESULT:SELECT",DESELECT:"RESULT:DESELECT",HIGHLIGHT:"RESULT:HIGHLIGHT",UNHIGHLIGHT:"RESULT:UNHIGHLIGHT",SHOW_MENU:"RESULT:SHOW_MENU",SHOW_EDITOR:"RESULT:SHOW_EDITOR",GOTO_VENUE:"RESULT:GOTO_VENUE",GOTO_SPECIAL:"RESULT:GOTO_SPECIAL",GOTO_BROADCAST:"RESULT:GOTO_BROADCAST",GOTO_USER:"RESULT:GOTO_USER",
REQUERY_WITH_VENUE_CATEGORY:"RESULT:REQUERY_WITH_VENUE_CATEGORY",REQUERY_WITH_TASTE:"RESULT:REQUERY_WITH_TASTE",SHOW_PHOTOS:"RESULT:SHOW_PHOTOS"}}});fourSq.explore.ResultsErrorView=function(a){};
fourSq.explore.ResultsErrorView=fourSq.ui.View.extend({initialize:function(a){this.recommendations_=a.recommendations||[];this.error_=a.error},render:fourSq.abstractMethod,decorate:function(){_.each(this.$el.find(".link").toArray(),fourSq.bind(this.decorateLink_,this));return this},decorateLink_:function(a){a=$(a);var b=a.data("action"),c=this,d=fourSq.explore.ResultsErrorView.Events.ACTION,e=fourSq.explore.ResultsErrorView.ACTIONS;a.click(function(a){switch(b){case e.RETRY:case e.ADD_VENUE:case e.ZOOM_IN_TILL_VALID:case e.ZOOM_OUT_1:case e.REMOVE_FILTERS:c.trigger(d,b);
break;case e.REQUERY_WITH_TERM:a=$(a.target).text();c.trigger(d,e.REQUERY_WITH_TERM,{term:a});break;case e.REQUERY_WITH_CATEGORY:a=$(a.target).data("value"),c.trigger(d,e.REQUERY_WITH_CATEGORY,{category:a})}})}},{ACTIONS:{RETRY:"retry",REQUERY_WITH_TERM:"queryTerm",REQUERY_WITH_CATEGORY:"category",ZOOM_IN_TILL_VALID:"zoomInTillValid",ZOOM_OUT_1:"zoomOut1",ADD_VENUE:"addVenue",REMOVE_FILTERS:"removeFilters"},Events:{ACTION:"action"}});fourSq.explore.ResultsView=function(a){};
fourSq.explore.ResultsView=fourSq.ui.View.extend({initialize:function(a){this.recommendations_=a.recommendations||[];this.error_=a.error;this.querySummary_=a.querySummary;this.resultViewsById_={};this.outOfBoundsResults_={};this.currentlySelectedViewId_=void 0;this.listServiceProxy_=new fourSq.ui.save.ListServiceProxy;this.impressionMonitor_=null;this.options={}},initOrUpdateImpressionMonitor_:function(){fourSq.isDefinedAndNotNull(this.impressionMonitor_)||(this.impressionMonitor_=new fourSq.ui.ImpressionMonitor(this.$el,
".singleRecommendation",{revealPercent:50}),this.impressionMonitor_.on(fourSq.ui.ImpressionMonitor.Events.FIRST_IMPRESSION,this.handleResultImpression_,this));this.impressionMonitor_.update()},render:function(){var a=fourSq.api.models.companion.user.UserUtil.currentUser();this.$el.empty().append($(templates.fourSq.explore.newresultlist.recommendationList({recommendations:this.recommendations_,error:this.error_,currentUserId:a?a.id:void 0,hasSearchTerm:this.querySummary_?this.querySummary_.hasSearchTerm:
!1,hasFilters:this.querySummary_?this.querySummary_.hasFilters:!1,near:this.querySummary_.near||void 0,useNewEndpoint:fourSq.config.explore.useNewEndpoint})));return this.decorate()},decorate:function(){var a=this.$el.find(".recommendationList").find(".singleRecommendation"),b={};_(this.recommendations_).each(function(a){b[a.venue.id]=a});var c=this.resultViewsById_,d=this;_(a).each(function(a,f){var g=$(a).data("id"),h=new fourSq.explore.ResultView({el:a,recommendation:b[g],listServiceProxy:d.listServiceProxy_,
index:f+1});h.decorate();h.on(fourSq.explore.ResultView.Events.RESULT.SELECT,d.handleResultSelect_,d);h.on(fourSq.explore.ResultView.Events.RESULT.DESELECT,d.handleResultDeselect_,d);h.on(fourSq.explore.ResultView.Events.RESULT.HIGHLIGHT,d.handleResultHighlight_,d);h.on(fourSq.explore.ResultView.Events.RESULT.UNHIGHLIGHT,d.handleResultUnhiglight_,d);h.on(fourSq.explore.ResultView.Events.RESULT.SHOW_MENU,d.handleShowMenu_,d);h.on(fourSq.explore.ResultView.Events.RESULT.SHOW_EDITOR,d.handleShowEditor_,
d);h.on(fourSq.explore.ResultView.Events.RESULT.GOTO_VENUE,d.handleGotoVenue_,d);h.on(fourSq.explore.ResultView.Events.RESULT.GOTO_BROADCAST,d.handleGotoBroadcast_,d);h.on(fourSq.explore.ResultView.Events.RESULT.GOTO_SPECIAL,d.handleGotoSpecial_,d);h.on(fourSq.explore.ResultView.Events.RESULT.GOTO_USER,d.handleGotoUser_,d);h.on(fourSq.explore.ResultView.Events.RESULT.SHOW_PHOTOS,d.handleShowPhotos_,d);h.on(fourSq.explore.ResultView.Events.RESULT.REQUERY_WITH_VENUE_CATEGORY,d.handleSearchVenueCategory_,
d);h.on(fourSq.explore.ResultView.Events.RESULT.REQUERY_WITH_TASTE,d.handleSearchTaste_,d);c[g]=h});this.maybeDecorateErrors_();this.initOrUpdateImpressionMonitor_();return this},maybeDecorateErrors_:function(){var a=this.$el.find(".genericError, .zoomError, .noResults, .fewResults, .addVenueCard");if(a.length){this.resultsErrorView_=(new fourSq.explore.ResultsErrorView({error:this.error_,recommendations:this.recommendations_,el:a})).decorate();var b=fourSq.explore.ResultsErrorView.ACTIONS;this.resultsErrorView_.on(fourSq.explore.ResultsErrorView.Events.ACTION,
fourSq.bind(function(a,d){switch(a){case b.RETRY:this.trigger(fourSq.explore.ResultsView.Events.ACTIONS.RETRY);break;case b.ADD_VENUE:this.trigger(fourSq.explore.ResultsView.Events.ACTIONS.ADD_VENUE_FOR_TERM);break;case b.ZOOM_IN_TILL_VALID:this.trigger(fourSq.explore.ResultsView.Events.ACTIONS.ZOOM_IN_TILL_VALID);break;case b.ZOOM_OUT_1:this.trigger(fourSq.explore.ResultsView.Events.ACTIONS.ZOOM_OUT_1);break;case b.REMOVE_FILTERS:this.trigger(fourSq.explore.ResultsView.Events.ACTIONS.REMOVE_FILTERS);
break;case b.REQUERY_WITH_TERM:d&&d.term&&this.trigger(fourSq.explore.ResultsView.Events.ACTIONS.REQUERY_WITH_TERM,d.term);break;case b.REQUERY_WITH_CATEGORY:d&&d.category&&this.trigger(fourSq.explore.ResultsView.Events.ACTIONS.REQUERY_WITH_CATEGORY,d.category)}},this))}},updateRecommendations:function(a,b){this.resultViewsById_=[];this.recommendations_=a;this.querySummary_=b;this.resultsErrorView_=this.error_=void 0;this.render();$(document.body).scrollTop(0)},error:function(a,b){this.error_=a;this.resultsErrorView_=
void 0;this.resultViewsById_=[];this.recommendations_=[];b&&(this.querySummary_=b);this.render();$(document.body).scrollTop(0)},handleResultImpression_:function(a){var b=a.data("id");a=a.hasClass("tipWithLogging")?a.data("tipid"):void 0;this.trigger(fourSq.explore.ResultsView.Events.RESULT.IMPRESSION,{vid:b,tipId:a})},handleShowMenu_:function(a){this.trigger(fourSq.explore.ResultsView.Events.RESULT.SHOW_MENU,a)},handleShowEditor_:function(a){this.trigger(fourSq.explore.ResultsView.Events.RESULT.SHOW_EDITOR,
a)},handleSearchVenueCategory_:function(a,b){this.trigger(fourSq.explore.ResultsView.Events.RESULT.REQUERY_WITH_VENUE_CATEGORY,a,b)},handleSearchTaste_:function(a){this.trigger(fourSq.explore.ResultsView.Events.RESULT.REQUERY_WITH_TASTE,a)},handleGotoUser_:function(a,b){this.trigger(fourSq.explore.ResultsView.Events.RESULT.GOTO_USER,a)},handleGotoSpecial_:function(a,b,c){this.trigger(fourSq.explore.ResultsView.Events.RESULT.GOTO_SPECIAL,a,b,c)},handleGotoBroadcast_:function(a,b){this.trigger(fourSq.explore.ResultsView.Events.RESULT.GOTO_BROADCAST,
a,b)},handleGotoVenue_:function(a){this.trigger(fourSq.explore.ResultsView.Events.RESULT.GOTO_VENUE,a)},handleShowPhotos_:function(a){this.trigger(fourSq.explore.ResultsView.Events.RESULT.SHOW_PHOTOS,a)},handleResultSelect_:function(a){fourSq.isDefinedAndNotNull(this.currentlySelectedViewId_)&&this.deselectResult(this.currentlySelectedViewId_);this.currentlySelectedViewId_=a;this.trigger(fourSq.explore.ResultsView.Events.RESULT.SELECT,a)},selectResult:function(a,b){fourSq.debug.info("Result List: select result"+
a);fourSq.isDefinedAndNotNull(this.currentlySelectedViewId_)&&this.deselectResult(this.currentlySelectedViewId_);this.currentlySelectedViewId_=a;var c=this.resultViewsById_[a];fourSq.isDefinedAndNotNull(c)&&(c.select(),b||$("body, html").animate({scrollTop:c.$el.offset().top-82}))},handleResultDeselect_:function(a){this.currentlySelectedViewId_=void 0;this.trigger(fourSq.explore.ResultsView.Events.RESULT.DESELECT,a)},deselectResult:function(a){this.currentlySelectedViewId_=void 0;fourSq.debug.info("Result List: deselect result"+
a);a=this.resultViewsById_[a];fourSq.isDefinedAndNotNull(a)&&a.deselect()},handleResultHighlight_:function(a){this.trigger(fourSq.explore.ResultsView.Events.RESULT.HIGHLIGHT,a)},highlightResult:function(a){fourSq.debug.info("Result List: highlight result"+a);a=this.resultViewsById_[a];fourSq.isDefinedAndNotNull(a)&&a.highlight()},handleResultUnhiglight_:function(a){this.trigger(fourSq.explore.ResultsView.Events.RESULT.UNHIGHLIGHT,a)},unhighlightResult:function(a){fourSq.debug.info("Result List: unhighlight result"+
a);a=this.resultViewsById_[a];fourSq.isDefinedAndNotNull(a)&&a.unhighlight()},markOutOfBoundsResults:function(a){var b=_.difference(_(this.outOfBoundsResults_).keys(),_(a).keys());_.each(b,this.markResultInBounds_,this);fourSq.forEachKey(a,this.markResultOutOfBounds_,this);this.outOfBoundsResults_=a},markResultInBounds_:function(a){(a=this.resultViewsById_[a])&&a.markInBounds()},markResultOutOfBounds_:function(a,b){var c=this.resultViewsById_[b];c&&c.markOutOfBounds(a)}},{Events:{RESULT:{SELECT:"RESULT:SELECT",
DESELECT:"RESULT:DESELECT",HIGHLIGHT:"RESULT:HIGHLIGHT",UNHIGHLIGHT:"RESULT:UNHIGHLIGHT",IMPRESSION:"RESULT:IMPRESSION",SHOW_MENU:"RESULT:SHOW_MENU",SHOW_EDITOR:"RESULT:SHOW_EDITOR",GOTO_VENUE:"RESULT:GOTO_VENUE",GOTO_SPECIAL:"RESULT:GOTO_SPECIAL",GOTO_BROADCAST:"RESULT:GOTO_BROADCAST",GOTO_USER:"RESULT:GOTO_USER",SHOW_PHOTOS:"RESULT:SHOW_PHOTOS",REQUERY_WITH_VENUE_CATEGORY:"RESULT:REQUERY_WITH_VENUE_CATEGORY",REQUERY_WITH_TASTE:"RESULT:REQUERY_WITH_TASTE"},ACTIONS:{RETRY:"RETRY",ADD_VENUE_FOR_TERM:"ADD_VENUE_FOR_TERM",
REQUERY_WITH_TERM:"REQUERY_WITH_TERM",REQUERY_WITH_CATEGORY:"REQUERY_WITH_CATEGORY",ZOOM_IN_TILL_VALID:"ZOOM_IN_TILL_VALID",ZOOM_OUT_1:"ZOOM_OUT_1",REMOVE_FILTERS:"REMOVE_FILTERS"}}});fourSq.explore.pin.SpriteIcon=L.Icon.extend({initialize:function(a,b){this.row=a;this.col=b},createIcon:function(){var a=document.createElement("div");a.style.backgroundImage="url("+this.options.sprite+")";a.className="leaflet-marker-icon";var b=this.options.gridSize||this.iconSize;fourSq.isDefinedAndNotNull(this.row)&&fourSq.isDefinedAndNotNull(this.col)&&(a.style.backgroundPosition=-(this.col*b.x+(b.x-this.iconSize.x)/2)+"px "+-(this.row*b.y+(b.y-this.iconSize.y)/2)+"px");a.style.marginLeft=-this.iconAnchor.x+
"px";a.style.marginTop=-this.iconAnchor.y+"px";if(b=this.iconSize)a.style.width=b.x+"px",a.style.height=b.y+"px";return a},createShadow:function(){var a=this.shadowSize,b=this.shadowUrl;if(!b)return null;b=this._createImg(b);b.className="leaflet-marker-shadow";b.style.marginLeft=-this.shadowAnchor.x+"px";b.style.marginTop=-this.shadowAnchor.y+"px";a&&(b.style.width=a.x+"px",b.style.height=a.y+"px");return b}});fourSq.explore.pin.SpritedNumberIcon=function(a,b){};
fourSq.explore.pin.SpritedNumberIcon=fourSq.explore.pin.SpriteIcon.extend({initialize:function(a,b){fourSq.explore.pin.SpriteIcon.prototype.initialize.call(this,a,b)},iconSize:new L.Point(29,39),iconAnchor:new L.Point(15,37),shadowUrl:"https://ss1.4sqi.net/img/mappin-shadow-be78cec0d3ea7c6c066a8d9346f17629.png",shadowSize:new L.Point(29,15),shadowAnchor:new L.Point(15,10),options:{sprite:"https://ss1.4sqi.net/img/mappin-sprite-f068dcd1ca7caa92bf396ffbbb855e7f.png",gridSize:new L.Point(35,45)}});fourSq.explore.pin.PinIconProviderFactory={cache_:{},spriteMap_:{standard:{blue:0,orange:2},selected:{blue:1,orange:3}},forVenue:function(a,b){var c=a?"orange":"blue",d=c+"-"+b;if(!fourSq.isDefinedAndNotNull(this.cache_[d])){var e=new fourSq.explore.pin.SpritedNumberIcon(this.spriteMap_[fourSq.explore.pin.ExplorePin.IconStates.STANDARD][c],b),f=new fourSq.explore.pin.SpritedNumberIcon(this.spriteMap_[fourSq.explore.pin.ExplorePin.IconStates.SELECTED][c],b),c=new fourSq.newpin.PinIconProvider(e,c+
" "+b,{width:29,height:39});c.addState("selected",f);this.cache_[d]=c}return this.cache_[d]}};fourSq.explore.pin.Quadrant={NE:1,NW:2,SW:3,SE:4};fourSq.explore.pin.QuadrantUtil={calculateMapQuadrant:function(a,b){var c=$(fourSq.map.LeafletUtil.getContainer(a)),d=c.width(),c=c.height(),e=fourSq.map.LeafletUtil.latLngToContainerPoint(a,b);return e.y<c/2?e.x<d/2?fourSq.explore.pin.Quadrant.NW:fourSq.explore.pin.Quadrant.NE:e.x<d/2?fourSq.explore.pin.Quadrant.SW:fourSq.explore.pin.Quadrant.SE}};fourSq.explore.pin.SideInBoundsTooltipPositioner=function(a){};
fourSq.explore.pin.SideInBoundsTooltipPositioner=fourSq.newpin.TooltipPositioner.extend({initialize:function(a){this.map_=a.map;this.latLng_=a.latLng;this.buffer_=a.buffer;this.pinSize_=a.pinSize;this.tooltipSize_=a.tooltipSize||{width:0,height:0}},calculateOffset:function(){var a=fourSq.explore.pin.QuadrantUtil.calculateMapQuadrant(this.map_,this.latLng_),b=this.buffer_+this.pinSize_.width/2+this.tooltipSize_.width/2;return{x:a==fourSq.explore.pin.Quadrant.NW||a==fourSq.explore.pin.Quadrant.SW?b:
-b,y:-this.pinSize_.height/2+this.tooltipSize_.height/2}},setTooltipSize:function(a){this.tooltipSize_=a}});fourSq.explore.pin.ExplorePin=function(a){};
fourSq.explore.pin.ExplorePin=fourSq.newpin.Pin.extend({initialize:function(a){fourSq.explore.pin.ExplorePin.__super__.initialize.apply(this,arguments);this.selected_=!1},getSize:function(){return this.iconProvider_.size()},select:function(){fourSq.debug.info("selecting ",this.id);this.pinMarker_.setIcon(this.iconProvider_.iconForState(fourSq.explore.pin.ExplorePin.IconStates.SELECTED));this.tooltip_&&(this.tooltip_.open(),this.tooltip_.addClass("selected"));this.selected_=!0},deselect:function(){fourSq.debug.info("deselecting ",
this.id);this.pinMarker_.setIcon(this.iconProvider_.iconForState(fourSq.explore.pin.ExplorePin.IconStates.STANDARD));this.tooltip_&&this.tooltip_.removeClass("selected");this.selected_=!1}},{IconStates:{STANDARD:"standard",SELECTED:"selected"}});